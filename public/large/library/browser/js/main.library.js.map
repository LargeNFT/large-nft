{"version":3,"file":"large/library/browser/js/main.library.js","mappings":"odAEA,SAASA,EAAoBC,GAAO,IAClCC,EAAG,IACHC,EAAG,QACHC,IAEA,IAcIC,EAdAC,EAAgBC,WAAWC,UAAUC,IAAI,iBAEzCC,GADYH,WAAWC,UAAUC,IAAI,aAC3BF,WAAWC,UAAUC,IAAI,YACnCE,EAAWJ,WAAWC,UAAUC,IAAI,YAGpCG,GAFSX,EAAMY,OACRZ,EAAMa,KACLb,EAAMW,OACdG,EAASd,EAAMc,OACfC,EAAaf,EAAMgB,YACnBC,EAAWjB,EAAMkB,UACjBC,EAAuC,QAAxBnB,EAAMoB,eACrBC,EAA+C,QAA5BrB,EAAMsB,mBACzBC,EAA8B,QAAnBvB,EAAMwB,UACjBC,EAAczB,EAAMyB,YAEpBC,GAAc,EAClB,MAAMC,EAAc,IACdV,GAAUW,OAAS,EACd,GAAGX,iDAAwDY,mBAAmB,GAAGnB,MAAaD,SAE9F,GAAGA,wDAA8DoB,mBAAmB,GAAGnB,MAAaD,SAGzGqB,EAAqBC,GAClB1B,EAAcyB,mBAAmBC,GAEpCC,EAAiBC,UACrB7B,OAAgB8B,EACX7B,EAAc8B,gBACX9B,EAAc+B,eAEtBhC,QAAsBC,EAAcgC,aAG/BhC,EAAc8B,WACjBT,GAAc,GAEZtB,IACFC,EAAc0B,QAAU3B,EACnBC,EAAciC,cACXjC,EAAckC,WAGxBpC,GAAS,EAELqC,EAAgBP,gBACd5B,EAAcoC,mBAGdpC,EAAckC,UACpBP,GAAgB,EAElBA,IAEA,OAAO,SAAUU,GACLA,EAAKC,EAAb,IACIC,EAAKF,EAAKE,GACFF,EAAKG,MACPH,EAAKxC,IACAwC,EAAKI,SACJJ,EAAKK,UACRL,EAAKM,OACJN,EAAKvC,QACNuC,EAAKO,OAElB,OAAOL,CAAE;;;;;;;;uBAQQ7B,GAAYa,OAAS,EAAIb,EAAaN;;;;;;+BAM9BE;;;;cAIhBY,EA4JCqB,CAAE,IA5JQA,CAAE;;;;;;;;;;;;;;0BAcFlB,EAAckB,CAAE;;;;;;0CAMiBV,MAAjB9B,EAA6BwC,CAAE;wDACjBd,EAAmB1B;wCACjCwC,CAAE;qGACyDJ;;;;;;;;;8BASvErB,EAAeyB,CAAE;;2CAEJnC;;;;;;;;;;8BAUXmC,CAAE;;;4BAGJA,CAAE;;;;;;qCAMKjB;;;;;;;;;;;;;;;qCAeAlB;;;;;;;;;;;;0BAYXY,EAAmBuB,CAAE;;uCAERnC;;;;;;;;;;;;uCAYAA;;;;;;;;;;;;0BAYXmC,CAAE;;;;;;;;;;;;;2BAaHjB;;;;iCAIgB,WAAVb,EAAsB8B,CAAE,cAAgBA,CAAE,cAAcnC;;;;kBAIvEY,EAAmBuB,CAAE;mCACM,YAAV9B,EAAuB8B,CAAE,cAAgBA,CAAE,cAAcnC;;;;mCAI/C,eAAVK,EAA0B8B,CAAE,cAAgBA,CAAE,cAAcnC;;;;kBAI3EmC,CAAE;;kBAEJlB,EAAckB,CAAE;;oBAEdzB,EAAeyB,CAAE;qCACU,QAAV9B,EAAmB8B,CAAE,cAAgBA,CAAE,cAAcnC;;;oBAGpEmC,CAAE;;oBAEaV,MAAjB9B,EAA6BwC,CAAE;iCAClBnC,iBAAuBL,oBAAgC0B,EAAmB1B;oBACrFwC,CAAE;gDACwBJ;;;kBAG5BI,CAAE;;;;;;;;;;YAUVnB,EAAcmB,CAAE;;;;;;;oBAORnB,EAAYyB,KAAKC,GAAKP,CAAE;;;wBAGpBO,EAAEC,KAAOR,CAAE;mCACAO,EAAEC;4BACTD,EAAEE;;wBAEJT,CAAE,GAAGO,EAAEE;;;;;sBAKXF,EAAEC,KAAOR,CAAE;;sBAETA,CAAE;;;;;;;;;;;cAWVA,CAAE;;;;;;;;;CAUd,CAEJ,CACA7C,EAAoBuD,GAAK,aACzB,UCxSA,SAAS,EAAoBtD,GAAO,IAClCC,EAAG,EACH0C,EAAC,IACDzC,EAAG,QACHC,IAEA,IAAIM,EAAUH,WAAWC,UAAUC,IAAI,WACnC+C,EAAwBjD,WAAWC,UAAUC,IAAI,yBACjDgD,EAAUxD,EAAMyD,SAChBC,EAAY1D,EAAM2D,WAClBC,EAAc5D,EAAM6D,aACxB,MAAMC,EAAOC,GACJtD,IAAYsD,EAEfC,EAAoB/B,UACxBgC,EAAEC,iBACF,IAAIV,EAAUb,EAAEsB,EAAEE,eAAeC,MACjClE,EAAImE,UAAUC,OACVd,EAAU,SACND,EAAsBgB,kBAAkBC,SAAShB,IACvDtD,EAAIuE,MAAMC,KAAKC,OAAOC,SAASd,EAAK,KAAON,GAAU,CACnDqB,WAAY,aAGd3E,EAAIuE,MAAMC,KAAKC,OAAOC,SAASd,EAAK,eAEtC5D,EAAImE,UAAUS,MAAM,EAEhBC,EAAcd,IAClBA,EAAEC,iBACF,MAAMc,EAAQ9E,EAAI8E,MAAMxE,IAAIyD,EAAEgB,QAC9BzB,EAAUwB,EAAME,MAChB/E,GAAS,EAMX,OAJAgF,IAAIC,GAAG,wBAAwB,SAAUC,GACvCzB,EAAcyB,EACdlF,GACF,IACO,SAAUuC,GACLA,EAAKC,EAAb,IACIC,EAAKF,EAAKE,GACFF,EAAKG,MACPH,EAAKxC,IACAwC,EAAKI,SACJJ,EAAKK,UACRL,EAAKM,OACJN,EAAKvC,QACNuC,EAAKO,OAElB,OAAOL,CAAE;;;;;;;;;kBASGgB,GAA0B,GAAXJ,EAAeZ,CAAE;+BACnBkB,EAAK,KAAKF;uCACFA;;kBAEnBhB,CAAE;;;;oCAIcmC;;;;;;;+BAOLrB;;iCAEEF;mCACEQ;;;;;;;;+BAQJR,iBAAuBE;;;;;;;;;;;;;CAclD,CAEJ,CACA,EAAoBJ,GAAK,aACzB,EAAoBgC,MAAQ,gbA0B5B,UChIA,SAAS,EAAoBtF,GAAO,IAClCC,EAAG,IACHC,EAAG,QACHC,IAIA,OAAO,SAAUuC,GACLA,EAAKC,EAAb,IACIC,EAAKF,EAAKE,GACFF,EAAKG,MACPH,EAAKxC,IACAwC,EAAKI,SACJJ,EAAKK,UACRL,EAAKM,OACJN,EAAKvC,QACNuC,EAAKO,OAElB,OAAOL,CAAE;;;;;CAMX,CAEJ,CACA,EAAoBU,GAAK,aACzB,EAAoBgC,MAAQ,aAM5B,UClCA,SAAS,EAAoBtF,GAAO,EAClC2C,EAAC,IACD1C,EAAG,IACHC,EAAG,QACHC,IAEA,IAIIoF,EAGAC,EAPAC,EAAiBnF,WAAWC,UAAUC,IAAI,kBAC1CH,EAAgBC,WAAWC,UAAUC,IAAI,iBACzCkF,EAAepF,WAAWC,UAAUC,IAAI,gBACxCC,EAAUH,WAAWC,UAAUC,IAAI,UAAzBF,GAEVqF,EAAQ,EACRC,EAAW,EAEXC,GAAkB,EACR7F,EAAM8F,QACpB,MAGMC,EAAc9D,UAClB0D,QAAcF,EAAeM,YAAYP,EAAcI,SACjDzF,GAAS,EAEjBF,EAAI,kBAAkBgC,UACpB2D,EAAWpB,SAASP,EAAE+B,cAChBD,IACNE,EAAeL,EAAS,IAE1B,MAAMK,EAAiBC,IACrB,IAAIC,EAAW,EACfxD,EAAE,cAAcyD,MAAKC,IAEnB1D,EAAE0D,GAAKC,YAAY,YACfH,EAAWD,IACbvD,EAAE0D,GAAKE,SAAS,YAChBJ,IAEF,GACA,EAGEK,EAAevE,UAKnB,IAAIwE,EACJ,GALAxC,EAAEC,uBAGI7D,EAAckC,UAEhBsD,EAAiB,CACnB,IAAIa,EAAQlC,SAASe,EAAiBoB,YAAc,GACpDF,EAAehB,EAAemB,oBAAoBhB,EAAUc,EAC9D,MACED,EAAehB,EAAeoB,KAAKjB,GAErC,IAAIkB,EAAc,CAChBnG,MAAO,qEACPoG,QAASN,SAILf,EAAasB,iBAAiBF,EAAY,EAE5CG,EAAsBhF,UAC1B4D,EAAkB5B,EAAEE,cAAc+C,cAC5B/G,GAAS,EAEjBD,EAAImE,UAAUC,OACd,MAAM6C,EAAWlF,gBACT5B,EAAckC,UACpB,IACEgD,QAAyBE,EAAe2B,sBACxC5B,QAAqBC,EAAe4B,WAAW9B,EAAiB+B,UAAW,eACrEvB,IACN,IAAI9B,EAAI,IAAIsD,YAAY,0BACxBtD,EAAEsB,iBAAmBA,EACrBiC,SAASC,cAAcxD,GACvB/D,EAAImE,UAAUS,MAChB,CAAE,MAAO4C,GACPxH,EAAIyH,OAAOC,QAAQ,qGAAsG,gCAAiCT,GAAU,KAClKjH,EAAIuE,MAAMC,KAAKC,OAAOC,SAASnE,EAAQ,IAEzCP,EAAImE,UAAUS,MAChB,GAEFqC,IACA,IAAIU,EAAmB5F,UACrB,GAAIgC,EAAET,QAAU+B,GAAkBoB,YAAa,CAC7CpB,QAAyBE,EAAe2B,4BAClCjH,IACN,IAAI8D,EAAI,IAAIsD,YAAY,6BACxBtD,EAAEsB,iBAAmBA,EACrBtB,EAAE2B,SAAWA,EACb4B,SAASC,cAAcxD,EACzB,GAIF,OAFAuD,SAASM,oBAAoB,aAAcD,GAC3CL,SAASO,iBAAiB,aAAcF,GACjC,SAAUnF,GACLA,EAAKC,EAAb,IACIC,EAAKF,EAAKE,GACFF,EAAKG,MACPH,EAAKxC,IACAwC,EAAKI,SACJJ,EAAKK,UACRL,EAAKM,OACJN,EAAKvC,QACNuC,EAAKO,OAElB,OAAOL,CAAE;;;;MAIT2C,EAAmB3C,CAAE;;QAEnB2C,EAAiByC,QAAUpF,CAAE;;;;;;;;;;;;;;;;;;+CAkBU2C,EAAiBoB,kBAAkBpB,EAAiB0C;;;;;;;;+DAQpCzB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;6DA+BFjB,EAAiB+B;;;6DAGjB1B;;;0DAGHD;;;;;;;;;;0DAUAE,cAA4BoB;;;;;;;;;;;;;;;;;;;;8DAoBxBrB,EAAW,EAAI,WAAY;;;;;;;;;;;;;;;;;;;;;;;;;;;;QA4B/EhD,CAAE;;;;;;;;;;MAUJA,CAAE;;;;;;;;;;;;;;CAeN,CAEJ,CACA,EAAoBU,GAAK,aACzB,EAAoBgC,MAAQ,gTAuB5B,UC9RA,IAAI4C,EAGAC,EAFAC,EAAU,KACVC,EAAkB,CAAC,EAEnBC,EAAUrG,SACLkG,EAAYlE,GAErB,SAAS,EAAoBjE,GAAO,EAClC2C,EAAC,IACD1C,EAAG,IACHC,EAAG,QACHC,IAEAiI,EAAU,GACVC,EAAkB,CAAC,EACnBF,EAAclG,UACZiG,EAAmBjE,EAAEiE,iBACjBjE,EAAEoE,kBACJA,EAAkBpE,EAAEoE,gBACpB1F,EAAE,6BAA6B4D,SAAS,gCAEpCpG,GAAS,EAEjBqH,SAASM,oBAAoB,2BAA4BQ,GACzDd,SAASO,iBAAiB,2BAA4BO,GACtD,MAAMC,EAAkBtE,IACtBoE,EAAgBpE,EAAEE,cAAcqE,MAAQvE,EAAEE,cAAce,MACpDjB,EAAEE,cAAce,MAClBmD,EAAgBpE,EAAEE,cAAcqE,MAAQvE,EAAEE,cAAce,aAEjDmD,EAAgBpE,EAAEE,cAAcqE,MAIzC,IAAIC,EAAK,IAAIlB,YAAY,oCACzBkB,EAAGJ,gBAAkBA,EACrBb,SAASC,cAAcgB,EAAG,EAEtBC,EAAkBzG,UACtB,IAAI0G,EAAchG,EAAEsB,EAAEE,eAAeyE,KAAK,aACnCP,EAAgBM,SACjBxI,IAGN,IAAIsI,EAAK,IAAIlB,YAAY,oCACzBkB,EAAGJ,gBAAkBA,EACrBb,SAASC,cAAcgB,EAAG,EAE5B,OAAO,SAAU/F,GACLA,EAAKC,EAAb,IACIC,EAAKF,EAAKE,GACFF,EAAKG,MACPH,EAAKxC,IACAwC,EAAKI,SACJJ,EAAKK,UACRL,EAAKM,OACJN,EAAKvC,QACNuC,EAAKO,OAElB,OAAOL,CAAE;;;;;;;;UAQLiG,OAAOC,KAAKT,GAAiBnF,KAAI6F,GAAOnG,CAAE;;sCAEdmG,MAAQV,EAAgBU;sDACRL,eAA6BK;;;;;;;6EAONF,OAAOC,KAAKT,GAAiBzG;;;;;;;;;;;;;;;;;;;sBAmBpFsG,GAAkBhF,KAAK8F,GAAMpG,CAAE;;;+DAGUoG,EAAGC;;4CAEtBD,EAAGC,uBAAuBV;;gCAEtCS,EAAGE,QAAQhG,KAAKiG,GAAKvG,CAAE;kCACrBuG,EAAEjE,OAASmD,EAAgBW,EAAGC,WAAarG,CAAE;mDAC5BuG,EAAEjE,mBAAmBiE,EAAEjE,UAAUiE,EAAEC;kCAClDxG,CAAE;mDACauG,EAAEjE,UAAUiE,EAAEjE,UAAUiE,EAAEC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CA+BzE,CAEJ,CACA,EAAoB9F,GAAK,aACzB,EAAoBgC,MAAQ,2FAS5B,UCvJA,SAAS,EAAoBtF,GAAO,EAClC2C,EAAC,IACD1C,EAAG,IACHC,EAAG,QACHC,IAEA,IAAIkJ,EACAC,EAMJ,OALA9B,SAASO,iBAAiB,8BAA8B9F,UACtDoH,EAAapF,EAAEoF,WACfC,EAAerF,EAAEqF,mBACXnJ,GAAS,IAEV,SAAUuC,GACLA,EAAKC,EAAb,IACIC,EAAKF,EAAKE,GACFF,EAAKG,MACPH,EAAKxC,IACAwC,EAAKI,SACJJ,EAAKK,UACRL,EAAKM,OACJN,EAAKvC,QACNuC,EAAKO,OAElB,OAAOL,CAAE;;;;MAIT0G,EAAe1G,CAAE;;QAEf0G,GAAgBD,EAAazG,CAAE;kBACrB0G,cAAyBD;QACjCzG,CAAE;sBACUyG;;;MAGdzG,CAAE;;;;CAKN,CAEJ,CACA,EAAoBU,GAAK,aACzB,EAAoBgC,MAAQ,SAI5B,UCjDA,SAAS,EAAoBtF,GAAO,EAClC2C,EAAC,IACD1C,EAAG,IACHC,EAAG,QACHC,IAEA,IACIoF,EACAgE,EAAUvJ,EAAM8F,QAQpB,OAJAX,IAAIC,GAAG,8BAA8B,SAAUoE,GAC7CjE,EAAmBiE,EACnBrJ,GACF,IACO,SAAUuC,GACLA,EAAKC,EAAb,IARSoB,EASLnB,EAAKF,EAAKE,GACFF,EAAKG,MACPH,EAAKxC,IACAwC,EAAKI,SACJJ,EAAKK,UACRL,EAAKM,OACJN,EAAKvC,QACNuC,EAAKO,OAElB,OAAOL,CAAE;;;;;;QAMP2C,EAAmB3C,CAAE;;2CAEc2C,EAAiBoB,kBAAkBpB,EAAiB0C;;;mBA1BhFlE,EA6BS,YA5Bb,GAAGwF,EAAUxF;;QA8BdnB,CAAE;;;;;;;;;CAUR,CAEJ,CACA,EAAoBU,GAAK,aACzB,EAAoBgC,MAAQ,KAE5B,UCxDA,SAAS,EAAoBtF,GAAO,EAClC2C,EAAC,IACD1C,EAAG,IACHC,EAAG,QACHC,IAEoBG,WAAWC,UAAUC,IAAI,iBACxBF,WAAWC,UAAUC,IAAI,kBAD9C,IAEIiJ,EAAwBnJ,WAAWC,UAAUC,IAAI,yBACjDC,EAAUH,WAAWC,UAAUC,IAAI,UAAzBF,GACd,MAAMwD,EAAOC,GACJtD,EAAUsD,EAEnB,IAAI2F,EAAe1J,EAAM2J,cACzB,OAAO,SAAUjH,GACLA,EAAKC,EAAb,IACIC,EAAKF,EAAKE,GACFF,EAAKG,MACPH,EAAKxC,IACAwC,EAAKI,SACJJ,EAAKK,UACRL,EAAKM,OACJN,EAAKvC,QACNuC,EAAKO,OAElB,OAAOL,CAAE;;;;QAIP8G,GAAcE,OAAO1G,KAAK,CAAC2G,EAAMC,IAAUlH,CAAE;;;+BAGtBkH,EAAM;;;uBAGdhG,EAAK,KAAK+F,EAAKrG;0BACZM,EAAK,wBAAwB4F,EAAaK,kBAAkBF,EAAKrG,SAASwG,gBAAgBN,EAAaK,kBAAkBF,EAAKrG,SAASyG,oBAAsB,MAAQ,kBAAkBJ,EAAKrG;;;;;uBAK/LM,EAAK,KAAK+F,EAAKrG,iCAAiCkG,EAAaK,kBAAkBF,EAAKrG,SAAS7C;cACtG,IAAIuJ,KAAKC,aAAa,SAASC,OAAOP,EAAKQ,kBAAkBZ,EAAsBa,kBAAkBT,EAAKU,SAAU;gCAClGC,MAAMX,EAAKY,MAAML,OAAO;;;;;;;;CASpD,CAEJ,CACA,EAAoB9G,GAAK,aACzB,UCvDMoH,GAAW,CAAC1K,GAChB4C,SAEoBtC,WAAWC,UAAUC,IAAI,iBAA7C,IACIiJ,EAAwBnJ,WAAWC,UAAUC,IAAI,yBACrD,MAAMsD,EAAOC,GACJ,GAAGtD,EAAUsD,IAStB,IAAI4G,EAAc3K,EAAM2K,YACpBC,EAAQ5K,EAAM4K,MACdnK,EAAUT,EAAM6K,SAChBd,EAAoB/J,EAAM8K,qBAC1BhB,EAAQ9J,EAAM8J,MAClB,MAAO,IAAMlH,CAAE;;cAEHkH,EAAQ,GAAK,EAAI,kBAAoB;;;uBAG5BrJ,MAAYmK,EAAMpH;0BAjBrBuH,KAChB,GAAKA,EACL,OACSjH,EADLiH,GAAkBd,oBACR,wBAA0Bc,EAAiBf,aAAe,OAE5D,iCAAmCe,EAAiBf,aAAe,QAAQ,EAajEgB,CAAUjB,EAAkBa,EAAMpH,sCAAsCuG,EAAkBa,EAAMpH,UAAU7C;;;;;;uBAM7GF,MAAYmK,EAAMpH;gBACzBuG,EAAkBa,EAAMpH,UAAU7C;;;;;cAKpCiK,EAAMK,OAASrI,CAAE;iDACkB+H,EAAYO;cAC7CtI,CAAE;;gBAEF+H,GAAaQ,kBAAkBC,SAAWvC,OAAOC,KAAK6B,GAAaQ,kBAAkBC,SAASxJ,OAAS,EAAIgB,CAAE;mDAC1E+H,EAAYO,qDAAqDG,MAAMC,KAAKzC,OAAOC,KAAK6B,EAAYQ,kBAAkBC,SAASlI,KAAIqI,GAAKA,KAAIC,KAAK,SAASb,EAAYQ,kBAAkBM,WAAa,MAAQd,EAAYQ,iBAAiBM,WAAa;;gBAExR7I,CAAE;mDAC+B+H,EAAYO,yCAAyCN,EAAMA;;;;;8BAKhFJ,MAA8B,IAAxBG,EAAYe,WAAkBC;;;;;sCAK5BhB,EAAYQ,kBAAkBS,WAAWhB,EAAMpH,UAAUqI,MAAMC,QAAQ,MAAMnB,EAAYQ,kBAAkBS,WAAWhB,EAAMpH,UAAUuI;cAC9JpB,EAAYQ,kBAAkBS,WAAWhB,EAAMpH,UAAU+G,SAAW3H,CAAE;;2CAEzC6G,EAAsBa,kBAAkBK,EAAYQ,kBAAkBS,WAAWhB,EAAMpH,UAAU+G,SAAU;cACtI3H,CAAE;;;;uBAIKnC,eAAqBmK,EAAMoB,uBAAuBpB,EAAMoB,aAAerB,EAAYW,KAAO,UAAY;oBACzGW,GAAkBrB,EAAMoB;;;uBAGrBvL,eAAqBmK,EAAMsB,qBAAqBtB,EAAMsB,WAAavB,EAAYW,KAAO,UAAY;gBACzGW,GAAkBrB,EAAMsB;;;;;KAKnC,EAECC,GAAW,CAACnM,GAChB4C,SAEoBtC,WAAWC,UAAUC,IAAI,iBACjBF,WAAWC,UAAUC,IAAI,yBACrD,MAAMsD,EAAOC,GACJ,GAAGtD,EAAUsD,IAQtB,IAAI4G,EAAc3K,EAAM2K,YACpBC,EAAQ5K,EAAM4K,MACdnK,EAAUT,EAAM6K,SAChBd,EAAoB/J,EAAM8K,qBAC1BhB,EAAQ9J,EAAM8J,MAEdsC,GADQxB,GAAOyB,WAAWC,MACf1B,GAAOyB,WAAWD,UACtBzB,GAAaW,KACxB,MAAO,KAAM1I,QAAE;mBACEkH,EAAQ,GAAK,EAAI,UAAY;;;uBAGzBrJ,MAAYmK,EAAMpH;0BAlBrBuH,EAmBgBhB,EAAkBa,EAAMpH,SAlBpDuH,EAAiBd,oBACZnG,EAAK,wBAA0BiH,EAAiBf,aAAe,QAEjElG,EAAK,iCAAmCiH,EAAiBf,aAAe,qCAeeD,EAAkBa,EAAMpH,SAAS7C;;;;;;uBAM5GF,MAAYmK,EAAMpH;gBACzBuG,EAAkBa,EAAMpH,SAAS7C;;;;;;+CAMFgK,EAAYO,yCAAyCN,EAAMA;;8BAE5EJ,MAA8B,IAAxBG,EAAYe,WAAkBC;;;;;0BAKxCS;;;MAvCNrB,KA0Cf,GAECwB,GAAiB,CAACvM,GACtB4C,SAEoBtC,WAAWC,UAAUC,IAAI,iBACjBF,WAAWC,UAAUC,IAAI,yBADrD,IAEImK,EAAc3K,EAAM2K,YACpBC,EAAQ5K,EAAM4K,MACdnK,EAAUT,EAAM6K,SAChBf,EAAQ9J,EAAM8J,MAClB,MAAO,IAAMlH,CAAE;qBACIkH,EAAQ,GAAK,EAAI,UAAY;;;cAGpCc,EAAMyB,UAAUD,SAAWxJ,CAAE,KAAOA,CAAE;;;;;;;gDAOJ+H,EAAYO,yCAAyCN,EAAMA;;+BAE5EJ,MAA8B,IAAxBG,EAAYe,WAAkBC;;;;;uBAK5ClL,eAAqBmK,EAAMyB,UAAUC,iBAAiB1B,EAAMyB,UAAUC,OAAS3B,EAAYW,KAAO,UAAY,OAAOW,GAAkBrB,EAAMyB,UAAUC;;uBAEvJ7L,eAAqBmK,EAAMyB,UAAUG,oBAAoB5B,EAAMyB,WAAWG,UAAY7B,EAAYW,KAAO,UAAY,OAAOW,GAAkBrB,EAAMyB,UAAUG;;;;KAIhL,EAECP,GAAoBlK,IACxB,IAAI1B,EAAgBC,WAAWC,UAAUC,IAAI,iBAC7C,OAAIiM,IAAuBC,KAAOD,GAAsBC,IAAI3K,GAAiB0K,GAAsBC,IAAI3K,GAChG1B,EAAcyB,mBAAmBC,EAAQ,EAElD,IAAI0K,GACA,GACA,GAAUxK,SACL,GAAYgC,GAErB,SAAS,GAAoBjE,GAAO,EAClC2C,EAAC,IACD1C,EAAG,IACHC,EAAG,QACHC,IAEoBG,WAAWC,UAAUC,IAAI,iBAA7C,IACIC,EAAUH,WAAWC,UAAUC,IAAI,UAAzBF,GACdmM,GAAwBzM,EAAM2M,aAC9B,IAAI5C,EAAoB/J,EAAM4M,MAC1BpJ,EAAUxD,EAAM6M,MASpB,OARA,GAAc5K,UACZwK,GAAwBxI,EAAEwI,4BACpBtM,GAAS,EAIjBqH,SAASM,oBAAoB,uBAAwB,IACrDN,SAASO,iBAAiB,uBAAwB,IAC3C,SAAUrF,GACLA,EAAKC,EAAb,IACIC,EAAKF,EAAKE,GACFF,EAAKG,MACPH,EAAKxC,IACAwC,EAAKI,SACJJ,EAAKK,UACRL,EAAKM,OACJN,EAAKvC,QACNuC,EAAKO,OAElB,OAAOL,CAAE;;;;;;;;;;;;;;;;;YAiBH6J,IAAuBE,aAAazJ,KAAK,CAACyH,EAAab,IAAUlH,CAAE;;cAEjE+H,EAAYmC,QAAQ5J,KAAI6J,GAAkBnK,CAAE;;gBAElB,YAAxBmK,EAAenC,OAAyBpH,GAAWuJ,GAAgBvJ,SAAWA,EAE5EZ,CAAE,IAFqFA,CAAE;mBACxFuJ,kBAAwBxB,EAAYA,qBAAqBoC,cAA2BtM,0BAAgCsJ,YAA4BD;;;gBAG3H,YAAxBiD,EAAenC,OAAyBpH,GAAWuJ,GAAgBvJ,SAAWA,EAE5EZ,CAAE,IAFqFA,CAAE;mBACxF8H,kBAAwBC,EAAYA,qBAAqBoC,cAA2BtM,0BAAgCsJ,YAA4BD;;;gBAG3H,kBAAxBiD,EAAenC,OAA+BpH,GAAWuJ,GAAgBvJ,SAAWA,EAElFZ,CAAE,IAF2FA,CAAE;mBAC9F2J,kBAA8B5B,EAAYA,qBAAqBoC,cAA2BtM,YAAkBqJ;;;;;;;;;;;;;CAc3H,CAEJ,CACA,GAAoBxG,GAAK,aACzB,GAAoBgC,MAAQ,OAG5B,YC/PA,SAAS,GAAoBtF,GAAO,EAClC2C,EAAC,IACD1C,EAAG,IACHC,EAAG,QACHC,IAEA,IAAIsJ,EAAwBnJ,WAAWC,UAAUC,IAAI,yBACjDH,EAAgBC,WAAWC,UAAUC,IAAI,iBACzCC,EAAUH,WAAWC,UAAUC,IAAI,UAAzBF,GACV0M,EAAchN,EAAMiN,aACxB,OAAO,SAAUvK,GACLA,EAAKC,EAAb,IACIC,EAAKF,EAAKE,GACFF,EAAKG,MACPH,EAAKxC,IACAwC,EAAKI,SACJJ,EAAKK,UACRL,EAAKM,OACJN,EAAKvC,QACNuC,EAAKO,OAElB,OAAOL,CAAE;;;;MAIToK,GAAa9J,KAAIgK,GAAKtK,CAAE;;;kBAGZsK,EAAEC;;;;;kBAKFD,EAAEE,QAAUxK,CAAE;+BACDnC,eAAqByM,EAAEhC,QAAQgC,EAAEE;kBAC5CxK,CAAE;+BACSnC,eAAqByM,EAAEhC,QAAQgC,EAAEhC,IAAM7K,EAAcyB,mBAAmBoL,EAAEhC,KAAO;;;;;;;kBAO9FgC,EAAE9D;;;;0CAIsB,IAAIc,KAAKC,aAAa,SAASC,OAAO8C,EAAEG,aAAaC,MAAMjD,SAAW6C,EAAEG,aAAaC,MAAMjD,SAAW;6CACnGZ,EAAsBa,kBAAkB4C,EAAEG,aAAaC,MAAM/C,SAAW2C,EAAEG,aAAaC,MAAM/C,SAAW,EAAG;;;;0CAI9G,IAAIL,KAAKC,aAAa,SAASC,OAAO8C,EAAEG,aAAazD,OAAOS,SAAW6C,EAAEG,aAAazD,OAAOS,SAAW;6CACrGZ,EAAsBa,kBAAkB4C,EAAEG,aAAazD,OAAOW,SAAW2C,EAAEG,aAAazD,OAAOW,SAAW,EAAG;;;;kBAIxI2C,EAAEK,WAAa/C,MAAM0C,EAAEK,YAAY5B,UAAY;;;;;;;;;CAU7D,CAEJ,CACA,GAAoBrI,GAAK,aACzB,YCvEA,SAAS,GAAoBtD,GAAO,EAClC2C,EAAC,IACD1C,EAAG,IACHC,EAAG,QACHC,IAEA,IAAIqN,EAAiBlN,WAAWC,UAAUC,IAAI,kBAC1CC,EAAUH,WAAWC,UAAUC,IAAI,UAAzBF,GACd,MAAMwD,EAAOC,GACJtD,EAAUsD,EAEnB,IAAI0J,EACAC,GAAY,EAChB,MAAMC,EAAkB1L,UACtBgC,EAAEC,iBACFvB,EAAE,oBAAoBiL,OACtB1N,EAAImE,UAAUwJ,OAAO,eACrBH,GAAY,EACZvN,IACAsN,QAAgBD,EAAeM,MAAMnL,EAAE,oBAAoByB,OAC3DsJ,GAAY,EACZvN,IACAD,EAAImE,UAAU0J,OAAO,cAAc,EAErC,OAAO,SAAUrL,GACLA,EAAKC,EAAb,IACIC,EAAKF,EAAKE,GACFF,EAAKG,MACPH,EAAKxC,IACAwC,EAAKI,SACJJ,EAAKK,UACRL,EAAKM,OACJN,EAAKvC,QACNuC,EAAKO,OAElB,OAAOL,CAAE;;;;;;;;yCAQ0B+K;;;;;;;;;;;;;;;;;;;UAmB/BF,EAAU7K,CAAE;;YAET6K,GAAS7L,OAAS,EAAIgB,CAAE;;cAEvB6K,GAASvK,KAAM8K,GAAkBpL,CAAE;;;oBAG7BoL,EAAcC,KAAKC,QAAUtL,CAAE;;;;;;mDAMAkB,EAAK,SAASkK,EAAcC,KAAKzK;gCACpDwK,EAAcC,KAAKtN;qEACkBqN,EAAcC,KAAKzK;;;0CAG9CwK,EAAcC,KAAKC;;;;;;wBAMrCF,EAAcG,WAAavL,CAAE;;mDAEFkB,EAAK,SAASkK,EAAcC,KAAKzK;6DACvBwK,EAAcG,WAAWjD,OAAO8C,EAAcG,WAAWC,UAAY,MAAQ;;;wBAGhHxL,CAAE;;;;;oBAKNA,CAAE;;;;;mDAK2BkB,EAAK,KAAKkK,EAAcC,KAAKzK;8BAClDwK,EAAcC,KAAKtN,8CAA8CqN,EAAcC,KAAKzK;;;4DAGtDwK,EAAcC,KAAKI;;;;;;;;;;;YAWjEzL,CAAE;;;;;;;;;UASLA,CAAE;;;;;;;;;;CAWT,CAEJ,CACA,GAAoBU,GAAK,aACzB,GAAoBgC,MAAQ,yEAQ5B,YCrJA,SAAS,GAAoBtF,GAAO,EAClC2C,EAAC,IACD1C,EAAG,IACHC,EAAG,QACHC,IAEA,IAAIoJ,EAAUvJ,EAAM8F,QAChB8G,EAAQ5M,EAAM4M,MAClB,MAAM9I,EAAOC,GACJ,GAAGwF,EAAUxF,IAEtB,OAAO,SAAUrB,GACLA,EAAKC,EAAb,IACIC,EAAKF,EAAKE,GACFF,EAAKG,MACPH,EAAKxC,IACAwC,EAAKI,SACJJ,EAAKK,UACRL,EAAKM,OACJN,EAAKvC,QACNuC,EAAKO,OAElB,OAAOL,CAAE;;;;UAILgK,GAAOhL,OAAS,EAAIgB,CAAE;;cAElBgK,EAAM1J,KAAI8K,GAAiBpL,CAAE;;;;;2CAKAkB,EAAK,SAASkK,EAAcC,KAAKzK;gDAC5BM,EAAK,wBAAwBkK,EAAcG,WAAWjD,UAAU8C,EAAcG,WAAWC,UAAY,MAAQ;;;;;6CAKhHJ,EAAcC,KAAKtN,MAAQqN,EAAcC,KAAKtN,MAAQ,IAAM,OAAOqN,EAAcC,KAAKzK;;;;;;;;UAQvHZ,CAAE;;;;CAKV,CAEJ,CACA,GAAoBU,GAAK,aACzB,GAAoBgC,MAAQ,KAE5B,Y,whBCvDA,IACMgJ,GADN,MAWiCC,UACDC,YACEtO,IAVzBoC,OACAP,QACA0M,gBAAsB,CAAC,EAEvBtM,SAGPuM,YAC+BH,EACDC,EACEtO,GAFD,KAAAqO,UAAAA,EACD,KAAAC,YAAAA,EACE,KAAAtO,IAAAA,CAGhC,CAEA+B,qBAEE0M,KAAKxM,eAAiBwM,KAAKH,cAE3BlO,WAAWsO,UAAUxJ,GAAG,mBAAmBnD,MAAO4M,WAEzCF,KAAK5M,QAER8M,GAAUjN,OAAS,SACf+M,KAAKlM,aAGbkM,KAAKzO,IAAIuE,MAAMC,KAAKC,OAAOmK,aAAa,IAI1CxO,WAAWsO,UAAUxJ,GAAG,kBAAkBnD,MAAO8M,IAC/CJ,KAAKF,gBAAkB,CAAC,EACxBE,KAAKxM,eAAiBwM,KAAKH,oBAErBG,KAAKlM,YAAY,GAK3B,CAEAR,mBAEE+M,QAAQC,IAAI,sBAELN,KAAK5M,QAGP4M,KAAKxM,gBACFwM,KAAKvM,eAIb,IAAIyM,QAAiBF,KAAKxM,SAAS+M,KAAK,eAAgB,IAExD,GAAIL,GAAUjN,OAAS,EAErB,OAAO+M,KAAKpM,UAGdyM,QAAQC,IAAI,uBAGd,CAGAhN,gBAEE+M,QAAQC,IAAI,wBAENN,KAAKxM,SAAS+M,KAAK,sBAAuB,IAEhDP,KAAKrM,aAAeqM,KAAKxM,SAASgN,YAClCR,KAAK5M,cAAgB4M,KAAKtM,aAE1B2M,QAAQC,IAAI,UAAUN,KAAK5M,oBAE7B,CAEAE,mBAEI,IAAK0M,KAAKxM,SAAU,OAEpB,IAAI0M,QAAiBF,KAAKxM,SAAS+M,KAAK,eAAgB,IAExD,OAAIL,GAAUjN,OAAS,GACd,QAAWiN,EAAS,SAD7B,CAIJ,CAEA5M,kBACE,OAAO0M,KAAKxM,SAASgN,WACvB,CAEAlN,kBAAkBuG,GAEhB,IAGI4G,SAHkBT,KAAKJ,aAGT/F,GAKlB,OAJAmG,KAAKF,gBAAgBjG,GAAQ,IAAI,MAAS4G,EAAErN,QAASqN,EAAEC,IAAKV,KAAKrM,OAASqM,KAAKrM,OAASqM,KAAKxM,UAItFwM,KAAKF,gBAAgBjG,EAC9B,CAGA1G,mBAAmBC,GACjB,IAAKA,EAAS,OAEd,MACMuN,EAAQvN,EAAQuN,MADA,oDAEtB,OAAKA,EACE,GAAGA,EAAM,MAAMA,EAAM,KADTvN,CAErB,GAvHIuM,GAAiB,KADtB,EAAAiB,GAAA,KAWI,QAAAC,GAAA,GAAO,cACP,QAAAA,GAAA,GAAO,aACP,QAAAA,GAAA,GAAO,e,wBAF+BC,SACCA,SAAQ,UAX9CnB,I,4eCFN,IACMoB,GADN,MAMmCjP,QACCC,SACDiP,QACEC,UANjCC,QAAU,CAAC,EAEXnB,YAC+BjO,EACCC,EACDiP,EACEC,GAHF,KAAAnP,QAAAA,EACC,KAAAC,SAAAA,EACD,KAAAiP,QAAAA,EACE,KAAAC,UAAAA,CAE9B,CAEH3N,kBAAkB6N,GAEd,IAAIH,QAAgBhB,KAAKgB,UAGzB,MAAMI,EAAW,WAAWpB,KAAKiB,eAAeE,EAAOtH,OAEvD,GAAImG,KAAKkB,QAAQE,GAAW,OAAOpB,KAAKkB,QAAQE,GAGhDpB,KAAKkB,QAAQE,GAAY,IAAIJ,EAAQI,GAErC,MAAMC,QAAgBrB,KAAKkB,QAAQE,GAAUE,OAG7C,GAAyB,GAArBD,EAAQE,WAAwC,GAAtBF,EAAQG,WAAiB,CAGnD,GAAIL,EAAOM,WAAY,CAEnBpB,QAAQC,IAAI,wBAAwBc,KAEpC,IAAIM,EAAiC,CACjCnF,IAAK,oBACLoF,IAAK,IAGT,IAAK,IAAIC,KAAaT,EAAOM,iBACnBG,EAAUA,UAAU5B,KAAKkB,QAAQE,IACvCM,EAAgBC,IAAIE,KAAKD,EAAUjN,IACnC0L,QAAQC,IAAI,4BAA4BsB,EAAUjN,YAIhDqL,KAAKkB,QAAQE,GAAUU,IAAIJ,E,CAMjCP,EAAOY,sBACD/B,KAAKgC,mBAAmBb,EAAQC,E,MAO1C,GAAID,EAAOM,WAAY,CAEnB,IAAIC,EAEJ,IACIA,QAAwB1B,KAAKkB,QAAQE,GAAUvP,IAAI,oB,CACrD,MAAMkH,GAAI,CAEP2I,IACDA,EAAkB,CACdnF,IAAK,oBACLoF,IAAK,KAKb,IAAIM,GAAU,EAEd,IAAK,IAAIL,KAAaT,EAAOM,WAGzB,IAAKC,EAAgBC,IAAIO,SAASN,EAAUjN,IAAK,CAE7C,UAGUiN,EAAUA,UAAU5B,KAAKkB,QAAQE,G,CACzC,MAAMrI,GAAM,CAGd2I,EAAgBC,IAAIE,KAAKD,EAAUjN,IAEnCsN,GAAU,EAEV5B,QAAQC,IAAI,4BAA4BsB,EAAUjN,K,CAMtDsN,IACA5B,QAAQC,IAAI,0BAA2BoB,SACjC1B,KAAKkB,QAAQE,GAAUU,IAAIJ,G,CAa7C,OAAO1B,KAAKkB,QAAQE,EAExB,CAEQ9N,yBAAyB6N,EAAwBC,GAErD,IAAIe,EAGAA,EADAhB,EAAOiB,yBACUC,MAAM,GAAGrC,KAAKjO,aAAaiO,KAAKlO,YAAYqP,EAAOiB,4BAEnDC,MAAM,GAAGrC,KAAKjO,aAAaiO,KAAKlO,iCAAiCqP,EAAOtH,aAG7F,IAAIkI,QAAuBI,EAASG,OAGhCP,GAAgB9O,OAAS,IACzBoN,QAAQC,IAAI,WAAWyB,GAAgB9O,8BAA8BmO,WAC/DpB,KAAKkB,QAAQE,GAAUmB,SAASR,GAG9C,GAzIEhB,GAAe,KADpB,EAAAH,GAAA,KAMQ,QAAAC,GAAA,GAAO,YACP,QAAAA,GAAA,GAAO,aACP,QAAAA,GAAA,GAAO,YACP,QAAAA,GAAA,GAAO,c,wBAH2BC,SACEA,SAAQ,OAENA,YARzCC,I,4eCCN,IACMyB,GADN,MAqBmC1Q,QACCC,SAnBhC0P,WAAyB,CAAC,CACtB9M,GAAI,IACJiN,UAAWtO,MAAOmP,UAERA,EAAGC,YAAY,CAAEvH,MAAO,CAAEwH,OAAQ,CAAC,wBACnCF,EAAGC,YAAY,CAAEvH,MAAO,CAAEwH,OAAQ,CAAC,iBAAmB,IAMpEF,GACAG,OAAgB,WAGRC,gBAER9C,YAC+BjO,EACCC,GADD,KAAAD,QAAAA,EACC,KAAAC,SAAAA,CAC7B,CAEHuB,aACI0M,KAAKyC,SAAWzC,KAAK6C,gBAAgBC,YAAY,CAC7CjJ,KAAMmG,KAAK4C,OACXnB,WAAYzB,KAAKyB,WACjBM,gBAAgB,GAExB,CAGAzO,YAEI,IAIIyP,EAJAC,QAAiBhD,KAAKyC,GAAGQ,QAAQ,CACjCC,cAAc,IAMlB,IAAK,IAAIzC,KAAKuC,EAASG,KACf1C,EAAE2C,IAAIC,cAAaN,EAAUtC,EAAE2C,KAQvC,MAAME,QAAyBC,EAAA,EAAM1R,IAAI,GAAGmO,KAAKjO,aAAaiO,KAAKlO,0CAOnE,OAJIwR,GAAkBrJ,OAClB8I,EAAQS,gBAAkBF,EAAiBrJ,KAAKuJ,iBAG7CT,CACX,GA1CQ,KADP,EAAAlC,GAAA,GAAO,mB,iBACiBE,K,uCAjBvByB,GAA4B,KADjC,EAAA5B,GAAA,KAqBQ,QAAAC,GAAA,GAAO,YACP,QAAAA,GAAA,GAAO,a,wBAD2BC,SACEA,YArBvC0B,ICJN,MAAMiB,GACFlH,IACAmH,KACAzC,UACApM,QACA7C,MACAmD,KACAwO,YACAC,QACAlE,YACAH,QACAsE,SACAC,SACAC,oBACA1I,aACA2I,sBACAC,uBACAC,YACAC,cACAd,YACAe,Y,4eCbJ,IACMC,GADN,MAkCmCvS,QACCC,SAhChCuS,kBCVa,GDYb7C,WAAyB,CACrB,CACI9M,GAAI,IACJiN,UAAWtO,MAAOmP,UAERA,EAAGC,YAAY,CACjBvH,MAAO,CACHwH,OAAQ,CAAC,aAEf,IAadF,GACAG,OAAgB,QAGRC,gBAER9C,YAC+BjO,EACCC,GADD,KAAAD,QAAAA,EACC,KAAAC,SAAAA,CAC7B,CAEHuB,aACI0M,KAAKyC,SAAWzC,KAAK6C,gBAAgBC,YAAY,CAC7CjJ,KAAMmG,KAAK4C,OACXnB,WAAYzB,KAAKyB,WACjBM,gBAAgB,GAExB,CAGAzO,UAAUiJ,GACN,OAAOrC,OAAOqK,OAAO,IAAId,SAAczD,KAAKyC,GAAG5Q,IAAI0K,GACvD,CAIAjJ,UAAUgM,SACAU,KAAKyC,GAAGX,IAAIxC,EACtB,CAEAhM,WAAWkR,EAAcC,EChEZ,ID2ET,aATqBzE,KAAKyC,GAAGiC,KAAK,CAC9BC,SAAU,CACN9P,QAAS,CAAE+P,SAAS,IAExBC,KAAM,CAAC,CAAE,QAAW,QACpBJ,MAAOA,EACPD,KAAMA,KAGMM,IAEpB,CAEAxR,mBAAmBuB,GAEf,IAAIsN,QAAiBnC,KAAKyC,GAAGiC,KAAK,CAC9BC,SAAU,CACN9P,QAAS,CAAEkQ,IAAKlQ,IAEpB4P,MAAO,IAGX,GAAItC,EAAS2C,MAAM7R,OAAS,EACxB,OAAOkP,EAAS2C,KAAK,EAI7B,CAEAxR,oBAAoBqO,GAEhB,IAAIQ,QAAiBnC,KAAKyC,GAAGiC,KAAK,CAC9BC,SAAU,CACN9P,QAAS,CAAEmQ,IAAKrD,MAIxB,OAAIQ,EAAS2C,MAAM7R,OAAS,EACjBkP,EAAS2C,KAET,EAEf,CAGAxR,sCAAsCgH,EAAkB/D,EAAc0O,GAElE,MAAMC,EAAUC,GACLA,EAAEC,QAAQ,cAAe,KAAKC,cAGzC,IAAIC,EAMJ,OAFAA,SAFuB/B,EAAA,EAAM1R,IAAI,GAAGmO,KAAKjO,aAAaiO,KAAKlO,6BAA6BoT,EAAO5K,MAAc4K,EAAO3O,MAAU0O,WAE1GhL,KAEbqL,CACX,CAEAhS,kCAAkCF,EAAgB6R,GAE9C,IAAIK,EAMJ,OAFAA,SAFuB/B,EAAA,EAAM1R,IAAI,GAAGmO,KAAKjO,aAAaiO,KAAKlO,4BAA4BsB,YAAkB6R,WAErFhL,KAEbqL,CACX,CAEAhS,qCAAqCiS,GAEjC,IAAItH,EAA2B,GAE/B,IAAK,IAAIpJ,KAAW0Q,EAAU,CAC1B,MAAMpD,QAAiBoB,EAAA,EAAM1R,IAAI,GAAGmO,KAAKjO,aAAaiO,KAAKlO,cAAc+C,2BACzEoJ,EAAM4D,KAAKM,EAASlI,K,CAGxB,OAAOgE,CACX,CAEA3K,oCAAoCuB,GAGhC,aADuB0O,EAAA,EAAM1R,IAAI,GAAGmO,KAAKjO,aAAaiO,KAAKlO,cAAc+C,4BACzDoF,IAEpB,CAIA3G,oBAAoBkS,EAAqBf,GAUrC,aARqBzE,KAAKyC,GAAGiC,KAAK,CAC9BC,SAAU,CACN9P,QAAS,CAAEkQ,IAAKS,IAEpBX,KAAM,CAAC,CAAE,QAAW,SACpBJ,MAAOA,KAGKK,IAEpB,CAEAxR,YAAY6L,GAyBR,aAvBqBa,KAAKyC,GAAGgD,OAAO,CAChCtG,MAAOA,EACPwD,OAAQ,CAAC,cAAe,QAAS,WACjCO,cAAc,EACdwC,cAAc,EACdjB,MCnLK,MDuLWtB,KAAK5O,KAAKoR,IAEtBA,EAAID,aAAahG,cACjBiG,EAAIvC,IAAI1D,YAAciG,EAAID,aAAahG,aAI3CiG,EAAIvC,IAAI1D,YAAciG,EAAIvC,IAAI1D,YAAY0F,QAAQ,aAAa,IAGxDO,EAAIvC,MAMnB,CAIA9P,YAUI,aATqB0M,KAAKyC,GAAGiC,KAAK,CAC9BC,SAAU,CACN9P,QAAS,CAAE+P,SAAS,IAExBC,KAAM,CAAC,CAAE,QAAW,QACpBJ,MAAO,IACPD,KAAM,KAGMM,IACpB,GAhLQ,KADP,EAAAjE,GAAA,GAAO,mB,iBACiBE,K,uCA9BvBsD,GAAyB,KAD9B,EAAAzD,GAAA,KAkCQ,QAAAC,GAAA,GAAO,YACP,QAAAA,GAAA,GAAO,a,wBAD2BC,SACEA,YAlCvCuD,IEVN,MAAMuB,GAEJrJ,IACAmH,KACAjS,cACAoI,KACA8J,YACAkC,IACAC,aACAzC,YACAe,Y,2bCNF,IACM2B,GADN,MAGItD,GACAG,OAAgB,UAGRC,gBAERvP,aACI0M,KAAKyC,SAAWzC,KAAK6C,gBAAgBC,YAAY,CAC7CjJ,KAAMmG,KAAK4C,OACXb,gBAAgB,GAExB,CAEAhC,cACG,CAGHzM,UAAUiJ,GACN,OAAOrC,OAAOqK,OAAO,IAAIqB,SAAgB5F,KAAKyC,GAAG5Q,IAAI0K,GACzD,GAfQ,KADP,EAAAsE,GAAA,GAAO,mB,iBACiBE,K,uCANvBgF,GAA2B,KADhC,EAAAnF,GAAA,K,4BACKmF,ICJN,MAAMC,GAEFnR,QAEAgF,KACA8J,YAEAsC,MACAC,WAEAC,aAEAC,WAEAC,iBACAC,c,4eCZJ,IACMC,GADN,MAMmCzU,QACCC,SAJhCuS,kBAAoB,GAEpBvE,YAC+BjO,EACCC,GADD,KAAAD,QAAAA,EACC,KAAAC,SAAAA,CAC7B,CAEHuB,UAAUuB,GACN,MAAMsN,QAAiBoB,EAAA,EAAM1R,IAAI,GAAGmO,KAAKjO,aAAaiO,KAAKlO,4BAA4B+C,UACvF,OAAOqF,OAAOqK,OAAO,IAAIyB,GAAe7D,EAASlI,KACrD,GAZEsM,GAA6B,KADlC,EAAA3F,GAAA,KAMQ,QAAAC,GAAA,GAAO,YACP,QAAAA,GAAA,GAAO,a,wBAD2BC,SACEA,YANvCyF,ICNN,MAAMC,GACFjK,IACAtC,KACAwM,IACAC,OACAC,IACAlH,U,2bCDJ,IACMmH,GADN,MAGInE,GACAG,OAAgB,SAGRC,gBAERvP,aACI0M,KAAKyC,SAAWzC,KAAK6C,gBAAgBC,YAAY,CAC7CjJ,KAAMmG,KAAK4C,OACXb,gBAAgB,GAExB,CAEAhC,cACG,CAGHzM,UAAUiJ,GACN,OAAOrC,OAAOqK,OAAO,IAAIiC,SAAexG,KAAKyC,GAAG5Q,IAAI0K,GACxD,CAEAjJ,aAEA,GAnBQ,KADP,EAAAuN,GAAA,GAAO,mB,iBACiBE,K,uCANvB6F,GAA0B,KAD/B,EAAAhG,GAAA,K,4BACKgG,ICLN,MAAMC,GAEFtK,IACAmH,KACAE,QACA6C,IACApD,Y,2bCFJ,IACMyD,GADN,MAGIrE,GACAG,OAAgB,aAGRC,gBAERvP,aACI0M,KAAKyC,SAAWzC,KAAK6C,gBAAgBC,YAAY,CAC7CjJ,KAAMmG,KAAK4C,OACXb,gBAAgB,GAExB,CAEAhC,cACG,CAGHzM,UAAUiJ,GACN,OAAOrC,OAAOqK,OAAO,IAAIsC,SAAmB7G,KAAKyC,GAAG5Q,IAAI0K,GAC5D,GAfQ,KADP,EAAAsE,GAAA,GAAO,mB,iBACiBE,K,uCANvB+F,GAA8B,KADnC,EAAAlG,GAAA,K,4BACKkG,ICLN,MAAMC,GACJxK,IACAmH,KACAzC,UACApH,KACAmN,KACApD,QACAlE,YACAuH,gBACAC,UACA7D,YACAe,Y,2bCLF,IACM+C,GADN,MAGI1F,WAAyB,CAAC,CACtB9M,GAAI,IACJiN,UAAWtO,MAAOmP,UAERA,EAAGC,YAAY,CACjBvH,MAAO,CACHwH,OAAQ,CAAC,sBAGXF,EAAGC,YAAY,CACjBvH,MAAO,CACHwH,OAAQ,CAAC,iBAEf,IAOVF,GACAG,OAAgB,eAGRC,gBAER9C,cAAe,CAEfzM,aACI0M,KAAKyC,SAAWzC,KAAK6C,gBAAgBC,YAAY,CAC7CjJ,KAAMmG,KAAK4C,OACXnB,WAAYzB,KAAKyB,WACjBM,gBAAgB,GAExB,CAGAzO,UAAUiJ,GACN,OAAOrC,OAAOqK,OAAO,IAAIwC,SAAoB/G,KAAKyC,GAAG5Q,IAAI0K,GAC7D,CAEAjJ,qBAAqB8T,EAAiB5C,GAWlC,aATqBxE,KAAKyC,GAAGiC,KAAK,CAC9BC,SAAU,CACNuC,UAAW,CAAEG,KAAM,CAACD,IACpB/D,YAAa,CAAEuB,SAAS,IAE5BC,KAAM,CAAC,CAAE,YAAe,QACxBL,KAAMA,KAGMM,IACpB,GA7BQ,KADP,EAAAjE,GAAA,GAAO,mB,iBACiBE,K,uCA1BvBoG,GAA+B,KADpC,EAAAvG,GAAA,K,4BACKuG,I,4eCHN,IACMG,GADN,MAImCxV,QACCC,SAFhCgO,YAC+BjO,EACCC,GADD,KAAAD,QAAAA,EACC,KAAAC,SAAAA,CAC7B,CAEHuB,UAAU2R,GAIN,aAFuB1B,EAAA,EAAM1R,IAAI,GAAGmO,KAAKjO,aAAaiO,KAAKlO,sBAAsBmT,WAEjEhL,IACpB,GAZEqN,GAA6B,KADlC,EAAA1G,GAAA,KAIQ,QAAAC,GAAA,GAAO,YACP,QAAAA,GAAA,GAAO,a,wBAD2BC,SACEA,YAJvCwG,ICNN,MAAMC,GACFhL,IACAjC,UACA/D,MACAkE,MACA+M,gBACAjC,S,2bCDJ,IACMkC,GADN,MAGIhF,GACAG,OAAgB,mBAGRC,gBAERvP,aACI0M,KAAKyC,SAAWzC,KAAK6C,gBAAgBC,YAAY,CAC7CjJ,KAAMmG,KAAK4C,OACXb,gBAAgB,EAChBK,mBAAoB,wBAE5B,CAEArC,cACG,CAGHzM,UAAUiJ,GACN,OAAOrC,OAAOqK,OAAO,IAAIgD,SAAwBvH,KAAKyC,GAAG5Q,IAAI0K,GACjE,CAEAjJ,eAAeqO,GAEX,IAAI7C,QAAgBkB,KAAKyC,GAAGQ,QAAQ,CAChC9I,KAAMwH,EACNuB,cAAc,IAGlB,OAAOpE,EAAQqE,MAAM5O,KAAKmT,GAAKA,EAAEtE,KAErC,CAGA9P,UAAUqU,SACA3H,KAAKyC,GAAGX,IAAI6F,EACtB,CAEArU,WAAWmR,EAAeD,GAUtB,aARqBxE,KAAKyC,GAAGiC,KAAK,CAC9BC,SAAU,CACNlK,MAAO,CAAEmK,SAAS,IAEtBH,MAAOA,EACPD,KAAMA,KAGMM,IAEpB,GA9CQ,KADP,EAAAjE,GAAA,GAAO,mB,iBACiBE,K,uCANvB0G,GAAmC,KADxC,EAAA7G,GAAA,K,4BACK6G,I,scCHN,MAAMG,GAGFrL,IAGAmH,KAGAzO,YAGA4S,aAGAxE,YAGAe,YAfA,KADC,EAAA0D,GAAA,K,qDAID,KADC,EAAAA,GAAA,K,sDAID,KADC,EAAAA,GAAA,K,6DAID,KADC,EAAAA,GAAA,K,8DAID,KADC,EAAAA,GAAA,K,6DAID,KADC,EAAAA,GAAA,K,wfCfL,IACMC,GADN,MAGItF,GACAG,OAAgB,kBAGRC,gBAERvP,aACI0M,KAAKyC,SAAWzC,KAAK6C,gBAAgBC,YAAY,CAC7CjJ,KAAMmG,KAAK4C,OACXb,gBAAgB,GAExB,CAEAhC,cACG,CAEHzM,UAAU0U,GAGNA,EAAezL,IAAM,wBAEfyD,KAAKyC,GAAGX,IAAIkG,EACtB,CAGA1U,YAEI,IAAI2U,EAEJ,IACIA,QAAejI,KAAKyC,GAAG5Q,IAAI,kB,CAC7B,MAAMkH,GAAI,CAQZ,OANKkP,IACDA,EAAS,IAAIL,GACbK,EAAO1L,IAAM,mBAIVrC,OAAOqK,OAAO,IAAIqD,GAAkBK,EAC/C,GApCQ,KADP,EAAApH,GAAA,GAAO,mB,iBACiBE,K,uCANvBgH,GAAmC,KADxC,EAAAnH,GAAA,K,4BACKmH,ICLN,MAAMG,I,2bCMN,IACMC,GADN,MAKYrW,QAGRiO,cAAe,CAIfzM,UAAUiJ,GAEN,IAEI,IAAI0L,QAAe1E,EAAA,EAAM1R,IAAI,GAAGmO,KAAKlO,wBAAwByK,gBAC7D,OAAOrC,OAAOqK,OAAO,IAAI2D,GAASD,EAAOhO,K,CAC3C,MAAMlB,G,CAIZ,GAjBQ,KADP,EAAA8H,GAAA,GAAO,W,iBACQC,W,+BAJdqH,GAA0B,KAD/B,EAAAvH,GAAA,K,4BACKuH,I,2bCFN,IACMC,GADN,MAIUC,iBAGA3W,cAERqO,cAAgB,CAEhBzM,UAAUiJ,GACR,OAAOyD,KAAKqI,iBAAiBxW,IAAI0K,EACnC,CAEA+L,eAAeC,GACb,GAAKA,EACL,OAAIA,EAAO1O,KAAa0O,EAAO1O,KACxBmG,KAAKtO,cAAcyB,mBAAmBoV,EAAOhM,IACtD,GAfQ,KADP,EAAAsE,GAAA,GAAO,oB,kEAIA,KADP,EAAAA,GAAA,GAAO,iB,+DALJuH,GAAa,KADlB,EAAAxH,GAAA,K,4BACKwH,I,2bCFN,IACMI,GADN,MAIUC,kBAER1I,cAAgB,CAEhBzM,YACE,OAAO0M,KAAKyI,kBAAkB5W,KAChC,GANQ,KADP,EAAAgP,GAAA,GAAO,qB,mEAFJ2H,GAAc,KADnB,EAAA5H,GAAA,K,4BACK4H,I,2bCJN,IACME,GADN,MAGI3I,cAAe,CASf4I,qBAAqBC,EAAgBnE,EAAehK,EAAeoO,GAE/D,IAAIC,EAAY,IAAIC,GA+CpB,OA7CAD,EAAUF,OAASA,GAAkB,EACrCE,EAAUrE,MAAQA,EAClBqE,EAAUrO,MAAQA,EAElBqO,EAAU/Q,MAAQ+Q,EAAUF,OAAS,EAGrCE,EAAUE,IAAMC,KAAKC,IAAIJ,EAAUF,OAASnE,EAAOhK,GAGnDqO,EAAUK,eAAiBF,KAAKG,IAAIN,EAAUF,OAAOnE,EAAO,GAEtDqE,EAAUF,OAASnE,EAAShK,IAC9BqO,EAAUO,WAAaP,EAAUF,OAASnE,GAK9CqE,EAAUQ,KAAOR,EAAUF,OAAOE,EAAUrE,MAAQ,EAChDqE,EAAUQ,KAAOR,EAAUS,UAAST,EAAUQ,KAAOR,EAAUS,SAEnET,EAAUS,QAAUN,KAAKO,KAAKV,EAAUrO,MAAQqO,EAAUrE,OAG1DqE,EAAUW,WAAaX,EAAUS,QAAUT,EAAUrE,MAAQqE,EAAUrE,MAGvEqE,EAAUY,SAAWZ,EAAUS,QAAUT,EAAUQ,KACnDR,EAAUa,aAAmC,GAApBb,EAAUF,OAEnCE,EAAUc,UAAYd,EAAUQ,KAAO,EACvCR,EAAUe,SAAWf,EAAUQ,KAAQR,EAAUS,QAAU,EAcpDT,CACX,CAIAgB,kBAAkBrF,EAAOmE,EAAQmB,GAC7B,IAAIC,EAAWpB,EAASnE,EAAQ,EAGhC,OAAOwE,KAAKC,IAAKa,EAAe,EAAIC,EACxC,CAGAC,4BAA4BxF,EAAOmE,GAC/B,IAAIoB,EAAWpB,GAAUnE,EAAQ,GAGjC,OAAOwE,KAAKG,IAAK,EAAIY,EACzB,CAEAE,0BAA0BtB,EAAQmB,GAE9B,IAAII,EAAoBJ,EAAe,EAAKnB,EAE5C,OAAOK,KAAKG,IAAK,EAAIe,EACzB,GArFEzB,GAAa,KADlB,EAAA9H,GAAA,K,4BACK8H,IA0FN,MAAMK,GAEFO,KACAc,YACAb,QAEAX,OACAnE,MACAhK,MAEA1C,MACAiR,IAEAG,eACAE,WACAI,WAEAE,aACAD,SACAE,UACAC,S,2bClGJ,IACMQ,GADN,MAIYC,eAGA7B,kBAGAJ,iBAGAkC,gBAGAC,oBAGAC,qBAGAC,yBAGAC,2BAGAC,yBAGAC,yBAGR9K,cAEA,CAEAzM,WAAWwX,GAEP,MAAMC,EAAe/K,KAAKgL,kBAE1B,IAAK,IAAIvI,KAAMqI,EAAK,CAChB,IAAIG,EAAOF,EAAaG,QAAQC,GAAKA,EAAEvI,QAAUH,IAAI,SAC/CwI,GAAMG,O,CAGpB,CAGA9X,kBAEI,MAAMyX,EAAe/K,KAAKgL,kBAE1B,IAAK,IAAIC,KAAQF,QACPE,EAAKG,MAGnB,CAEAJ,kBAEI,MAAMD,EAAe,GAiBrB,OAfAA,EAAalJ,KAAK7B,KAAKsK,gBACvBS,EAAalJ,KAAK7B,KAAKyI,mBACvBsC,EAAalJ,KAAK7B,KAAKqI,kBACvB0C,EAAalJ,KAAK7B,KAAKuK,iBACvBQ,EAAalJ,KAAK7B,KAAKwK,qBACvBO,EAAalJ,KAAK7B,KAAKyK,sBACvBM,EAAalJ,KAAK7B,KAAK0K,0BAEvBK,EAAalJ,KAAK7B,KAAKyK,sBACvBM,EAAalJ,KAAK7B,KAAK0K,0BAEvBK,EAAalJ,KAAK7B,KAAK4K,0BACvBG,EAAalJ,KAAK7B,KAAK6K,0BACvBE,EAAalJ,KAAK7B,KAAK2K,4BAEhBI,CAEX,CAGAzX,iBAAiB7B,GACb4O,QAAQC,IAAI,mBAAmB7O,IACnC,GAlFQ,KADP,EAAAoP,GAAA,GAAO,kB,gEAIA,KADP,EAAAA,GAAA,GAAO,qB,mEAIA,KADP,EAAAA,GAAA,GAAO,oB,kEAIA,KADP,EAAAA,GAAA,GAAO,mB,iEAIA,KADP,EAAAA,GAAA,GAAO,uB,qEAIA,KADP,EAAAA,GAAA,GAAO,wB,sEAIA,KADP,EAAAA,GAAA,GAAO,4B,0EAIA,KADP,EAAAA,GAAA,GAAO,8B,4EAIA,KADP,EAAAA,GAAA,GAAO,4B,0EAIA,KADP,EAAAA,GAAA,GAAO,4B,0EA7BNwJ,GAAa,KADlB,EAAAzJ,GAAA,K,4BACKyJ,I,idCRN,IACMgB,GADN,MAIUd,gBAERxK,cAAgB,CAEhBzM,UAAUiJ,GACR,OAAOyD,KAAKuK,gBAAgB1Y,IAAI0K,EAClC,CAEAjJ,aACE,OAAO0M,KAAKuK,gBAAgBe,MAC9B,CAEAhY,aAAa2S,GAEX,OAAKA,EAAMS,QAAWT,EAAMU,IAGxBV,EAAMS,OACD1G,KAAKuL,gBAAgB,YAAatF,EAAMS,QAG7CT,EAAMU,IACD3G,KAAKwL,UAAUvF,QADxB,EAPwC,EAY1C,CAGA3S,gBAAgB2S,GAEd,OAAKA,EAAMU,IACJ3G,KAAKyL,aAAaxF,EAAMU,KADR,EAGzB,CAGO8E,aAAaC,GAClB,OAAO,KAAiBA,EAG1B,CAEOH,gBAAiBI,EAAUjF,GAChC,MAAO,QAAQiF,YAAmBjF,EAAOkF,SAAS,WACpD,GA7CQ,KADP,EAAA/K,GAAA,GAAO,mB,iEAFJwK,GAAY,KADjB,EAAAzK,GAAA,K,4BACKyK,I,2bCJN,IACMQ,GADN,MAIUpB,qBAGR1K,cAAgB,CAEhBzM,UAAUiJ,GACR,OAAOyD,KAAKyK,qBAAqB5Y,IAAI0K,EACvC,CAEAjJ,qBAAqB8T,EAAiB5C,GACpC,OAAOxE,KAAKyK,qBAAqBqB,eAAe1E,EAAU5C,EAC5D,CAEAlR,0BAEE,IAAIwL,EAAU,GAad,GAPAA,EAAUA,EAAQiN,aAAa/L,KAAKyK,qBAAqBqB,eAAe,SAAU,IAClFhN,EAAUA,EAAQiN,aAAa/L,KAAKyK,qBAAqBqB,eAAe,QAAS,IAGjFhN,EAAUkN,KAAKC,MAAMD,KAAKE,UAAUpN,IAGhCA,GAAS7L,OAAS,EACpB,IAAK,IAAIkZ,KAAcrN,SACdqN,GAAYvI,eACZuI,GAAYzM,mBACZyM,GAAYlF,gBAKvB,OAAOnI,CACT,GAtCQ,KADP,EAAA+B,GAAA,GAAO,wB,sEAFJgL,GAAiB,KADtB,EAAAjL,GAAA,K,4BACKiL,I,2bCWN,IACMO,GADN,MAIYC,eAGAC,cAGAC,aAGAC,cAGAC,cAGA/a,cAGAgb,kBAEAC,kBAER5M,cAAe,CAEfzM,UAAUsV,GACN,OAAO5I,KAAK4M,mBAAmB5M,KAAKqM,eAAexa,MAAO+W,EAC9D,CAEAtV,mBAAmByP,EAAiB6F,GAEhC,IAAIL,EACA/I,EAEAuD,EAAQc,WACR0E,QAAevI,KAAKsM,cAAcza,IAAIkR,EAAQc,WAGlD,IAAI9O,EAAYgO,EAAQhO,UAEpB8X,EAAkB7M,KAAKwM,cAAc7D,qBAAqBC,ExBzDrD,GwByDyE7T,EAAW,GAKzFmS,EAAY,CAAC,SAAU,QAAS,QAAS,QAEzC4F,EAAuB,CAAC,EAE5B,IAAK,IAAI1F,KAAYF,EACjB4F,EAAqB1F,SAAkBpH,KAAK0M,kBAAkBZ,eAAe1E,EAAU,GAkB3F,OALIrE,EAAQ1H,eACRmE,QAAmBQ,KAAKuM,aAAa1a,IAAIkR,EAAQ1H,eAI9C,CACH0R,sBAAuBhK,EAAQS,gBAAkBxD,KAAKtO,cAAcyB,mBAAmB4P,EAAQS,sBAAmBjQ,EAClHwP,QAASA,EACT+J,qBAAsBA,EACtBvE,OAAQA,EACRyE,kBAAmBhN,KAAKsM,cAAchE,eAAeC,GACrDxT,UAAWA,EACX8X,gBAAiBA,EACjBrN,WAAYA,EAGpB,CAIAlM,kBAAkB2N,EAAWnP,EAASC,GAElCJ,WAAWsP,UAAYA,EACvBtP,WAAWG,QAAUA,EACrBH,WAAWI,SAAWA,CAG1B,CAEAuB,sBAAsB2N,GAEdA,GAAajB,KAAK2M,mBAAqB1L,UACjCjB,KAAKyM,cAAcQ,kBACnBjN,KAAKyM,cAAcrB,KAAK,CAAC,qBAGnCpL,KAAK2M,kBAAoB1L,CAE7B,GApGQ,KADP,EAAAJ,GAAA,GAAO,kB,iBACe2H,K,sCAGf,KADP,EAAA3H,GAAA,GAAO,iB,iBACcuH,K,qCAGd,KADP,EAAAvH,GAAA,GAAO,gB,iBACawK,K,oCAGb,KADP,EAAAxK,GAAA,GAAO,iB,iBACc6H,K,qCAGd,KADP,EAAA7H,GAAA,GAAO,iB,iBACcwJ,K,qCAGd,KADP,EAAAxJ,GAAA,GAAO,iB,+DAIA,KADP,EAAAA,GAAA,GAAO,qB,iBACkBgL,K,yCArBxBO,GAAiB,KADtB,EAAAxL,GAAA,K,4BACKwL,I,2bCZN,IACMc,GADN,MAIU1C,oBAERzK,cAAgB,CAEhBzM,UAAUiJ,GACR,OAAOyD,KAAKwK,oBAAoB3Y,IAAI0K,EACtC,GANQ,KADP,EAAAsE,GAAA,GAAO,uB,qEAFJqM,GAAgB,KADrB,EAAAtM,GAAA,K,4BACKsM,I,idCDN,IACMC,GADN,MAGEpN,cAAe,CAEfzM,uBAAuBsQ,GAErB,IAAKA,GAASwJ,IAAK,MAAO,GAI1B,MAAMC,EAAM,IAAI,MAA0BzJ,EAAQwJ,IAAK,CAAC,GAgCxD,OA7BAC,EAAIC,kBAAiB,SAAUC,EAAUC,GAEvC,GAA6B,YAAzBD,EAASE,OAAOC,KAClB,MAAO,SAGT,GAA6B,cAAzBH,EAASE,OAAOC,KAAsB,CAExC,IAAIC,EAAM,aAAaJ,EAASE,OAAOlX,MAAMqX,QAgB7C,OAdIL,EAASE,OAAOlX,MAAMsX,QACxBF,GAAO,UAAUJ,EAASE,OAAOlX,MAAMsX,WAGrCN,EAASE,OAAOlX,MAAMuX,SACxBH,GAAO,WAAWJ,EAASE,OAAOlX,MAAMuX,YAGtCP,EAASE,OAAOlX,MAAMI,QACxBgX,GAAO,UAAUJ,EAASE,OAAOlX,MAAMI,UAGzCgX,GAAO,KAEAA,C,CAGX,IAEON,EAAIU,SACb,CAGAza,uBAAuBsQ,GACrB,OAAO,KAAAoK,iBAAgBpK,EACzB,GAhDIuJ,GAAY,KADjB,EAAAvM,GAAA,K,4BACKuM,I,2bCDN,IACMc,GADN,MAIYrD,yBAER7K,cAAe,CAEfzM,UAAUiJ,GACN,OAAOyD,KAAK4K,yBAAyB/Y,IAAI0K,EAC7C,CAEAjJ,UAAUqU,GACN,OAAO3H,KAAK4K,yBAAyB9I,IAAI6F,EAC7C,CAEArU,eAAeqO,GACX,OAAO3B,KAAK4K,yBAAyBsD,SAASvM,EAClD,CAEArO,aACI,OAAO0M,KAAK4K,yBAAyBU,MACzC,CAEAhY,2BAA2ByP,EAAiB9E,GAExC,IAAIkQ,EAA0B,GAG1BC,EAAY,IAAIC,IAAIpQ,EAAM1J,KAAK+K,GAAQA,EAAKyE,oBAAoBxP,KAAK+Z,GAAM,GAAGA,EAAGhU,eAAegU,EAAG/X,YAAWgY,QAGlH,IAAK,IAAIC,KAAYJ,EAAW,CAE5B,IAAIzG,EAAgC,CAChCpL,IAAKiS,EACLlU,UAAWkU,EAASC,UAAU,EAAGD,EAASE,QAAQ,QAClDnY,MAAOiY,EAASC,UAAUD,EAASE,QAAQ,OAAS,EAAGF,EAASvb,QAChEwH,MAAO,EACP8K,SAAU,IAGd4I,EAAOtM,KAAK8F,E,CAOhB,IAAK,IAAIrI,KAAQrB,EAEb,IAAK,IAAIqQ,KAAMhP,EAAKyE,oBAAqB,CAGrC,IAAI/M,EAAuBmX,EAAOjD,QAAQyD,GAAMA,EAAGrU,WAAagU,EAAGhU,WAAaqU,EAAGpY,OAAS+X,EAAG/X,QAAO,GAKtGS,EAAMuO,SAAS1D,KAAKvC,EAAKzK,SACzBmC,EAAMyD,O,CAMd,IAAK,IAAIzD,KAASmX,EACdnX,EAAMwQ,gBAAkB,IAAIjM,KAAKC,aAAa,UAAW,CACrD7E,MAAO,UACPiY,sBAAuB,EACvBC,sBAAuB,IACtBpT,OAAQzE,EAAMyD,MAAQsI,EAAQhO,WASvC,OAHAoZ,EAAOtJ,MAAK,CAACiK,EAAEta,IAAMA,EAAEiG,MAAQqU,EAAErU,QAG1B0T,CACX,GA7EQ,KADP,EAAAtN,GAAA,GAAO,4B,0EAFNoN,GAAqB,KAD1B,EAAArN,GAAA,K,4BACKqN,I,2bCEN,IACMc,GADN,MAIYzE,eAGAK,2BAIAqE,sBAERjP,cACI,CAEJzM,UAAUiJ,GACN,OAAOyD,KAAKsK,eAAezY,IAAI0K,EACnC,CAEAjJ,WAAWkR,EAAcC,GACrB,OAAOzE,KAAKsK,eAAegB,KAAK9G,EAAMC,EAC1C,CAEAnR,YAAY6L,GACR,OAAOa,KAAKsK,eAAenL,MAAMA,EACrC,CAEA7L,YACI,OAAO0M,KAAKsK,eAAe2E,KAC/B,CAEA3b,mBAAmBuB,GACf,OAAOmL,KAAKsK,eAAe4E,aAAara,EAC5C,CAEAvB,oBAAoBiS,GAChB,OAAOvF,KAAKsK,eAAe6E,cAAc5J,EAC7C,CAEAjS,sCAAsCgH,EAAkB/D,EAAc0O,GAClE,OAAOjF,KAAKsK,eAAe8E,gCAAgC9U,EAAW/D,EAAO0O,EACjF,CAEA3R,kCAAkCF,EAAgB6R,GAC9C,OAAOjF,KAAKsK,eAAe+E,4BAA4Bjc,EAAS6R,EACpE,CAEA3R,qCAAqCiS,GACjC,OAAOvF,KAAKsK,eAAegF,+BAA+B/J,EAC9D,CAEAjS,oCAAoCuB,GAChC,OAAOmL,KAAKsK,eAAeiF,8BAA8B1a,EAC7D,CAGAvB,oBAAoBkS,EAAqBf,EAAa,IAClD,OAAOzE,KAAKsK,eAAekF,cAAchK,EAAcf,EAC3D,CAGAnR,2BAA2ByP,GAEvB,IAAI9E,QAAqB+B,KAAKiP,MAE9B,OAAOjP,KAAKgP,sBAAsBS,qBAAqB1M,EAAS9E,EACpE,CAGA3K,qBAAqBiS,GACjB,OAAOvF,KAAK2K,2BAA2BwE,cAAc5J,EACzD,GApEQ,KADP,EAAA1E,GAAA,GAAO,kB,gEAIA,KADP,EAAAA,GAAA,GAAO,8B,4EAKA,KADP,EAAAA,GAAA,GAAO,yB,iBACsBoN,K,6CAV5Bc,GAAW,KADhB,EAAAnO,GAAA,K,4BACKmO,I,2bCLN,IACMW,GADN,MAIYC,mBAER5P,cACI,CAEJzM,UAAU2R,GACN,OAAOjF,KAAK2P,mBAAmB9d,IAAIoT,EACvC,GAPQ,KADP,EAAApE,GAAA,GAAO,sB,oEAFN6O,GAAe,KADpB,EAAA9O,GAAA,K,4BACK8O,I,scCsBN,MAAME,GAAS,IAAI,GAAAC,UAEnB,IACMC,GADN,MAIYC,YAGA1D,eAGAC,cAGAC,aAGAE,cAGAuD,aAGAC,iBAGAC,gBAGAlB,sBAIAmB,eAERpQ,cAAe,CAEfzM,UAAUiJ,GAEN,IAAI+C,QAAkBU,KAAK+P,YAAYle,IAAI0K,GAG3C,MAAMwG,QAAgB/C,KAAKqM,eAAexa,MAGpCue,QAAyCpQ,KAAKgP,sBAAsB1D,OAE1E,OAAOtL,KAAK4M,aAAatN,EAAMyD,EAASqN,EAC5C,CAEA9c,mBAAmBuB,GAEf,OAAOmL,KAAK+P,YAAYb,aAAara,EAEzC,CAEAvB,mBAAmBgM,EAAYyD,EAAiBqN,GAE5C,IAEI7H,EACA/I,EACA6Q,EAEAC,EANAvM,EAAoD,GAcxD,GALIhB,EAAQc,WACR0E,QAAevI,KAAKsM,cAAcza,IAAIkR,EAAQc,WAI9Cd,EAAQxJ,iBAAiBtG,OAAS,EAElC,IAAK,IAAIoH,KAAM0I,EAAQxJ,iBAAkB,CAGrC,IAAIgX,EAAajR,GAAMyE,qBAAqBmH,QAAQoD,GAAMjU,GAAIC,WAAagU,GAAIhU,YAE3EkW,EAAYD,GAAYtd,OAAS,EAAIsd,EAAW,GAAGha,WAAQhD,EAG3Dkd,EAAmCL,EAAgBlF,QAAQyD,GAAMA,EAAGrU,WAAaD,EAAGC,YAEpFoW,EAAUD,GAAiBvF,QAAQyD,GAAMA,EAAGpY,OAASia,IAGzDzM,EAAoBlC,KAAK,CACrBlN,GAAI0F,EAAG1F,GACP2F,UAAWD,EAAGC,UACdC,OAAQF,EAAGE,OACXhE,MAAOia,EACP7I,eAAgB+I,GAASzd,OAAS,EAAIyd,EAAQ,QAAKnd,G,CAa/D,GALI+L,EAAKjE,eACLmE,QAAmBQ,KAAKuM,aAAa1a,IAAIyN,EAAKjE,eAI9CiE,EAAK4E,cAAgB5E,EAAK0E,sBAAuB,CAEjDqM,QAAkBrQ,KAAKiQ,iBAAiBpe,IAAIyN,EAAK4E,aAEjD,IAEIyM,EAFOf,GAAOgB,gBAAgBP,EAAUzM,QAAS,aAErCiN,qBAAqB,QAAQ,GAE7CP,EAAuB,cAAY,IAAI,MAAgBQ,kBAAkBH,IAGzEL,EAAuB,OAASA,EAAqBS,MAAM,GAC3DT,EAAuBA,EAAqB7B,UAAU,EAAG6B,EAAqBrd,OAAS,GAAK,Q,CAOhG,GAAIqM,EAAKsE,SAASwJ,KAAKna,OAAS,EAAG,CAE/B,IAAIma,EAAM,GAEV,IAAK,IAAI4D,KAAM1R,EAAKsE,QAAQwJ,IAAK,CAE7B,GAAI4D,EAAGvD,QAAUuD,EAAGvD,OAAOwD,UAAW,CAElC,IAAIhL,QAAoBjG,KAAKuM,aAAa1a,IAAImf,EAAGvD,OAAOwD,UAAUxK,KAElEuK,EAAGvD,OAAOwD,UAAUrD,UAAY5N,KAAKuM,aAAa2E,OAAOjL,E,CAK7DmH,EAAIvL,KAAKmP,E,CAGb1R,EAAKsE,QAAQwJ,IAAMA,C,CAQvB,MAAO,CACH9N,KAAMA,EACN+Q,UAAUA,EACVC,qBAAsBA,EACtB5Q,kBAAmBM,KAAKgQ,aAAamB,iBAAiB7R,EAAKsE,SAC3Db,QAASA,EACTwF,OAAQA,EACRyE,kBAAmBhN,KAAKsM,cAAchE,eAAeC,GACrDxE,oBAAqBA,EACrBvE,WAAYA,EAGpB,CAEAlM,uBAAuBgM,EAAYyD,GAE/B,IAGIvD,EAQJ,OAJIF,EAAKjE,eACLmE,QAAmBQ,KAAKuM,aAAa1a,IAAIyN,EAAKjE,eAG3C,CACHiE,KAAMA,EACN+Q,UATAA,UAUAtN,QAASA,EACTwF,OAbAA,UAcAxE,oBAhBoD,GAiBpDvE,WAAYA,EAGpB,CAEAlM,yBAAyBgM,EAAYyD,GAajC,MAAO,CACHzD,KAAMA,EACN+Q,UATAA,UAUAtN,QAASA,EACTwF,OAbAA,UAcAxE,oBAhBoD,GAoB5D,CAEAzQ,iCAAiC8d,SAEvBpR,KAAKyM,cAAcrB,KAAK,CAAC,WAAY,UAAW,qBAGtD,MAAMrI,QAAgB/C,KAAKqM,eAAexa,MAG1C,IAAI4e,QAAyCzQ,KAAKgP,sBAAsB1D,OAMpE/R,EAAsCwJ,EAAQxJ,iBAE9CuF,EAAsC,GAE1C,IAAK,IAAIzE,KAAMd,EAAkB,CAE7B,IAAIgB,EAAS,GAEb,IAAK,IAAIC,KAAKH,EAAGE,OAAOsK,OAAQ,CAE5B,IAAIwM,EAAerF,KAAKC,MAAMD,KAAKE,UAAUkF,WACtCC,EAAahX,EAAGC,WAGvB,IAAIgX,QAA0BtR,KAAKuR,qBAAqBF,EAAcZ,GAElE9B,EAAK8B,EAAgBvF,QAAQyD,GAAMA,EAAGrU,WAAcD,EAAGC,WAAaqU,EAAGpY,OAASiE,IAAG,GAEnFmU,GAEApU,EAAOsH,KAAK,CACRtL,MAAOiE,EACPC,MAAOkU,EAAGpJ,SAAS2F,QAAOsG,GAAKF,EAAkBpP,SAASsP,KAAIve,Q,CAQ1EsH,EAAOsK,MAAK,CAACiK,EAAEta,IAAMA,EAAEiG,MAAQqU,EAAErU,QAGjC,IAAIgX,EAAiC,CACjC9c,GAAI0F,EAAG1F,GACP2F,UAAWD,EAAGC,UACdC,OAAQA,GAGZuE,EAAQ+C,KAAK4P,E,CAKjB,OAAO3S,CAEX,CAEAxL,kBAAkB8d,EAAY5M,EAAcC,GAKxC,SAHMzE,KAAKyM,cAAcrB,KAAK,CAAC,WAAY,UAAW,mBAAoB,yBAGtEgG,GAAUlX,OAAOC,KAAKiX,IAASne,OAAS,EAExC,OAAO+M,KAAK0R,aAAaN,EAAQ5M,EAAMC,GAEpC,CAGH,IAAIQ,EAAaT,EAAOC,EAEpBa,QAA0BtF,KAAKkQ,gBAAgBre,IAAIoT,GACnDlC,QAAwB/C,KAAKqM,eAAexa,MAGhD,MAAO,CACHoM,MAAOqH,EAASrH,MAChBtD,aAAcoI,EAAQhO,UACtB0P,MAAOA,EACPD,KAAMA,E,CAIlB,CAEAlR,mBAAmB8d,EAAa5M,EAAcC,SAEpCzE,KAAKyM,cAAcrB,KAAK,CAAE,WAAY,UAAW,mBAAoB,yBAE3E,IAAIqF,QAAyCzQ,KAAKgP,sBAAsB1D,OAEpEqG,QAAoB3R,KAAKuR,qBAAqBH,EAAQX,GAGtD9V,EAAegX,EAAY1e,OAK/B,OAJA0e,EAAcA,EAAYZ,MAAMvM,EAAMA,EAAOC,GAItC,CACHxG,YAHsC+B,KAAK+P,YAAY6B,eAAeD,GAItEhX,aAAcA,EACd8J,MAAOA,EACPD,KAAMA,EAGd,CAEAlR,2BAA2B8d,EAAQS,GAE/B,IAAIC,EAAoB,GAExB,IAAK,IAAI1X,KAAOF,OAAOC,KAAKiX,GACxBU,EAAkBjQ,KAAK,GAAGzH,OAASgX,EAAOhX,MAG9C,IAAIqW,EAAmCoB,GAAoB3G,QAAQyD,GAAMmD,GAAmB5P,SAASyM,EAAGpS,OAExG,OAAIkU,GAAiBxd,OAAS,EACnBwd,EAAgBlc,KAAKoa,GAAMA,EAAGpJ,WAAUwM,QAAO,CAACrb,EAAE+J,IAAM/J,EAAEwU,QAAO5V,GAAKmL,EAAEyB,SAAS5M,QAInF0K,KAAKmQ,iBACNnQ,KAAKmQ,eAAiBzT,MAAMC,KAAK,IAAI0R,IAAIwD,EAAmBtd,KAAKoa,GAAMA,EAAGpJ,WAAUgJ,UAGjFvO,KAAKmQ,eAKpB,CAGA7c,WAAWkR,EAAcC,GAErB,IAAIwD,EAA0B,GAG9B,MAAMlF,QAAgB/C,KAAKqM,eAAexa,MAGpCue,QAAyCpQ,KAAK+P,YAAYN,qBAAqB1M,GAErF,IAAI9E,QAAsB+B,KAAK+P,YAAYzE,KAAK9G,EAAMC,GAEtD,IAAK,IAAInF,KAAQrB,EACbgK,EAAOpG,WAAW7B,KAAK4M,aAAatN,EAAMyD,EAASqN,IAGvD,OAAOnI,CAEX,CAEA3U,eAAekR,EAAcC,GAEzB,IAAIwD,EAA0B,GAG9B,MAAMlF,QAAgB/C,KAAKqM,eAAexa,MAE1C,IAAIoM,QAAsB+B,KAAK+P,YAAYzE,KAAK9G,EAAMC,GAEtD,IAAK,IAAInF,KAAQrB,EACbgK,EAAOpG,WAAW7B,KAAKgS,iBAAiB1S,EAAMyD,IAGlD,OAAOkF,CAEX,CAIA3U,eAAe2R,GACX,OAAOjF,KAAKkQ,gBAAgBre,IAAIoT,EACpC,CAEA3R,wBAAwBgH,EAAkB/D,EAAe0O,GACrD,OAAOjF,KAAK+P,YAAYX,gCAAgC9U,EAAW/D,EAAO0O,EAC9E,CAEA3R,oBAAoBF,EAAgB6R,GAChC,OAAOjF,KAAK+P,YAAYV,4BAA4Bjc,EAAS6R,EACjE,CAEA3R,YAAY6L,SAEFa,KAAKyM,cAAcrB,KAAK,CAAC,QAAS,aAExC,IAAItM,QAAgBkB,KAAK+P,YAAY5Q,MAAMA,GAI3C,MAAM4D,QAAgB/C,KAAKqM,eAAexa,MAE1C,IAAIogB,EAA8B,GAElC,IAAK,IAAI3S,KAAQR,EACbmT,EAAWpQ,WAAW7B,KAAKkS,mBAAmB5S,EAAMyD,IAIxD,OAAOkP,CACX,CAEA3e,qBAAqB6e,EAAgCC,GAIjD,IAAInK,EAAqB,GAGrBgK,EAAgC,GAGpC,IAAK,IAAI5S,KAAiB8S,EAAgB,CAEtC,IAAI7S,EAAYD,EAAcC,KAE9B2S,EAAWpQ,KAAK,CACZtF,IAAK+C,EAAK/C,IACVjB,sBAAqB+D,EAAcG,WAAWC,UAC9CpE,aAAcgE,EAAcG,WAAWjD,IACvCvK,MAAO,GAAGsN,EAAKtN,MAAQsN,EAAKtN,MAAQ,IAAIsN,EAAKzK,YAC7CA,QAASyK,EAAKzK,S,CAMtB,IAAK,IAAIwd,EAAI,EAAGA,EAAIJ,EAAWhf,OAAQof,GAAKD,EACxCnK,EAAOpG,KAAK,CACR5D,MAAOgU,EAAWlB,MAAMsB,EAAGA,EAAID,KAKvC,OAAOnK,CAEX,CAEA3U,2BAA2ByP,GACvB,OAAO/C,KAAK+P,YAAYN,qBAAqB1M,EACjD,CAEAzP,qCAAqCqe,GACjC,OAAO3R,KAAK+P,YAAYT,+BAA+BqC,EAC3D,CAEAW,0BAA0BhT,EAAWE,GAUjC,MARiC,CAC7BjD,IAAK+C,EAAK/C,IACVjB,sBAAqBkE,EAAWC,UAChCpE,aAAcmE,EAAWjD,IACzBvK,MAAO,GAAGsN,EAAKtN,MAAQsN,EAAKtN,MAAQ,IAAIsN,EAAKzK,YAC7CA,QAASyK,EAAKzK,QAKtB,GA1dQ,KADP,EAAAgM,GAAA,GAAO,e,iBACakO,K,mCAGb,KADP,EAAAlO,GAAA,GAAO,kB,iBACgB2H,K,sCAGhB,KADP,EAAA3H,GAAA,GAAO,iB,iBACeuH,K,qCAGf,KADP,EAAAvH,GAAA,GAAO,gB,iBACcwK,K,oCAGd,KADP,EAAAxK,GAAA,GAAO,iB,iBACewJ,K,qCAGf,KADP,EAAAxJ,GAAA,GAAO,gB,iBACcsM,K,oCAGd,KADP,EAAAtM,GAAA,GAAO,oB,iBACkBqM,K,wCAGlB,KADP,EAAArM,GAAA,GAAO,mB,iBACiB6O,K,uCAGjB,KADP,EAAA7O,GAAA,GAAO,yB,iBACuBoN,K,6CA3B7B6B,GAAc,KADnB,EAAAlP,GAAA,K,4BACKkP,I,2bCzBN,IACMyC,GADN,MAIYjG,cAERvM,cACG,CAEHzM,UAAUiJ,GACN,OAAOyD,KAAK4M,mBAAmB5M,KAAKsM,cAAcza,IAAI0K,GAC1D,CAEAjJ,mBAAmBiV,GAIf,MAAO,CACHA,OAAQA,EACRyE,kBAAmBhN,KAAKsM,cAAchE,eAAeC,GAG7D,GAlBQ,KADP,EAAA1H,GAAA,GAAO,iB,iBACcuH,K,qCAHpBmK,GAAgB,KADrB,EAAA3R,GAAA,K,4BACK2R,I,scCDN,IACMC,GADN,MAIYC,mBAGA/gB,cAERqO,cACG,CAEK2S,kBAAkB,EAG1Bpf,iBAAiBF,GACb,IAAKA,EAAS,OAAO,EAErB,IAAIuf,QAAwB3S,KAAK4S,qBAEjC,OAAO/c,eAAe8c,EAAgBE,UAAUzf,GACpD,CAEAE,kBAAkBuB,GACd,OAAOmL,KAAKyS,mBAAmB5gB,IAAIgD,EACvC,CAEAvB,WAAW2D,EAAiB6b,GAExB,IAAIH,QAAwB3S,KAAK4S,2BAG3BD,EAAgBza,KAAKjB,EAAU,CAAEV,MAAOuc,GAClD,CAEAxf,0BAA0B2D,EAAiBc,EAAc+a,GACrD,IAAIH,QAAwB3S,KAAK4S,2BAC3BD,EAAgB1a,oBAAoBhB,EAAUc,EAAO,CAAExB,MAAOuc,GACxE,CAGAxf,kBAAkB2D,GACd,IAAI0b,QAAwB3S,KAAK4S,2BAC3BD,EAAgBza,KAAKjB,EAAU,CAAC,EAC1C,CAEA3D,cAAcuB,GAEV,aAD4BmL,KAAK4S,sBACVG,QAAQle,EACnC,CAEAvB,uBAEI,aAD4B0M,KAAK4S,sBACV5a,aAC3B,CAEA1E,uBAEI,aAD4B0M,KAAK4S,sBACVtZ,aAC3B,CAEAhG,cAEI,aAD4B0M,KAAK4S,sBACVjV,OAC3B,CAEArK,2BAGI,IAAI0f,QAAiChT,KAAKtO,cAAcuhB,YAAY,WAGpE,GAAIjT,KAAKtO,cAAc8B,UAA+D,GAAnDwM,KAAKtO,cAAc8B,SAAS0f,aAAajgB,OAAa,CAErF,IAAIiY,EAAS,CACT9X,QAAS4f,EAAS5f,QAClB+f,OAAQ,EAEJ,EAAAxe,GAAAA,IAAG,wBAIXqL,KAAKtO,cAAc8B,SAASiD,GAAIyU,GAAQ5X,MAAOgC,IAE3C,IAAIT,EAAUgB,SAASP,EAAE2E,MAEzB,GAAIpF,EAAUmL,KAAK0S,kBAAmB,CAClC1S,KAAK0S,kBAAoB7d,EAEzB,IAAIue,EAAY,IAAIxa,YAAY,cAGhCwa,EAAUve,QAAUA,EAEpBgE,SAASC,cAAcsa,E,KAQnC,OAAOJ,CACX,GAnGQ,KADP,EAAAnS,GAAA,GAAO,sB,oEAIA,KADP,EAAAA,GAAA,GAAO,iB,+DALN2R,GAAoB,KADzB,EAAA5R,GAAA,K,4BACK4R,I,scCGN,IACMa,GADN,MAIYC,qBAGAjH,eAIA0D,YAGAtD,cAGA/a,cAERqO,cACG,CAEHzM,kCAEU0M,KAAKyM,cAAcrB,KAAK,CAAC,WAAY,UAE3C,IAAIrI,QAAwB/C,KAAKqM,eAAexa,MAEhD,GAAIkR,EAAQS,gBAAiB,CAEzB,IAAIxL,QAA2BgI,KAAKsT,qBAAqBC,iBAErDC,EAAa,GAEjB,GAAIC,OAAOzb,GAAe,EAAI,CAE1B,IAAIiG,QAAc+B,KAAK+P,YAAYP,cAAciE,OAAOzb,IAExD,IAAK,IAAIsH,KAAQrB,EAEb,IAGI,IAAIN,QAAcqC,KAAKsT,qBAAqBP,QAAQzT,EAAKzK,SAEzD2e,EAAW3R,KAAK,CACZlE,YAAaqC,KAAKtO,cAAcyB,mBAAmBwK,GACnD2B,KAAMA,G,CAGZ,MAAMvG,GAAI,C,CAQpB,MAAO,CACHf,YAAayb,OAAOzb,GACpBsB,YAAayJ,EAAQhO,UACrB4D,UAAWoK,EAAQpK,UACnB6a,WAAYA,EACZna,QAASoa,OAAOzb,GAAe+K,EAAQhO,U,CAKnD,CAEAzB,sCAEU0M,KAAKyM,cAAcrB,KAAK,CAAC,aAE/B,IAAIrI,QAAwB/C,KAAKqM,eAAexa,MAEhD,GAAIkR,EAAQS,gBAAiB,CAEzB,IAAIxL,QAA2BgI,KAAKsT,qBAAqBC,iBAEzD,MAAO,CACHvb,YAAayb,OAAOzb,GACpBsB,YAAayJ,EAAQhO,UACrB4D,UAAWoK,EAAQpK,U,CAI/B,CAIArF,WAAW2D,SAED+I,KAAKyM,cAAcrB,KAAK,CAAC,aAC/B,IAAIrI,QAAwB/C,KAAKqM,eAAexa,MAC5C6hB,QAAiB1T,KAAK2T,mBAAmB5Q,EAAS9L,GAElD0G,QAAcqC,KAAKsT,qBAAqB3V,QAIxCqC,KAAKtO,cAAc0B,QAAQiS,eAAiB1H,EAAM0H,eAClDhF,QAAQC,IAAI,0BACNN,KAAKsT,qBAAqBM,YAAY3c,UAEtC+I,KAAKsT,qBAAqBpb,KAAKjB,EAAUyc,EAIvD,CAEApgB,0BAA0B2D,EAAiBc,SAEjCiI,KAAKyM,cAAcrB,KAAK,CAAC,aAC/B,IAAIrI,QAAwB/C,KAAKqM,eAAexa,MAE5C6hB,QAAiB1T,KAAK2T,mBAAmB5Q,EAAS9L,SAEhD+I,KAAKsT,qBAAqBrb,oBAAoBhB,EAAUc,EAAO2b,EACzE,CAEApgB,yBAAyByP,EAAS9L,GAE9B,IAAIJ,GAAe,SAAWkM,EAAQpK,UAAW,SAIjD,OAFY8a,OAAO5c,GAAgBI,GAEtB2U,UAEjB,CAEAtY,kBAAkBuD,EAAqBI,GACnC,OAAO,SAAYwc,OAAO5c,GAAgBI,EAC9C,CAGA3D,iBAAiBqF,GACd,OAAO,SAAWA,EAAW,QAEhC,GAvIQ,KADP,EAAAkI,GAAA,GAAO,wB,iBACqB2R,K,4CAGrB,KADP,EAAA3R,GAAA,GAAO,kB,iBACe2H,K,sCAIf,KADP,EAAA3H,GAAA,GAAO,e,iBACYkO,K,mCAGZ,KADP,EAAAlO,GAAA,GAAO,iB,iBACcwJ,K,qCAGd,KADP,EAAAxJ,GAAA,GAAO,iB,+DAfNwS,GAAc,KADnB,EAAAzS,GAAA,K,4BACKyS,I,4eCRN,IACMQ,GADN,MAIoCrd,IADhCuJ,YACgCvJ,GAAA,KAAAA,IAAAA,CAC7B,CAEHlD,uBAAuB6E,GAErB,MAAM2b,EAAO9T,KAEb,IAAI+T,EAAuB,CACzBpf,GAAIqf,GAAKC,UACTC,KAAM/b,EAAY+b,KAClBliB,MAAOmG,EAAYnG,OA2BrB,OAxBasB,iBACX,OAAO,IAAI6gB,SAAc,CAACC,EAASC,KACjCP,EAAKQ,kBAAkBP,GACvBK,GAAS,GAEb,CAmBOG,GACEC,MAlBGlhB,iBAEV,IAAI2U,QAAe9P,EAAYC,QAE/B,IACEiI,QAAQC,IAAI,uBAAwB2H,GAGpC6L,EAAKW,aAAaxM,EAAQ8L,E,CAC1B,MAAMhb,GACN+a,EAAKY,WAAW3b,EAAIgb,E,CAGtB,OAAO9L,CAET,GAIF,CAEQqM,kBAAkBP,GAGxBA,EAAUY,MAAQ3U,KAAKxJ,IAAIme,MAAMC,OAAO,CACtClgB,KAAMqf,EAAU/hB,MAChB6iB,aAAa,IAGfd,EAAUY,MAAMG,MAElB,CAEQJ,WAAWK,EAAOhB,GAExBA,EAAUY,MAAMK,QAEhB3U,QAAQC,IAAIyU,GAEZ,IAAIJ,EAAQ,CACVjgB,KAAMqgB,EAAME,QACZJ,aAAa,EACbK,gBAAiB,QACjBC,aAAc,KAGhBnV,KAAKxJ,IAAIme,MAAMC,OAAOD,GAAOG,MAE/B,CAEQL,aAAaxM,EAAQ8L,GAI3BA,EAAUY,MAAMK,QAQhBhV,KAAKxJ,IAAIme,MAAMC,OANH,CACVlgB,KAAM,wBACNmgB,aAAa,EACbM,aAAc,MAGaL,MAC/B,GAtFEjB,GAAY,KADjB,EAAAjT,GAAA,KAIM,QAAAC,GAAA,GAAO,e,kCAHRgT,IAmGN,MAAMG,GACJ1P,iBACI,MAAO,uCAAuCc,QAAQ,SAAS,SAAS3E,GACpE,IAAI0K,EAAkB,GAAdlC,KAAKmM,SAAY,EACzB,OADqC,KAAL3U,EAAW0K,EAAO,EAAFA,EAAM,GAC7CS,SAAS,GACtB,GACJ,E,4eCzGF,IACMyJ,GADN,MAG6C7e,IAAzCuJ,YAAyCvJ,GAAA,KAAAA,IAAAA,CACzC,CAEA8e,mBAAmBvc,GACfsH,QAAQC,IAAIvH,GACZiH,KAAKxJ,IAAIwC,OAAOuc,MAAMxc,EAAGkc,QAAS,qBACtC,CAEAO,UAAUP,GACNjV,KAAKxJ,IAAIwC,OAAOuc,MAAMN,EAC1B,CAIAQ,UAAUR,GACNjV,KAAKxJ,IAAIwC,OAAOuc,MAAMN,EAC1B,CAOAS,cAEAC,YAAYV,GAEJjV,KAAK0V,eAAe1V,KAAK4V,cAE7B5V,KAAK0V,cAAgB1V,KAAKxJ,IAAIwC,OAAOtD,UAAUuf,GAAoB,UAEvE,CAGAW,cACQ5V,KAAK0V,gBACL1V,KAAK0V,cAAcV,QACnBhV,KAAK0V,cAAgB,KAE7B,CAGAG,eAEAC,aAAab,GAELjV,KAAK6V,gBAAgB7V,KAAK+V,eAI9B/V,KAAK6V,eAAiB7V,KAAKxJ,IAAIwC,OAAOgd,SAASf,GAAoB,UAFpD,EAInB,CAEAgB,YAAYD,EAAiBf,GACrBjV,KAAK6V,iBACL7V,KAAK6V,eAAeI,YAAYD,GAChChW,KAAK6V,eAAeK,QAAQjB,GAEpC,CAEAc,eACQ/V,KAAK6V,iBACL7V,KAAK6V,eAAeb,QACpBhV,KAAK6V,eAAiB,KAE9B,GApEER,GAAS,KADd,EAAAzU,GAAA,KAGgB,QAAAC,GAAA,GAAO,e,kCAFlBwU,ICFN,MAAMc,WAA4BC,MAGnBC,OADXtW,YACWsW,GAEPC,QAFO,KAAAD,OAAAA,CAGX,E,scCAJ,IACME,GADN,MAIU7L,yBAGA+B,cAGR1M,cACA,CAEAzM,YAIE,aAFM0M,KAAKyM,cAAcrB,KAAK,CAAC,oBAExBpL,KAAK0K,yBAAyB7Y,KACvC,CAEAyB,UAAU0U,GAERA,EAAe5D,aAAc,IAAIoS,MAAOC,SAIxC,IAAIJ,QAAkC,UAASrO,EAAgB,CAC3D0O,qBAAqB,EACrBC,WAAW,IAGf,GAAIN,EAAOpjB,OAAS,EAChB,MAAM,IAAIkjB,GAAoBE,SAI5BrW,KAAK0K,yBAAyB5I,IAAIkG,EAC1C,CAGA1U,wBAAwBuB,GAEtB,IAAImT,QAAuBhI,KAAKnO,MAEhCmW,EAAe/S,YAAcJ,QACvBmL,KAAK8B,IAAIkG,EAEjB,GA3CQ,KADP,EAAAnH,GAAA,GAAO,4B,0EAIA,KADP,EAAAA,GAAA,GAAO,iB,iBACewJ,K,qCANnBkM,GAAqB,KAD1B,EAAA3V,GAAA,K,4BACK2V,ICTN,MAAMK,GAEFra,IACAmH,KACAmT,QACAzjB,QACA6G,KACAkZ,OACA2D,SACAC,KACA9a,MACA+a,eACAC,WACA3a,OACA4a,OACAxZ,UACA0G,YACAf,Y,2bCbJ,IACM8T,GADN,MAGIpX,cAAe,CAEfzM,+BAA+B2I,GAE3B,IAAImb,EAAW,IAAIR,GAiBnB,OAfAQ,EAASP,QAAU5a,EAAM4a,QACzBO,EAAShkB,QAAU6I,EAAM7I,QACzBgkB,EAASnd,KAAOgC,EAAMhC,KACtBmd,EAASjE,OAASlX,EAAMkX,OACxBiE,EAASN,SAAW7a,EAAMd,MAC1Bic,EAASnb,MAAQA,EAAMob,UAAUxd,KACjCud,EAASJ,eAAiB/a,EAAM+a,eAChCI,EAAS/T,aAAc,IAAImT,MAAOC,SAGlCW,EAASL,KAAO9a,EAAM8a,MAAMxiB,KAAIua,GAAKA,EAAElD,aAEvCwL,EAAS1Z,UAAY,CAAC,EAGf0Z,EAASnb,OAEZ,IAAK,WACDmb,EAASH,YAAa,EACtBG,EAAS1Z,UAAUL,YAAc+Z,EAASL,KAAK,GAC/CK,EAAS1Z,UAAUH,UAAY6Z,EAASL,KAAK,GAC7CK,EAAS1Z,UAAU7I,QAAUuiB,EAASL,KAAK,GAC3C,MACJ,IAAK,WACDK,EAAS1Z,UAAUC,MAAQyZ,EAASL,KAAK,GACzCK,EAAS1Z,UAAUD,SAAW2Z,EAASL,KAAK,GAC5CK,EAAS1Z,UAAU7I,QAAUuiB,EAASL,KAAK,GAC3C,MACJ,IAAK,iBACDK,EAAS1Z,UAAUC,MAAQyZ,EAASL,KAAK,GACzCK,EAAS1Z,UAAUG,SAAWuZ,EAASL,KAAK,GAC5CK,EAAS1Z,UAAUD,SAAW2Z,EAASL,KAAK,GAgBpD,OAXIK,EAASH,YAAiD,8CAAnCG,EAAS1Z,WAAWL,cAC3C+Z,EAAS9a,QAAS,GAGlB8a,EAASH,YAA+C,8CAAjCG,EAAS1Z,WAAWH,YAC3C6Z,EAASF,QAAS,GAMfE,CACX,GAxDED,GAAe,KADpB,EAAAvW,GAAA,K,4BACKuW,I,2bCAN,IACMG,GADN,MAIYzM,yBAER9K,cACG,CAEHzM,UAAUiJ,GACN,OAAOyD,KAAK6K,yBAAyBhZ,IAAI0K,EAC7C,CAGAjJ,UAAUikB,GAEDA,EAAelU,cAChBkU,EAAelU,aAAc,IAAImT,MAAOC,UAG5Cc,EAAenT,aAAc,IAAIoS,MAAOC,SAGxC,IAAIJ,QAAkC,UAASkB,EAAgB,CAC3Db,qBAAqB,EACrBC,WAAW,IAGf,GAAIN,EAAOpjB,OAAS,EAChB,MAAM,IAAIkjB,GAAoBE,GAGlC,OAAOrW,KAAK6K,yBAAyB/I,IAAIyV,EAG7C,GA/BQ,KADP,EAAA1W,GAAA,GAAO,4B,0EAFNyW,GAAqB,KAD1B,EAAA1W,GAAA,K,4BACK0W,I,2bCLN,MAAME,GAGFjb,IAGAmH,KAGAzJ,KAGAoJ,YAGAe,YAZA,KADC,EAAA0D,GAAA,K,qDAID,KADC,EAAAA,GAAA,K,sDAID,KADC,EAAAA,GAAA,K,sDAID,KADC,EAAAA,GAAA,K,6DAID,KADC,EAAAA,GAAA,K,wfCVL,IACM2P,GADN,MAGIhV,GACAG,OAAgB,kBAGRC,gBAERvP,aACI0M,KAAKyC,SAAWzC,KAAK6C,gBAAgBC,YAAY,CAC7CjJ,KAAMmG,KAAK4C,OACXb,gBAAgB,GAExB,CAEAhC,cAAe,CAGfzM,UAAUiJ,GACN,OAAOrC,OAAOqK,OAAO,IAAIiT,SAAwBxX,KAAKyC,GAAG5Q,IAAI0K,GACjE,CAEAjJ,UAAUikB,SACAvX,KAAKyC,GAAGX,IAAIyV,EACtB,GAlBQ,KADP,EAAA1W,GAAA,GAAO,mB,iBACiBE,K,uCANvB0W,GAAmC,KADxC,EAAA7W,GAAA,K,4BACK6W,I,2bCDN,IACMC,GADN,MAIYC,yBAER5X,cACI,CAEJzM,gBACI,OAAO0M,KAAK2X,yBAAyBC,SACzC,CAEAtkB,UAAU2R,GACN,OAAOjF,KAAK2X,yBAAyB9lB,IAAIoT,EAC7C,CAEA3R,kBACI,OAAO0M,KAAK2X,yBAAyBE,WACzC,GAfQ,KADP,EAAAhX,GAAA,GAAO,4B,0EAFN6W,GAAqB,KAD1B,EAAA9W,GAAA,K,4BACK8W,I,4eCFN,IACMI,GADN,MAImChmB,QACCC,SAFhCgO,YAC+BjO,EACCC,GADD,KAAAD,QAAAA,EACC,KAAAC,SAAAA,CAC7B,CAEHuB,gBAEI,aADuBiQ,EAAA,EAAM1R,IAAI,GAAGmO,KAAKjO,aAAaiO,KAAKlO,6CAC3CmI,IACpB,CAEA3G,kBAEI,aADuBiQ,EAAA,EAAM1R,IAAI,GAAGmO,KAAKjO,aAAaiO,KAAKlO,8CAC3CmI,IACpB,CAEA3G,UAAU2R,GAIN,aAFuB1B,EAAA,EAAM1R,IAAI,GAAGmO,KAAKjO,aAAaiO,KAAKlO,kCAAkCmT,WAE7EhL,IACpB,GAtBE6d,GAAmC,KADxC,EAAAlX,GAAA,KAIQ,QAAAC,GAAA,GAAO,YACP,QAAAA,GAAA,GAAO,a,wBAD2BC,SACEA,YAJvCgX,I,2bCGN,IACMC,GADN,MAIYC,+BAGAjI,YAERhQ,cAAe,CAEfzM,UAAUiJ,GACN,OAAOyD,KAAKgY,+BAA+BnmB,IAAI0K,EACnD,CAGAjJ,2BAA2B2kB,GAEvB,IAAIhQ,EAAS,CAAC,EAEV1C,EAAW,IAAI8I,IAGnB,IAAK,IAAIjQ,KAAkB6Z,EAElB7Z,EAAevJ,SACpB0Q,EAAS2S,IAAI9Z,EAAevJ,SAGhC,IAAIuG,QAA0B4E,KAAK+P,YAAYT,+BAA+B5S,MAAMC,KAAK4I,IAGzF,IAAK,IAAI4S,KAAQ/c,EACb6M,EAAOkQ,EAAKtjB,SAAWsjB,EAG3B,OAAOlQ,CAEX,CAEA3U,iCAAiC2H,GAE7B,IAAIgX,EAA6B,GAEjC,IAAK,IAAI/W,KAAQD,EACbgX,EAAWpQ,KAAK,CACZ3G,KAAMA,EACNoE,WAAYU,KAAK+P,YAAYR,8BAA8BrU,EAAKrG,WAIxE,OAAOod,CACX,CAEA3e,uBACI,OAAO0M,KAAKgY,+BAA+BI,gBAC/C,CAEA9kB,8BAA8BgH,EAAkB/D,GAC5C,OAAOyJ,KAAKgY,+BAA+BK,wBAAwB/d,EAAW/D,EAClF,CAEAjD,6BACI,OAAO0M,KAAKgY,+BAA+BM,sBAC/C,CAEAhlB,sBAAsBmR,GAClB,OAAOzE,KAAKgY,+BAA+BO,gBAAgB9T,EAC/D,GAhEQ,KADP,EAAA5D,GAAA,GAAO,kC,gFAIA,KADP,EAAAA,GAAA,GAAO,e,iBACYkO,K,mCANlBgJ,GAA2B,KADhC,EAAAnX,GAAA,K,4BACKmX,I,4eCFN,IACMS,GADN,MASmC1mB,QAJvB2mB,4BAGR1Y,YAC+BjO,GAAA,KAAAA,QAAAA,CAC5B,CAEHwB,yBAWI,aATmBiQ,EAAA,EAAM1R,IAAI,GAAGmO,KAAKlO,0BAA2B,CAE5D4mB,QAAS,CACP,gBAAiB,WACjB,OAAU,WACV,QAAW,QAIHze,IAClB,CAGA3G,WAAWgW,GAEP,IAAIqP,QAAe3Y,KAAK4Y,YAKpB9a,SAFeyF,EAAA,EAAM1R,IAAI,GAAGmO,KAAKlO,uCAAuCwX,WAEzCrP,KAInC,OAFA6D,EAAsBsG,YAAcuU,EAAOvU,YAEpCtG,CAEX,CAGAxK,oBAAoBF,EAAgBkW,GAEhC,IAEIxL,SAFeyF,EAAA,EAAM1R,IAAI,GAAGmO,KAAKlO,4BAA4BsB,cAAoBkW,WAElDrP,KAE/B0e,QAAe3Y,KAAK4Y,YAGxB,OAFA9a,EAAsBsG,YAAcuU,EAAOvU,YAEpCtG,CAEX,CAGAxK,kBASI,aARmBiQ,EAAA,EAAM1R,IAAI,GAAGmO,KAAKlO,yCAA0C,CAE3E4mB,QAAS,CACP,gBAAiB,WACjB,OAAU,WACV,QAAW,QAGHze,IAClB,CAEA3G,0BAcI,aAZmBiQ,EAAA,EAAM1R,IAAI,GAAGmO,KAAKlO,iDAAkD,CAEnF4mB,QAAS,CACP,gBAAiB,WACjB,OAAU,WACV,QAAW,QAIwCze,IAK7D,CAGA3G,uBACI,OAAO0M,KAAKyY,4BAA4BL,gBAC5C,CAEA9kB,8BAA8BgH,EAAkB/D,GAC5C,OAAOyJ,KAAKyY,4BAA4BJ,wBAAwB/d,EAAW/D,EAC/E,CAEAjD,6BACI,OAAO0M,KAAKyY,4BAA4BH,sBAC5C,CAGAhlB,sBAAsBmR,GAIlB,aAFmBzE,KAAKyY,4BAA4BF,gBAAgB9T,EAIxE,CAEA9I,kBAAkBkd,EAAQC,GAEtB,IAAKD,EAAQ,MAAO,KAEpB,IAIIE,EAAO9P,KAAK+P,MAAM/P,KAAKgQ,IAAIJ,IAAW,EAAI,EAG9C,GAAW,GAARE,GAAqB,GAARA,EAAW,CAEzB,OADa,IAAIxd,KAAKC,aAAa,QAAS,CAAE4B,SAAU,MAAOzG,MAAM,aAAc8E,OAAOod,E,CAK5F,IAAIK,EAbY,CAAC,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,KAatBH,GAInBI,EAASN,EAHD5P,KAAKmQ,IAAI,GAAW,EAAPL,GAMzB,OAAO,IAAIxd,KAAKC,aAAa,QAAS,CAAE4B,SAAU,MAAOzG,MAAM,aAAc8E,OAAO0d,GAAUD,CAClG,GAjIQ,KADP,EAAArY,GAAA,GAAO,+B,iBAC4BkX,K,mDAJlCS,GAAqB,KAD1B,EAAA5X,GAAA,KASQ,QAAAC,GAAA,GAAO,Y,wBAA2BC,YARrC0X,I,2bCAN,IAAMa,GAAN,MAKYvnB,QAERwB,UAAUiJ,GAEN,IAAI+c,EAGJ,IAGIA,SADmB/V,EAAA,EAAM1R,IAAI,GAAGmO,KAAKlO,8BAA8ByK,WACrCtC,I,CAEhC,MAAMlB,GACJsH,QAAQC,IAAIvH,E,CAGhB,OAAOugB,CAGX,CAEAhmB,uBAEI,IAAIoL,EAEJ,IAGIA,SADmB6E,EAAA,EAAM1R,IAAI,GAAGmO,KAAKlO,qCAChBmI,I,CAEvB,MAAMlB,GACJsH,QAAQC,IAAIvH,E,CAGhB,OAAO2F,CAEX,CAEApL,8BAA8BgH,EAAkB/D,GAE5C,IAAIgjB,EAEJ,IAGIA,SADmBhW,EAAA,EAAM1R,IAAI,GAAGmO,KAAKlO,4BAA4BkO,KAAKwZ,sBAAsB,GAAGlf,QAAgB/D,wBACjF0D,I,CAEhC,MAAMlB,GACJsH,QAAQC,IAAIvH,E,CAGhB,OAAOwgB,CACX,CAEAjmB,6BAEI,IAAImmB,EAEJ,IAGIA,SADmBlW,EAAA,EAAM1R,IAAI,GAAGmO,KAAKlO,yCACNmI,I,CAEjC,MAAMlB,GACJsH,QAAQC,IAAIvH,E,CAGhB,OAAO0gB,CAEX,CAEQD,sBAAsBpf,GAE1B,IAAciY,EAAGqH,EAAbC,EAAO,EAEX,GAAmB,IAAfvf,EAAInH,OAAc,OAAO0mB,EAE7B,IAAKtH,EAAI,EAAGA,EAAIjY,EAAInH,OAAQof,IAE1BqH,EAAMtf,EAAIwf,WAAWvH,GACrBsH,GAASA,GAAQ,GAAKA,EAAQD,EAC9BC,GAAQ,EAGV,OAAOA,CACX,CAEArmB,sBAAsBmR,GAElB,IAAI1J,EAEJ,IAGIA,SADmBwI,EAAA,EAAM1R,IAAI,GAAGmO,KAAKlO,+BAA+B2S,WAC9CxK,I,CAExB,MAAMlB,GACJsH,QAAQC,IAAIvH,E,CAGhB,OAAOgC,CACX,GArGQ,KADP,EAAA8F,GAAA,GAAO,W,iBACQC,W,+BALduY,GAAyC,KAD9C,EAAAzY,GAAA,MACKyY,ICRN,MAAMQ,I,2bCKN,IACMC,GADN,MAIYpoB,cAGAqoB,qBAERha,cAAe,CAGfzM,UAAUiJ,GACN,OAAOyD,KAAK+Z,qBAAqBloB,IAAI0K,EACzC,CAEAjJ,qBAAqBiJ,GAEjB,IAAKA,EAAK,OAEV,IAAIwB,QAAYiC,KAAK+Z,qBAAqBC,OAAOzd,GAEjD,OAAIwB,GACGiC,KAAKtO,cAAcyB,mBAAmBoJ,EAEjD,CAEAjJ,kBAAkBF,GAEd,IAAI6mB,EAEJ,IAAKA,EACD,IACIA,QAAmBja,KAAKnO,IAAIuB,E,CAC9B,MAAO2F,GAAM,CAUnB,OAPKkhB,IACDA,EAAa,IAAIJ,GACjBI,EAAW1d,IAAMnJ,EACjB6mB,EAAW1U,SAAW,GACtB0U,EAAWxf,MAAQ,GAGhBwf,CAEX,CAGA3mB,UAAU2mB,GACN,OAAOja,KAAK+Z,qBAAqBjY,IAAImY,EACzC,CAOC3mB,aAAa+K,GAaV,OAVAA,EAAY6b,SAAQD,IAEXA,EAAW1d,MACZ0d,EAAW5W,aAAc,IAAImT,MAAOC,UAIxCwD,EAAW7V,aAAc,IAAIoS,MAAOC,QAAQ,IAGzCzW,KAAK+Z,qBAAqBI,OAAO9b,EAC5C,CAGA/K,WAAWmR,EAAeD,GACtB,OAAOxE,KAAK+Z,qBAAqBzO,KAAK7G,EAAOD,EACjD,GAzEQ,KADP,EAAA3D,GAAA,GAAO,iB,+DAIA,KADP,EAAAA,GAAA,GAAO,wB,sEALNiZ,GAAiB,KADtB,EAAAlZ,GAAA,K,4BACKkZ,ICON,IAAIrY,GAAyB,CACzB,CACI9M,GAAI,IACJiN,UAAWtO,MAAOmP,UAERA,EAAGC,YAAY,CACjBvH,MAAO,CACHwH,OAAQ,CAAC,kBAIXF,EAAGX,IAAI,CACTvF,IAAK,sBACLzG,MAAO,CACHskB,YAAa,CACL7lB,IAAK,SAAU6O,GAEX,IAAK,IAAIvO,KAAWuO,EAAImC,SAEpB8U,KAAKxlB,EAGb,EAAE+W,cAGhB,I,2bChCd,IACM0O,GADN,MAGI7X,GACAG,OAAgB,eAGRC,gBAGA/Q,QAGRwB,aACI0M,KAAKyC,SAAWzC,KAAK6C,gBAAgBC,YAAY,CAC7CjJ,KAAMmG,KAAK4C,OACXb,gBAAgB,EAChBN,WAAYA,IAEpB,CAEA1B,cAAe,CAEfzM,aAAaiJ,GAET,IAAI1C,EAEJ,IAEI,IAAIoO,QAAmB1E,EAAA,EAAM1R,IAAI,GAAGmO,KAAKlO,4BAA4ByK,cACrE1C,EAAOoO,EAAOhO,MAAMJ,I,CACtB,MAAMd,GAAI,CAEZ,OAAOc,CACX,CAGAvG,UAAUiJ,GAEN,IAEI,IAAI0L,QAAe1E,EAAA,EAAM1R,IAAI,GAAGmO,KAAKlO,4BAA4ByK,qBACjE,OAAOrC,OAAOqK,OAAO,IAAIsV,GAAc5R,EAAOhO,K,CAChD,MAAMlB,GACJsH,QAAQC,IAAIvH,E,CAGpB,CAEAzF,UAAU2mB,GAEV,CAEA3mB,aAAa+K,GAEb,CAEA/K,WAAWmR,EAAeD,GAE1B,GApDQ,KADP,EAAA3D,GAAA,GAAO,mB,iBACgBE,K,uCAGhB,KADP,EAAAF,GAAA,GAAO,W,iBACQC,W,+BATdwZ,GAA+B,KADpC,EAAA1Z,GAAA,K,4BACK0Z,I,2bCJN,IACMC,GADN,MAIYC,gBAERza,cAAe,CAGfzM,UAAUiJ,GACN,OAAOyD,KAAKwa,gBAAgB3oB,IAAI0K,EACpC,GAPQ,KADP,EAAAsE,GAAA,GAAO,mB,iEAFN0Z,GAAY,KADjB,EAAA3Z,GAAA,K,4BACK2Z,I,2bCIN,ICiJI3oB,GDhJE6oB,GADN,MAIIhZ,WAAyB,CACrB,CACI9M,GAAI,IACJiN,UAAWtO,MAAOmP,UAERA,EAAGC,YAAY,CACjBvH,MAAO,CACHwH,OAAQ,CAAC,aAEf,IAOdF,GACAG,OAAgB,uBAGRC,gBAER9C,cAAe,CAEfzM,aACI0M,KAAKyC,SAAWzC,KAAK6C,gBAAgBC,YAAY,CAC7CjJ,KAAMmG,KAAK4C,OACXb,gBAAgB,EAChBK,mBAAoB,aACpBX,WAAYzB,KAAKyB,YAEzB,CAGAnO,UAAUiJ,GACN,OAAOyD,KAAKyC,GAAG5Q,IAAI0K,EACvB,CAIAjJ,UAAUgM,SACAU,KAAKyC,GAAGX,IAAIxC,EACtB,CAIAhM,oBAAoBqO,GAEhB,IAAIQ,QAAiBnC,KAAKyC,GAAGiC,KAAK,CAC9BC,SAAU,CACN9P,QAAS,CAAEmQ,IAAKrD,MAIxB,OAAIQ,EAAS2C,MAAM7R,OAAS,EACjBkP,EAAS2C,KAET,EAEf,GCqFJxR,eAAeonB,GAAiBC,EAA2BC,EAAmBC,EAAoBC,EAAgBC,EAAc9Z,GAE9H,GAAIrP,GAAW,OAAOA,GAwMtB,OAtMAA,GAAY+oB,EAEZhpB,WAAWG,QAAU8oB,EACrBjpB,WAAWI,SAAW8oB,EACtBlpB,WAAWsP,UAAYA,EA4DvBrP,GAAUopB,KAAK,cAAcC,iBAxD3B,KAAWC,kBAAkB,UAAW,GAExC,KAAWA,kBAAkB,gBAAiB,GAG9C,KAAWA,kBAAkB,YAAa,GAC1C,KAAWA,kBAAkB,mBAAoB,GACjD,KAAWA,kBAAkB,qBAAsB,GAEnD,KAAWA,kBAAkB,YAAa,GAC1C,KAAWA,kBAAkB,gBAAiB,GAG9C,KAAWA,kBAAkB,qBAAsB,GACnD,KAAWA,kBAAkB,kBAAmB,IAEhD,KAAWA,kBAAkB,mBAAoB,IAGjD,KAAWA,kBAAkB,cAAe,IAC5C,KAAWA,kBAAkB,0BAA2B,IAIxDvpB,WAAW6E,IAAM,IAAI,KAAW,CAC9B2kB,GAAI,OACJxmB,GAAI,eACJkF,KAAM,eACNuhB,MAAO,OACPC,MAAM,EAENC,KAAM,CACJC,gBAAgB,EAChBC,wBAAyB,GACzBC,sBAAsB,EACtBC,4BAA4B,GAG9BC,OAAQ,CACNC,kBAAkB,GAOpBC,QAAS,CACPD,kBAAkB,GAGpBb,OAAQA,IAGHppB,WAAW6E,MAKpB5E,GAAUopB,KAAK,WAAWC,gBAAgBH,GAE1ClpB,GAAUopB,KAAK,WAAWC,iBAAgB3nB,SACjC,MAIT1B,GAAUopB,KAAK,YAAYC,iBAAgB3nB,UAEzC,GAAsB,oBAAXwoB,QAA0BA,OAAiB,SAKpD,OAFAA,OAAOC,aAAeD,OAAO7b,SAEtB,IAAI,IAAgB6b,OAAiB,S,IAOhDlqB,GAAUopB,KAAK,aAAaC,iBAAgB3nB,UAE1C,IAAI0f,EACAgJ,EAGA1Y,QAAyBC,EAAA,EAAM1R,IAAI,GAAGF,WAAWI,WAAWJ,WAAWG,uCAAwC,CAAEmqB,aAAc,SAC/HC,QAA4B3Y,EAAA,EAAM1R,IAAI,GAAGF,WAAWI,WAAWJ,WAAWG,2CAA4C,CAAEmqB,aAAc,SAW1I,OARgC,MAA5B3Y,EAAiB6Y,SACjBnJ,EAAW1P,EAAiBrJ,MAGA,MAA5BqJ,EAAiB6Y,SACjBH,EAAcE,EAAoBjiB,MAGjC+Y,EAASxP,iBAGdwY,EAAqB,QAAE5oB,QAAU4f,EAASxP,gBAEnCwY,GAL+B,EAKpB,IAIpBpqB,GAAUopB,KAAK,WAAWC,iBAAgB,IACjCtpB,WAAWG,UAGpBF,GAAUopB,KAAK,YAAYC,iBAAgB,IAClCtpB,WAAWI,WAGpBH,GAAUopB,KAAK,aAAaC,iBAAgB,IACnCtpB,WAAWsP,YAIpBrP,GAAUopB,KAAoB,iBAAiBoB,GAAGzc,IAAmB0c,mBAErEzqB,GAAUopB,KAAwB,qBAAqBoB,GAAG5Z,IAA8B6Z,mBACxFzqB,GAAUopB,KAAqB,kBAAkBoB,GAAG/X,IAA2BgY,mBAC/EzqB,GAAUopB,KAAuB,oBAAoBoB,GAAGrW,IAA6BsW,mBACrFzqB,GAAUopB,KAAyB,sBAAsBoB,GAAG7V,IAA+B8V,mBAE3FzqB,GAAUopB,KAAsB,mBAAmBoB,GAAGxV,IAA4ByV,mBAClFzqB,GAAUopB,KAA0B,uBAAuBoB,GAAGtV,IAAgCuV,mBAC9FzqB,GAAUopB,KAA2B,wBAAwBoB,GAAGjV,IAAiCkV,mBACjGzqB,GAAUopB,KAAyB,sBAAsBoB,GAAG9U,IAA+B+U,mBAC3FzqB,GAAUopB,KAA+B,4BAA4BoB,GAAGtE,IAAqCuE,mBAE7GzqB,GAAUopB,KAA+B,4BAA4BoB,GAAG3U,IAAqC4U,mBAC7GzqB,GAAUopB,KAA+B,4BAA4BoB,GAAGrU,IAAqCsU,mBAG7GzqB,GAAUopB,KAA8B,2BAA2BoB,GAAG,CAAC,GAAGC,mBAC1EzqB,GAAUopB,KAA+B,4BAA4BoB,GAAG3E,IAAqC4E,mBAC7GzqB,GAAUopB,KAA2B,wBAAwBoB,GAAG9B,IAAiC+B,mBACjGzqB,GAAUopB,KAAsB,mBAAmBoB,GAAGjU,IAA4BkU,mBAElFzqB,GAAUopB,KAAqC,kCAAkCoB,GAAG/C,IAA2CgD,mBAC/HzqB,GAAUopB,KAAiC,8BAA8BoB,GAAG3B,IAAuC4B,mBAGnHzqB,GAAUopB,KAAwB,qBAAqBoB,GAAGhQ,IAAmBiQ,mBAC7EzqB,GAAUopB,KAAqB,kBAAkBoB,GAAGtM,IAAgBuM,mBACpEzqB,GAAUopB,KAAuB,oBAAoBoB,GAAG7J,IAAkB8J,mBAC1EzqB,GAAUopB,KAAqB,kBAAkBoB,GAAG/I,IAAgBgJ,mBACpEzqB,GAAUopB,KAAwB,qBAAqBoB,GAAGvQ,IAAmBwQ,mBAC7EzqB,GAAUopB,KAAsB,mBAAmBoB,GAAG1M,IAAiB2M,mBACvEzqB,GAAUopB,KAAmB,gBAAgBoB,GAAGvI,IAAcwI,mBAC9DzqB,GAAUopB,KAA4B,yBAAyBoB,GAAG5D,IAAuB6D,mBAGzFzqB,GAAUopB,KAAoB,iBAAiBoB,GAAG1T,IAAe2T,mBACjEzqB,GAAUopB,KAAsB,mBAAmBoB,GAAGrb,IAAiBsb,mBACvEzqB,GAAUopB,KAAuB,oBAAoBoB,GAAGlP,IAAkBmP,mBAE1EzqB,GAAUopB,KAAgB,aAAaoB,GAAG/G,IAAWgH,mBACrDzqB,GAAUopB,KAAkB,eAAeoB,GAAGrN,IAAasN,mBAC3DzqB,GAAUopB,KAAmB,gBAAgBoB,GAAG/Q,IAAcgR,mBAC9DzqB,GAAUopB,KAAqB,kBAAkBoB,GAAG5T,IAAgB6T,mBACpEzqB,GAAUopB,KAAoB,iBAAiBoB,GAAGhU,IAAeiU,mBACjEzqB,GAAUopB,KAA2B,wBAAwBoB,GAAG5J,IAAsB6J,mBACtFzqB,GAAUopB,KAAoB,iBAAiBoB,GAAG/R,IAAegS,mBACjEzqB,GAAUopB,KAAmB,gBAAgBoB,GAAGjP,IAAckP,mBAC9DzqB,GAAUopB,KAA4B,yBAAyBoB,GAAGnO,IAAuBoO,mBACzFzqB,GAAUopB,KAA4B,yBAAyBoB,GAAG9E,IAAuB+E,mBAEzFzqB,GAAUopB,KAA4B,yBAAyBoB,GAAG7F,IAAuB8F,mBACzFzqB,GAAUopB,KAAsB,mBAAmBoB,GAAGjF,IAAiBkF,mBAGvEzqB,GAAUopB,KAAK,mBAAmBoB,GAAG,CAAC,GAAGC,mBACzCzqB,GAAUopB,KAAwB,qBAAqBoB,GAAGtC,IAAmBuC,mBAC7EzqB,GAAUopB,KAAmB,gBAAgBoB,GAAG7B,IAAc8B,mBAE9DzqB,GAAUopB,KAA4B,yBAAyBoB,GAAG1E,IAAuB2E,mBAEzFzqB,GAAUopB,KAAkC,+BAA+BoB,GAAGrE,IAA6BsE,mBAI3G1qB,WAAWC,UAAYA,GACvBD,WAAW2qB,GAAK,IAChB3qB,WAAWkK,MAAQ,IACnBlK,WAAW6lB,eAAiBA,GAGrB5lB,EACT,CDvUY,KADP,EAAAiP,GAAA,GAAO,mB,iBACiBE,K,uCAvBvB0Z,GAAqC,KAD1C,EAAA7Z,GAAA,K,4BACK6Z,ICGN,IAAQ8B,OAAO,KAOf,WAAa,KAGb,WAAa,KA6Bb,KAAWC,IAAI,CAAC,IAAQ,IAAO,IAAW,IAAa,IAAW,IAAM,IAAM,IAAM,IAClF,IAAO,IAAW,IAAO,IAAgB,IAAS,M,2bChDpD,IACMC,GADN,MAGI1c,cAAe,CAGP2c,eAERppB,YACI,OAAO0M,KAAK0c,eAAe7qB,IAAI,EACnC,CAEA8J,kBAAkBkd,EAAQC,GAEtB,IAAKD,EAAQ,MAAO,KAEpB,IAIIE,EAAO9P,KAAK+P,MAAM/P,KAAKgQ,IAAIJ,IAAW,EAAI,EAG9C,GAAW,GAARE,GAAqB,GAARA,EAAW,CAEzB,OADa,IAAIxd,KAAKC,aAAa,QAAS,CAAE4B,SAAU,MAAOzG,MAAM,aAAc8E,OAAOod,E,CAK5F,IAAIK,EAbY,CAAC,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,KAatBH,GAInBI,EAASN,EAHD5P,KAAKmQ,IAAI,GAAW,EAAPL,GAMzB,OAAO,IAAIxd,KAAKC,aAAa,QAAS,CAAE4B,SAAU,MAAOzG,MAAM,aAAc8E,OAAO0d,GAAUD,CAClG,GA/BQ,KADP,EAAArY,GAAA,GAAO,kB,gEAJN4b,GAAc,KADnB,EAAA7b,GAAA,K,4BACK6b,I,4eCDN,IACME,GADN,MAIsCvqB,WADlC2N,YACkC3N,GAAA,KAAAA,WAAAA,CAC/B,CAEHkB,UAAU2R,GAGN,aAFuB1B,EAAA,EAAM1R,IAAI,GAAGmO,KAAK5N,yBAEzB6H,IACpB,GAVE0iB,GAAyB,KAD9B,EAAA/b,GAAA,KAIQ,QAAAC,GAAA,GAAO,e,kCAHV8b,ICNN,MAAMC,GAEFtY,gCAAgC8P,EAASvO,EAAKgX,GAErClrB,WAAW6E,MAEhB7E,WAAW6E,IAAId,UAAUC,OAEzBye,EAAQ,CACN0I,aAAcjX,EACdgX,QAASA,IAIXlrB,WAAW6E,IAAId,UAAUS,OAE7B,CAEAmO,uBAAwBxS,GAEpB,MAAMipB,EAAS,GAEf,IAAIgC,EAAkB,GAAGjrB,YA+BzB,MA3Be,KAAXA,GAAkBA,EAAQkrB,SAAS,MAGrCjC,EAAOlZ,KAAK,CACVpN,KAAM,GAAG3C,EAAQ2c,UAAU,EAAG3c,EAAQmB,OAAQ,KAC9CK,aAAY,QAAE8gB,EAAO,OAAEC,EAAM,GAAE+H,UACvBQ,GAAeK,mBAAmB7I,EAAS,GAAG2I,cAGtD,IAKJH,GAAeM,gBAAgBnC,EAAQjpB,GAGvCipB,EAAOlZ,KAAK,CACVpN,KAAM,OAENnB,aAAY,QAAE8gB,EAAO,OAAEC,EAAM,GAAE+H,IAC7B/b,QAAQC,IAAI,cAAc8b,EAAG3nB,cACvBmoB,GAAeK,mBAAmB7I,EAAS,GAAG2I,YACtD,IAIKhC,CAGX,CAEAzW,wBAAyBlS,GAErB,IAAI+qB,EAAqB,GAAG/qB,YAE5B,MAAM2oB,EAAS,CACb,CACEtmB,KAAM,GAAGrC,IACTkB,aAAY,QAAE8gB,EAAO,OAAEC,EAAM,GAAE+H,UACvBQ,GAAeK,mBAAmB7I,EAAS,GAAG+I,eACtD,GAGF,CACE1oB,KAAM,GAAGrC,KACTkB,aAAY,QAAE8gB,EAAO,OAAEC,EAAM,GAAE+H,UACvBQ,GAAeK,mBAAmB7I,EAAS,GAAG+I,eACtD,GAIF,CACE1oB,KAAM,GAAGrC,eACTkB,aAAY,QAAE8gB,EAAO,OAAEC,EAAM,GAAE+H,UACvBQ,GAAeK,mBAAmB7I,EAAQ,GAAG+I,eACrD,IAiBJ,OAZAP,GAAeM,gBAAgBnC,EAAQ,oBAEvCA,EAAOlZ,KAAK,CACVpN,KAAM,OAENnB,aAAY,QAAE8gB,EAAO,OAAEC,EAAM,GAAE+H,IAC7B/b,QAAQC,IAAI,cAAc8b,EAAG3nB,cACvBmoB,GAAeK,mBAAmB7I,EAAS,GAAG+I,aACtD,IAIKpC,CACX,CAEQzW,uBAAuByW,EAAQjpB,GAEnC,IAAIirB,EAGFA,EADEjrB,EAAQ4c,QAAQ,gBAAkB,EAClB5c,EAAQsT,QAAQ,eAAgB,mBAEhCtT,EAGpBirB,GAAmB,WAEnBhC,EAAOlZ,KACH,CACEpN,KAAM,GAAG3C,IACTwB,aAAY,QAAE8gB,EAAO,OAAEC,EAAM,GAAE+H,UACvBQ,GAAeK,mBAAmB7I,EAAS,GAAG2I,cACtD,GAEF,CACEtoB,KAAM,GAAG3C,cACTwB,aAAY,QAAE8gB,EAAO,OAAEC,EAAM,GAAE+H,UACvBQ,GAAeK,mBAAmB7I,EAAS,GAAG2I,cACtD,GAIF,CACEtoB,KAAM,GAAG3C,aACTwB,aAAY,QAAE8gB,EAAO,OAAEC,EAAM,GAAE+H,UACvBQ,GAAeK,mBAAmB7I,EAAS,GAAG2I,aACtD,GAGF,CACEtoB,KAAM,GAAG3C,eACTwB,aAAY,QAAE8gB,EAAO,OAAEC,EAAM,GAAE+H,UACvBQ,GAAeK,mBAAmB7I,EAAS,GAAG2I,eACtD,GAEF,CACEtoB,KAAM,GAAG3C,gBACTwB,aAAY,QAAE8gB,EAAO,OAAEC,EAAM,GAAE+H,UACvBQ,GAAeK,mBAAmB7I,EAAS,GAAG2I,gBACtD,GAEF,CACEtoB,KAAM,GAAG3C,YACTwB,aAAY,QAAE8gB,EAAO,OAAEC,EAAM,GAAE+H,UACvBQ,GAAeK,mBAAmB7I,EAAS,GAAG2I,uBACtD,GAEF,CACEtoB,KAAM,GAAG3C,uBACTwB,aAAY,QAAE8gB,EAAO,OAAEC,EAAM,GAAE+H,UACvBQ,GAAeK,mBAAmB7I,EAAS,GAAG2I,uBACtD,GAEF,CACEtoB,KAAM,GAAG3C,eACTwB,aAAY,QAAE8gB,EAAO,OAAEC,EAAM,GAAE+H,UACvBQ,GAAeK,mBAAmB7I,EAAS,GAAG2I,0BACtD,GAEF,CACEtoB,KAAM,GAAG3C,0BACTwB,aAAY,QAAE8gB,EAAO,OAAEC,EAAM,GAAE+H,UACvBQ,GAAeK,mBAAmB7I,EAAQ,GAAG2I,0BACrD,GAEF,CACEtoB,KAAM,GAAG3C,SACTwB,aAAY,QAAE8gB,EAAO,OAAEC,EAAM,GAAE+H,UACvBQ,GAAeK,mBAAmB7I,EAAS,GAAG2I,oBACtD,GAEF,CACEtoB,KAAM,GAAG3C,oBACTwB,aAAY,QAAE8gB,EAAO,OAAEC,EAAM,GAAE+H,UACvBQ,GAAeK,mBAAmB7I,EAAS,GAAG2I,oBACtD,GAEF,CACEtoB,KAAM,GAAG3C,cACTwB,aAAY,QAAE8gB,EAAO,OAAEC,EAAM,GAAE+H,UACvBQ,GAAeK,mBAAmB7I,EAAS,GAAG2I,yBACtD,GAEF,CACEtoB,KAAM,GAAG3C,yBACTwB,aAAY,QAAE8gB,EAAO,OAAEC,EAAM,GAAE+H,UACvBQ,GAAeK,mBAAmB7I,EAAS,GAAG2I,yBACtD,GAEF,CACEtoB,KAAM,GAAG3C,aACTwB,aAAY,QAAE8gB,EAAO,OAAEC,EAAM,GAAE+H,UACvBQ,GAAeK,mBAAmB7I,EAAS,GAAG2I,wBACtD,GAEF,CACEtoB,KAAM,GAAG3C,wBACTwB,aAAY,QAAE8gB,EAAO,OAAEC,EAAM,GAAE+H,UACvBQ,GAAeK,mBAAmB7I,EAAS,GAAG2I,wBACtD,GAEF,CACEtoB,KAAM,GAAG3C,KACTwB,aAAY,QAAE8gB,EAAO,OAAEC,EAAM,GAAE+H,UACvBQ,GAAeK,mBAAmB7I,EAAS,GAAG2I,gBACtD,GAEF,CACEtoB,KAAM,GAAG3C,gBACTwB,aAAY,QAAE8gB,EAAO,OAAEC,EAAM,GAAE+H,UACvBQ,GAAeK,mBAAmB7I,EAAS,GAAG2I,gBACtD,GAEF,CACEtoB,KAAM,GAAG3C,cACTwB,aAAY,QAAE8gB,EAAO,OAAEC,EAAM,GAAE+H,UACvBQ,GAAeK,mBAAmB7I,EAAS,GAAG2I,yBACtD,GAEF,CACEtoB,KAAM,GAAG3C,yBACTwB,aAAY,QAAE8gB,EAAO,OAAEC,EAAM,GAAE+H,UACvBQ,GAAeK,mBAAmB7I,EAAS,GAAG2I,yBACtD,GAEF,CACEtoB,KAAM,GAAG3C,mBACTwB,aAAY,QAAE8gB,EAAO,OAAEC,EAAM,GAAE+H,UACvBQ,GAAeK,mBAAmB7I,EAAS,GAAG2I,sBACtD,GAEF,CACEtoB,KAAM,GAAG3C,cACTwB,aAAY,QAAE8gB,EAAO,OAAEC,EAAM,GAAE+H,UACvBQ,GAAeK,mBAAmB7I,EAAS,GAAG2I,4BAA2C,CAAEK,OAAO,GAC1G,GAEF,CACE3oB,KAAM,GAAG3C,yBACTwB,aAAY,QAAE8gB,EAAO,OAAEC,EAAM,GAAE+H,UACvBQ,GAAeK,mBAAmB7I,EAAQ,GAAG2I,4BAA2C,CAAEK,OAAO,GACzG,GAEF,CACE3oB,KAAM,GAAG3C,gBACTwB,aAAY,QAAE8gB,EAAO,OAAEC,EAAM,GAAE+H,UACvBQ,GAAeK,mBAAmB7I,EAAS,GAAG2I,mBACtD,GAKV,EClPJ,IAAIM,GAAc/pB,MAAOlB,EAAmBN,EAAgBC,EAAiB+oB,EAAgB7Z,KAIzF,GAFAZ,QAAQC,IAAI,wBAER,kBAAmBgd,UAAW,CAE9B,MAAMC,EAAK,IAAI,KAAQ,GAAGxrB,gBAAuB+oB,OAAc,CAC3D0C,MAAO,MAGX,IAAI5rB,EAAsB,IAAI,IAE9BA,EAAUopB,KAAK,cAAcC,gBAAgB7oB,GAC7CR,EAAUopB,KAAqB,kBAAkBoB,GAAGK,IAAgBJ,mBACpEzqB,EAAUopB,KAAqB,kBAAkBoB,GAAGO,IAA2BN,mBAG/E,IAAItB,EAAS6B,GAAea,iBAAiBrrB,GAE7CR,QAAkB8oB,GAAiB9oB,EAAWE,EAASC,EAAU+oB,EAASC,EAAQ9Z,GAE9Eqc,UAAUI,cAAcC,WACxBC,GAAShsB,EAAWG,GAEpBwrB,EAAGnkB,iBAAiB,eAAe9D,IAC/BsoB,GAAShsB,EAAWG,EAAS,IAIrCwrB,EAAGM,U,GAMPD,GAAWtqB,MAAO1B,EAAqBG,KAGvC,IAAIyE,EAAU5E,EAAUC,IAAI,cAKxBisB,EAAchC,OAAO1U,SAASwE,WAAWxG,QAAQ,GAAGrT,IAAY,IAInDyE,EAAIV,MAAM8e,OAAO,aAAc,CAC5C/O,IAAKiY,IAIArnB,GAAG,QAAQnD,MAAOgoB,IAEvBjb,QAAQC,IAAI,iBAAiBwd,KAE7BxC,EAAKtlB,OAAOC,SAAS6nB,EAAa,CAAEC,eAAe,EAAMC,SAAS,GAAQ,IAG9ExnB,EAAI6kB,MAAM,C","sources":["webpack://library/./src/reader/components/reader/navbar.f7.html","webpack://library/./src/reader/components/reader/token-toolbar.f7.html","webpack://library/./src/reader/components/reader/transaction.f7.html","webpack://library/./src/reader/components/reader/item/mint-list.f7.html","webpack://library/./src/reader/components/reader/channel/attribute-filter.f7.html","webpack://library/./src/reader/components/reader/channel/explore-total-info.f7.html","webpack://library/./src/reader/components/reader/channel/mint-info.f7.html","webpack://library/./src/reader/components/reader/channel/largest-sales.f7.html","webpack://library/./src/reader/components/reader/channel/transaction-row.f7.html","webpack://library/./src/reader/components/reader/channel/leaderboard-rows.f7.html","webpack://library/./src/reader/components/reader/item/search-list.f7.html","webpack://library/./src/reader/components/reader/item/infinite-scroll-content.f7.html","webpack://library/./src/reader/service/core/wallet-service-impl.ts","webpack://library/./src/reader/service/core/database-service.ts","webpack://library/./src/reader/repository/browser/channel-repository-impl.ts","webpack://library/./src/reader/dto/item.ts","webpack://library/./src/reader/repository/browser/item-repository-impl.ts","webpack://library/./src/reader/repository/item-repository.ts","webpack://library/./src/reader/dto/author.ts","webpack://library/./src/reader/repository/browser/author-repository-impl.ts","webpack://library/./src/reader/dto/nft-metadata.ts","webpack://library/./src/reader/repository/browser/metadata-repository-impl.ts","webpack://library/./src/reader/dto/image.ts","webpack://library/./src/reader/repository/browser/image-repository-impl.ts","webpack://library/./src/reader/dto/animation.ts","webpack://library/./src/reader/repository/browser/animation-repository-impl.ts","webpack://library/./src/reader/dto/static-page.ts","webpack://library/./src/reader/repository/browser/static-page-repository-impl.ts","webpack://library/./src/reader/repository/browser/item-page-repository-impl.ts","webpack://library/./src/reader/dto/attribute-total.ts","webpack://library/./src/reader/repository/browser/attribute-total-repository-impl.ts","webpack://library/./src/reader/dto/reader-settings.ts","webpack://library/./src/reader/repository/browser/reader-settings-repository-impl.ts","webpack://library/./src/reader/dto/token.ts","webpack://library/./src/reader/repository/browser/token-repository-impl.ts","webpack://library/./src/reader/service/author-service.ts","webpack://library/./src/reader/service/channel-service.ts","webpack://library/./src/reader/service/core/paging-service.ts","webpack://library/./src/reader/service/core/schema-service.ts","webpack://library/./src/reader/service/image-service.ts","webpack://library/./src/reader/service/static-page-service.ts","webpack://library/./src/reader/service/web/channel-web-service.ts","webpack://library/./src/reader/service/animation-service.ts","webpack://library/./src/reader/service/core/quill-service.ts","webpack://library/./src/reader/service/attribute-total-service.ts","webpack://library/./src/reader/service/item-service.ts","webpack://library/./src/reader/service/item-page-service.ts","webpack://library/./src/reader/service/web/item-web-service.ts","webpack://library/./src/reader/service/web/author-web-service.ts","webpack://library/./src/reader/service/token-contract-service.ts","webpack://library/./src/reader/service/web/mint-web-service.ts","webpack://library/./src/reader/service/core/queue-service.ts","webpack://library/./src/reader/service/core/ui-service.ts","webpack://library/./src/reader/util/validation-exception.ts","webpack://library/./src/reader/service/reader-settings-service.ts","webpack://library/./src/sync/dto/erc-event.ts","webpack://library/./src/reader/service/erc-event-service.ts","webpack://library/./src/reader/service/core/component-state-service.ts","webpack://library/./src/reader/dto/component-state.ts","webpack://library/./src/reader/repository/browser/component-state-repository-impl.ts","webpack://library/./src/reader/service/token-owner-page-service.ts","webpack://library/./src/reader/repository/browser/token-owner-page-repository-impl.ts","webpack://library/./src/reader/service/processed-transaction-service.ts","webpack://library/./src/reader/service/web/transaction-web-service.ts","webpack://library/./src/reader/repository/browser/processed-transaction-repository-impl.ts","webpack://library/./src/reader/dto/token-owner.ts","webpack://library/./src/reader/service/token-owner-service.ts","webpack://library/./src/reader/repository/token-owner-repository.ts","webpack://library/./src/reader/repository/browser/token-owner-repository-impl.ts","webpack://library/./src/reader/service/token-service.ts","webpack://library/./src/reader/repository/browser/row-item-view-model-repository-impl.ts","webpack://library/./src/reader/inversify.config.ts","webpack://library/./src/library/service/web/home-web-service.ts","webpack://library/./src/library/repository/web/home-repository-impl.ts","webpack://library/./src/reader/service/core/routing-service.ts","webpack://library/./src/library/index.ts"],"sourcesContent":["/** @jsx $jsx */\nimport { $jsx } from 'framework7';\nfunction framework7Component(props, {\n  $on,\n  $f7,\n  $update\n}) {\n  let walletService = globalThis.container.get(\"WalletService\");\n  let uiService = globalThis.container.get(\"UiService\");\n  let baseURI = globalThis.container.get(\"baseURI\");\n  let hostname = globalThis.container.get(\"hostname\");\n  let symbol = props.symbol;\n  let logo = props.logo;\n  let title = props.title;\n  let active = props.active;\n  let libraryURL = props.library_url;\n  let largeURL = props.large_url;\n  let showMintPage = props.show_mint_page == \"true\";\n  let showActivityPage = props.show_activity_page == \"true\";\n  let hideMenu = props.hide_menu == \"true\";\n  let breadcrumbs = props.breadcrumbs;\n  let walletAddress;\n  let showConnect = true;\n  const getForkLink = () => {\n    if (largeURL?.length > 0) {\n      return `${largeURL}/index.html#!/admin/channel/fork-reader?path=${encodeURIComponent(`${hostname()}${baseURI()}`)}`;\n    } else {\n      return `${baseURI()}large/index.html#!/admin/channel/fork-reader?path=${encodeURIComponent(`${hostname()}${baseURI()}`)}`;\n    }\n  };\n  const truncateEthAddress = address => {\n    return walletService.truncateEthAddress(address);\n  };\n  const displayAddress = async e => {\n    walletAddress = undefined;\n    if (!walletService.provider) {\n      await walletService.initProvider();\n    }\n    walletAddress = await walletService.getAddress();\n\n    //If no provider still then clear the address so we don't show the button\n    if (!walletService.provider) {\n      showConnect = false;\n    }\n    if (walletAddress) {\n      walletService.address = walletAddress;\n      if (!walletService.wallet) {\n        await walletService.connect();\n      }\n    }\n    $update();\n  };\n  const connectWallet = async e => {\n    await walletService.initWallet();\n\n    //Connect to metamask\n    await walletService.connect();\n    displayAddress();\n  };\n  displayAddress();\n  const showPopoverMenu = async e => {};\n  return function ($ctx) {\n      var $ = $ctx.$;\n      var $h = $ctx.$h;\n      var $root = $ctx.$root;\n      var $f7 = $ctx.$f7;\n      var $f7route = $ctx.$f7route;\n      var $f7router = $ctx.$f7router;\n      var $theme = $ctx.$theme;\n      var $update = $ctx.$update;\n      var $store = $ctx.$store;\n\n      return $h`\r\n\r\n    <div class=\"navbar\">\r\n        <div class=\"navbar-bg\"></div>\r\n\r\n        <div class=\"navbar-inner sliding\">\r\n                \r\n          <div class=\"left\">\r\n            <a href=\"${libraryURL?.length > 0 ? libraryURL : baseURI() }\">\r\n              <i class=\"f7-icons\">house</i>\r\n            </a>\r\n          </div>\r\n\r\n\r\n          <div class=\"title\">${title}</div>\r\n          \r\n          <div class=\"right\">\r\n            \r\n            ${!hideMenu ? $h`\r\n              \r\n              <div class=\"small-only\">\r\n\r\n                <a href=\"#\" class=\"link popover-open\" data-popover=\".popover-menu\">\r\n                  <i class=\"f7-icons\">menu</i>\r\n                </a> \r\n  \r\n                <div class=\"popover popover-menu\">\r\n                  <div class=\"popover-angle\"></div>\r\n                  <div class=\"popover-inner\">                    \r\n                    <div class=\"list\">\r\n                      <ul>\r\n  \r\n                        ${showConnect ? $h`\r\n          \r\n                            <li>\r\n                              <div class=\"item-content\">\r\n                                <div class=\"item-inner\">\r\n                                    <div class=\"item-title\">\r\n                                        ${walletAddress != undefined ? $h`\r\n                                          <a href=\"#\">${truncateEthAddress(walletAddress)}</a>\r\n                                      ` : $h`\r\n                                          <button class=\"button button-outline button-fill\" @click=${connectWallet}>\r\n                                            Connect Wallet\r\n                                          </button>\r\n                                      `} \r\n                                    </div>\r\n                                </div>\r\n                              </div>\r\n                            </li>\r\n  \r\n                            ${showMintPage ? $h`\r\n                              <li>\r\n                                <a href=\"${baseURI()}mint.html\" class=\"item-link popover-close\">\r\n                                  <div class=\"item-content\">\r\n                                    <div class=\"item-inner\">\r\n                                        <div class=\"item-title\">\r\n                                            Mint\r\n                                        </div>\r\n                                    </div>\r\n                                  </div>\r\n                                </a>\r\n                              </li>\r\n                            ` : $h`<span />`}\r\n  \r\n                                \r\n                          ` : $h`<span />`}\r\n  \r\n  \r\n  \r\n  \r\n                        <li>\r\n                          <a href=\"${getForkLink()}\" class=\"item-link external popover-close\">\r\n                            <div class=\"item-content\">\r\n                              <div class=\"item-inner\">\r\n                                  <div class=\"item-title\">\r\n                                    Fork\r\n                                  </div>\r\n                              </div>\r\n                            </div>\r\n                          </a>\r\n                        </li>\r\n    \r\n  \r\n  \r\n  \r\n                        <li>\r\n                          <a href=\"${baseURI()}explore.html\" class=\"item-link popover-close\">\r\n                            <div class=\"item-content\">\r\n                              <div class=\"item-inner\">\r\n                                  <div class=\"item-title\">\r\n                                      Explore\r\n                                  </div>\r\n                              </div>\r\n                            </div>\r\n                          </a>\r\n                        </li>\r\n  \r\n  \r\n                        ${showActivityPage ? $h`\r\n                          <li>\r\n                            <a href=\"${baseURI()}activity\" class=\"item-link popover-close\">\r\n                              <div class=\"item-content\">\r\n                                <div class=\"item-inner\">\r\n                                    <div class=\"item-title\">\r\n                                        Activity\r\n                                    </div>\r\n                                </div>\r\n                              </div>\r\n                            </a>\r\n                          </li>\r\n  \r\n                          <li>\r\n                            <a href=\"${baseURI()}leaderboard\" class=\"item-link popover-close\">\r\n                              <div class=\"item-content\">\r\n                                <div class=\"item-inner\">\r\n                                    <div class=\"item-title\">\r\n                                        Leaderboard\r\n                                    </div>\r\n                                </div>\r\n                              </div>\r\n                            </a>\r\n                          </li>\r\n  \r\n  \r\n                        ` : $h`<span />`}\r\n  \r\n                      </ul>\r\n                \r\n                    </div>\r\n        \r\n                  </div>\r\n                </div>\r\n  \r\n              </div>\r\n  \r\n              <div class=\"large-only\">\r\n    \r\n                <a href=\"${getForkLink()}\" class=\"external link\">\r\n                  Fork\r\n                </a>\r\n  \r\n                <a class=\"link ${active == 'Explore' ? $h`link-active` : $h` `}\" href=\"${baseURI()}explore.html\">\r\n                  Explore\r\n                </a>      \r\n  \r\n                ${showActivityPage ? $h`\r\n                  <a class=\"link ${active == 'Activity' ? $h`link-active` : $h` `}\" href=\"${baseURI()}activity\">\r\n                    Activity\r\n                  </a> \r\n  \r\n                  <a class=\"link ${active == 'Leaderboard' ? $h`link-active` : $h` `}\" href=\"${baseURI()}leaderboard\" >\r\n                    Leaderboard\r\n                  </a> \r\n  \r\n                ` : $h`<span />`}\r\n  \r\n                ${showConnect ? $h`\r\n  \r\n                  ${showMintPage ? $h`\r\n                    <a class=\"link ${active == 'Mint' ? $h`link-active` : $h` `}\" href=\"${baseURI()}mint.html\" >\r\n                      Mint\r\n                    </a> \r\n                  ` : $h`<span />`}\r\n  \r\n                  ${walletAddress != undefined ? $h`\r\n                      <a href=\"${baseURI()}u/?address=${walletAddress}\" class=\"link\" >${truncateEthAddress(walletAddress)}</a>\r\n                  ` : $h`\r\n                      <a class=\"link\" @click=\"${connectWallet}\">Connect Wallet</a>\r\n                  `} \r\n       \r\n                ` : $h`<span style=\"display: none;\" />`}\r\n  \r\n              </div>\r\n              \r\n            ` : $h` `}\r\n            \r\n          </div>\r\n\r\n\r\n\r\n          ${breadcrumbs ? $h`\r\n                  \r\n            <div class=\"subnavbar\">\r\n              <div class=\"subnavbar-inner\">\r\n        \r\n                <div class=\"breadcrumbs \">\r\n  \r\n                  ${breadcrumbs.map( b => $h`\r\n                    <div class=\"breadcrumbs-item\">\r\n\r\n                      ${b.path ? $h`\r\n                        <a href=\"${b.path}\" class=\"link\">\r\n                          ${b.text}\r\n                        </a>\r\n                      ` : $h`${b.text}`}\r\n\r\n\r\n                    </div>  \r\n\r\n                    ${b.path ? $h`\r\n                      <div class=\"breadcrumbs-separator\"></div>\r\n                    ` : $h`<span />`}\r\n\r\n                    \r\n                  `)}\r\n\r\n                </div>\r\n        \r\n              </div>\r\n            </div>\r\n\r\n\r\n            ` : $h`<span />`}\r\n\r\n\r\n\r\n          \r\n        </div>\r\n        \r\n    </div>\r\n\r\n`\n    }\n    ;\n}\nframework7Component.id = '7142f455a5';\nexport default framework7Component;","/** @jsx $jsx */\nimport { $jsx } from 'framework7';\nfunction framework7Component(props, {\n  $on,\n  $,\n  $f7,\n  $update\n}) {\n  let baseURI = globalThis.container.get(\"baseURI\");\n  let readerSettingsService = globalThis.container.get(\"ReaderSettingsService\");\n  let tokenId = props.token_id;\n  let itemCount = props.item_count;\n  let currentPage = props.current_page;\n  const link = href => {\n    return baseURI() + href;\n  };\n  const rangeSliderChange = async e => {\n    e.preventDefault();\n    let tokenId = $(e.currentTarget).val();\n    $f7.preloader.show();\n    if (tokenId > 0) {\n      await readerSettingsService.updateCurrentPage(parseInt(tokenId));\n      $f7.views.main.router.navigate(link('t/' + tokenId), {\n        transition: 'f7-flip'\n      });\n    } else {\n      $f7.views.main.router.navigate(link(`index.html`));\n    }\n    $f7.preloader.hide();\n  };\n  const rangeChange = e => {\n    e.preventDefault();\n    const range = $f7.range.get(e.target);\n    tokenId = range.value;\n    $update();\n  };\n  app.on('current-page-updated', function (p) {\n    currentPage = p;\n    $update();\n  });\n  return function ($ctx) {\n      var $ = $ctx.$;\n      var $h = $ctx.$h;\n      var $root = $ctx.$root;\n      var $f7 = $ctx.$f7;\n      var $f7route = $ctx.$f7route;\n      var $f7router = $ctx.$f7router;\n      var $theme = $ctx.$theme;\n      var $update = $ctx.$update;\n      var $store = $ctx.$store;\n\n      return $h`\r\n\r\n  <div class=\"toolbar toolbar-bottom\">\r\n    <div class=\"toolbar-inner\">\r\n\r\n        <div style=\"width: 100%; margin-bottom: -20px;\">\r\n\r\n            <div style=\"display: flex;\">\r\n            \r\n                ${currentPage && tokenId == 0 ? $h`\r\n                    <a href=\"${link(`t/${currentPage}`)}\" class=\"button button-outline back-to-page\">\r\n                        Back to page ${currentPage}\r\n                    </a>\r\n                ` : $h`<span />`}\r\n    \r\n    \r\n                <div class=\"range-slider range-slider-init\" \r\n                    @range:change=${rangeChange}\r\n                    data-label=\"true\"\r\n                    >\r\n                \r\n                    <!-- range input -->\r\n                    <input type=\"range\" \r\n                        min=\"0\" \r\n                        max=\"${itemCount}\"\r\n                        step=\"1\" \r\n                        value=\"${tokenId}\" \r\n                        @change=\"${rangeSliderChange}\"\r\n                />\r\n                </div>\r\n\r\n\r\n            </div>\r\n\r\n            <div class=\"page-number\" style=\"width: 100%;\">\r\n                Page <strong>${tokenId}</strong> of ${itemCount}\r\n            </div>\r\n\r\n\r\n        </div>\r\n\r\n\r\n\r\n\r\n\r\n    </div>\r\n  </div>\r\n\r\n`\n    }\n    ;\n}\nframework7Component.id = 'c59fc5fc87';\nframework7Component.style = `\n.page-number {\n    width: 100%;\n    text-align: center;\n    font-size: 13px;\n    margin-bottom: 15px;\n}\n\n.range-slider {\n    width: 100%;\n    margin-left: 20px; \n    margin-right: 20px;\n    flex: 1;\n}\n\n.toolbar a.back-to-page {\n    height: 45px;\n    width: 70px;\n    margin-left: 10px;\n    flex: 0 0 70px;\n    font-size: 10px;\n    text-transform: none;\n    white-space: normal;\n    line-height: 13px;\n}\n`;\nexport default framework7Component;","/** @jsx $jsx */\nimport { $jsx } from 'framework7';\nfunction framework7Component(props, {\n  $on,\n  $f7,\n  $update\n}) {\n  // let walletService = globalThis.container.get(\"WalletService\")\n\n  return function ($ctx) {\n      var $ = $ctx.$;\n      var $h = $ctx.$h;\n      var $root = $ctx.$root;\n      var $f7 = $ctx.$f7;\n      var $f7route = $ctx.$f7route;\n      var $f7router = $ctx.$f7router;\n      var $theme = $ctx.$theme;\n      var $update = $ctx.$update;\n      var $store = $ctx.$store;\n\n      return $h`\r\n\r\n\r\n\r\n\r\n`\n    }\n    ;\n}\nframework7Component.id = '811c652532';\nframework7Component.style = `\n\n\n\n\n`;\nexport default framework7Component;","/** @jsx $jsx */\nimport { $jsx } from 'framework7';\nfunction framework7Component(props, {\n  $,\n  $on,\n  $f7,\n  $update\n}) {\n  let mintWebService = globalThis.container.get(\"MintWebService\");\n  let walletService = globalThis.container.get(\"WalletService\");\n  let queueService = globalThis.container.get(\"QueueService\");\n  let baseURI = globalThis.container.get(\"baseURI\")();\n  let mintingViewModel;\n  let total = 0;\n  let quantity = 1;\n  let mintPriceWei;\n  let exactTokensOnly = false;\n  let baseURL = props.baseurl;\n  const link = href => {\n    return `${baseURL + href}`;\n  };\n  const updateTotal = async () => {\n    total = await mintWebService.updateTotal(mintPriceWei, quantity);\n    await $update();\n  };\n  $on('stepper:change', async e => {\n    quantity = parseInt(e.detail);\n    await updateTotal();\n    selectPreviews(quantity);\n  });\n  const selectPreviews = amount => {\n    let selected = 0;\n    $('.flex-card').each(ele => {\n      //Remove selected from all\n      $(ele).removeClass('selected');\n      if (selected < amount) {\n        $(ele).addClass('selected');\n        selected++;\n        // console.log(ele)\n      }\n    });\n  };\n\n  const mintOnSubmit = async e => {\n    e.preventDefault();\n\n    //Make sure we are connected\n    await walletService.connect();\n    let mintFunction;\n    if (exactTokensOnly) {\n      let start = parseInt(mintingViewModel.totalMinted + 1);\n      mintFunction = mintWebService.mintFromStartOrFail(quantity, start);\n    } else {\n      mintFunction = mintWebService.mint(quantity);\n    }\n    let promiseView = {\n      title: `Minting token(s). Approve transaction and wait for it to be mined.`,\n      promise: mintFunction\n    };\n\n    //Wait for it to be mined\n    await queueService.queuePromiseView(promiseView);\n  };\n  const exactTokensOnChange = async e => {\n    exactTokensOnly = e.currentTarget.checked;\n    await $update();\n  };\n  $f7.preloader.show();\n  const populate = async () => {\n    await walletService.connect();\n    try {\n      mintingViewModel = await mintWebService.getMintingViewModel();\n      mintPriceWei = await mintWebService.parseUnits(mintingViewModel.mintPrice, 'ether');\n      await updateTotal();\n      let e = new CustomEvent('mint-view-model-loaded');\n      e.mintingViewModel = mintingViewModel;\n      document.dispatchEvent(e);\n      $f7.preloader.hide();\n    } catch (ex) {\n      $f7.dialog.confirm(\"Problem connecting to contract on Ethereum Mainnet. Is your wallet connected to the right network?\", \"Problem connecting to network\", populate, () => {\n        $f7.views.main.router.navigate(baseURI);\n      });\n      $f7.preloader.hide();\n    }\n  };\n  populate();\n  let mintEventHandler = async e => {\n    if (e.tokenId > mintingViewModel?.totalMinted) {\n      mintingViewModel = await mintWebService.getMintingViewModel();\n      await $update();\n      let e = new CustomEvent('mint-view-model-refreshed');\n      e.mintingViewModel = mintingViewModel;\n      e.quantity = quantity;\n      document.dispatchEvent(e);\n    }\n  };\n  document.removeEventListener('mint-event', mintEventHandler);\n  document.addEventListener('mint-event', mintEventHandler);\n  return function ($ctx) {\n      var $ = $ctx.$;\n      var $h = $ctx.$h;\n      var $root = $ctx.$root;\n      var $f7 = $ctx.$f7;\n      var $f7route = $ctx.$f7route;\n      var $f7router = $ctx.$f7router;\n      var $theme = $ctx.$theme;\n      var $update = $ctx.$update;\n      var $store = $ctx.$store;\n\n      return $h`\n\n  <div>\n    \n    ${mintingViewModel ? $h`\n\n      ${mintingViewModel.minting ? $h`\n\n          <div class=\"card\">\n            <div class=\"card-header card-header-divider\">Create a digital collectible!</div>\n            <div class=\"card-content card-content-padding\">\n\n              <div class=\"list simple-list inset mint-list-info\">\n                <ul>\n                  <li>NFTs are minted in sequential order.</li>\n                  <li>Limited supply!</li>\n                </ul>\n              </div>\n\n            </div>\n          </div>\n\n          <div class=\"block block-strong inset\">\n            <p>\n              <strong>Total Minted:</strong> ${mintingViewModel.totalMinted} of ${mintingViewModel.totalSupply}\n            </p>              \n          </div>\n\n          \n          <div class=\"card\">\n            <div class=\"card-header card-header-divider\">Select between 1-10 NFTs and click the mint button.</div>\n            <div class=\"card-content card-content-padding\">\n              <form class=\"list no-hairlines inset\" @submit=\"${mintOnSubmit}\">\n                <ul>\n    \n                  <li class=\"item-content item-input\">\n                    <div class=\"item-inner\">\n                      <div class=\"item-title item-label\">Select number of NFTs to mint.</div>\n                      <div class=\"item-input-wrap\">\n    \n                        <div class=\"stepper\">\n                          <!-- Stepper minus/decrement button -->\n                          <div class=\"stepper-button-minus\"></div>\n                          <!-- Stepper input -->\n                          <div class=\"stepper-input-wrap\">\n                            <!-- recommended to make input not editable (readonly) -->\n                            <input type=\"text\" readonly value=\"1\" />\n                          </div>\n                          <!-- Stepper plus/increment button -->\n                          <div class=\"stepper-button-plus\"></div>\n                        </div>\n                        <!-- <div class=\"range-slider range-slider-init\" data-label=\"true\" data-scale=\"true\" data-scale-steps=\"5\" >\n                          <input type=\"range\" value=\"1\" min=\"0\" max=\"10\" step=\"1\" />\n                        </div> -->\n                      </div>\n                    </div>\n                  </li>\n    \n                  <li>\n                    <div class=\"item-content\">\n                        <div class=\"item-inner\">\n                            <div class=\"item-title mint-detail\">\n                              <p>\n                                <strong>Mint Fee:</strong> ${mintingViewModel.mintPrice} ETH\n                              </p>\n                              <p>\n                                <strong>Quantity:</strong> ${quantity} \n                              </p>\n                              <p>\n                                <strong>Total:</strong> ${total} ETH\n                              </p>\n                            </div>\n                        </div>\n                    </div>\n                  </li>\n    \n                  <li style=\"display:none;\">\n                    <label class=\"item-checkbox item-content\">\n    \n                        <input type=\"checkbox\" checked=\"${exactTokensOnly}\" @change=${exactTokensOnChange}/>\n                        \n                        <i class=\"icon icon-checkbox\"></i>\n                        <div class=\"item-inner\">\n    \n                            <div class=\"item-title\">\n                              <!-- Item header, must be first child of item-title -->\n                              <div class=\"item-header\"></div>\n                              Exact Tokens Only\n                              <!-- Item footer, must be last child of item-title -->\n                              <div class=\"item-footer\">If this box is checked the transaction will immediately fail if another transaction mints *any* of the selected tokens.</div>\n                            </div>\n    \n                        </div>\n                    </label>\n                  </li>\n    \n                  <li>\n                    <div class=\"item-content\">\n                        <div class=\"item-inner\">\n                          <button class=\"button button-fill ${quantity < 1 ? 'disabled': ''}\" id=\"mint-button\">Mint</button>\n                        </div>\n                    </div>\n                  </li>\n                  \n                </ul>\n    \n              </form>\n            </div>\n          </div>\n\n\n\n\n\n          <div class=\"card mint-list-card\"  style=\"display:none\">\n            <div class=\"card-header\">Next Up</div>\n            <div class=\"card-content\">\n\n              <div class=\"list cards-list virtual-list\" id=\"mint-list\">\n                <ul class=\"item-flex\"></ul>\n              </div>\n        \n              <div class=\"preloader infinite-scroll-preloader\"></div>\n\n            </div>\n          </div>\n          \n      ` : $h`\n        <div class=\"card\">\n          <div class=\"card-header\">Minting Complete</div>\n          <div class=\"card-content card-content-padding\">\n            Minting is complete. Thank you!\n          </div>\n        </div>\n      \n      `}\n    \n    ` : $h`\n      <li class=\"card skeleton-text skeleton-effect-wave\">\n        <div class=\"card-header\">Loading Loading Loading</div>\n        <div class=\"card-content card-content-padding\">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi lobortis et massa ac\n            interdum. Cras consequat felis at consequat hendrerit. Aliquam vestibulum vitae lorem ac iaculis.\n            Praesent nec pharetra massa, at blandit lectus. Sed tincidunt, lectus eu convallis elementum, nibh nisi\n            aliquet urna, nec imperdiet felis sapien at enim.</div>\n      </li>\n    `}\n    \n  </div>\n\n\n\n`\n    }\n    ;\n}\nframework7Component.id = 'b9c432977a';\nframework7Component.style = `\n\n\n\n.mint-list-card .card-header {\n  font-size: 27px;\n  font-weight: bold;\n}\n\n.mint-list-card .block {\n  margin-top: 10px;\n  margin-bottom: 10px;\n}\n\n.mint-list-info li {\n  white-space: unset;\n  line-height: unset;\n  height: unset;\n  padding-top: 10px;\n  padding-bottom: 10px;\n}\n\n`;\nexport default framework7Component;","/** @jsx $jsx */\nimport { $jsx } from 'framework7';\nlet attributeOptions;\nlet filters = [];\nlet attributeParams = {};\nlet handlerBody;\nlet handler = async e => {\n  return handlerBody(e);\n};\nfunction framework7Component(props, {\n  $,\n  $on,\n  $f7,\n  $update\n}) {\n  filters = [];\n  attributeParams = {};\n  handlerBody = async e => {\n    attributeOptions = e.attributeOptions;\n    if (e.attributeParams) {\n      attributeParams = e.attributeParams;\n      $('#attribute-accordian-item').addClass('accordion-item-opened');\n    }\n    await $update();\n  };\n  document.removeEventListener('attribute-options-loaded', handler);\n  document.addEventListener('attribute-options-loaded', handler);\n  const attributeChange = e => {\n    attributeParams[e.currentTarget.name] = e.currentTarget.value;\n    if (e.currentTarget.value) {\n      attributeParams[e.currentTarget.name] = e.currentTarget.value;\n    } else {\n      delete attributeParams[e.currentTarget.name];\n    }\n\n    //Dispatch event so we can refresh list\n    let ev = new CustomEvent('explore-attribute-filter-changed');\n    ev.attributeParams = attributeParams;\n    document.dispatchEvent(ev);\n  };\n  const deleteChipClick = async e => {\n    let attributeId = $(e.currentTarget).data('id');\n    delete attributeParams[attributeId];\n    await $update();\n\n    //Dispatch event so we can refresh list\n    let ev = new CustomEvent('explore-attribute-filter-changed');\n    ev.attributeParams = attributeParams;\n    document.dispatchEvent(ev);\n  };\n  return function ($ctx) {\n      var $ = $ctx.$;\n      var $h = $ctx.$h;\n      var $root = $ctx.$root;\n      var $f7 = $ctx.$f7;\n      var $f7route = $ctx.$f7route;\n      var $f7router = $ctx.$f7router;\n      var $theme = $ctx.$theme;\n      var $update = $ctx.$update;\n      var $store = $ctx.$store;\n\n      return $h`\n\n  <div>\n\n    <div class=\"block block-strong row\">\n      \n      <div class=\"col-50\">\n\n        ${Object.keys(attributeParams).map(key => $h`\n          <div class=\"chip\">\n            <div class=\"chip-label\">${key}: ${attributeParams[key]}</div>\n            <a href=\"#\" class=\"chip-delete\" @click=\"${deleteChipClick}\" data-id=\"${key}\"></a>\n          </div>\n        `)}\n\n      </div>\n      <div class=\"col-50 filter-button\">\n        \n        <a href=\"#\" data-popup=\".filter-popup\" class=\"popup-open\">Filters (${Object.keys(attributeParams).length})</a>\n\n        <div class=\"popup filter-popup\">\n          <div class=\"view\">\n            <div class=\"page\">\n              <div class=\"navbar\">\n                <div class=\"navbar-bg\"></div>\n                <div class=\"navbar-inner\">\n                  <div class=\"title\">Filters</div>\n                  <div class=\"right\">\n                    <!-- Link to close popup -->\n                    <a class=\"link popup-close\">Close</a>\n                  </div>\n                </div>\n              </div>\n              <div class=\"page-content\">\n\n                <div class=\"list\">\n                  <ul>\n                    ${attributeOptions?.map( ao => $h`\n                      <li class=\"item-content item-input\">\n                        <div class=\"item-inner\">\n                          <div class=\"item-title item-label\">${ao.traitType}</div>\n                          <div class=\"item-input-wrap input-dropdown-wrap\">\n                            <select name=\"${ao.traitType}\" @change=\"${attributeChange}\">\n                              <option selected ></option>\n                              ${ao.values?.map( v => $h`\n                                ${v.value == attributeParams[ao.traitType] ? $h`\n                                  <option value=\"${v.value}\" selected>${v.value} (${v.count})</option>\n                                ` : $h`\n                                  <option value=\"${v.value}\">${v.value} (${v.count})</option>\n                                `} \n                              `)}\n                            </select>\n                          </div>\n                        </div>\n                      </li>\n                    `)}\n                  </ul>\n                </div>\n\n              </div>\n            </div>\n          </div>\n        </div>\n\n      </div>\n\n    </div>\n\n\n\n\n  </div>\n\n\n\n\n\n\n`\n    }\n    ;\n}\nframework7Component.id = 'd7d485031b';\nframework7Component.style = `\n\n.item-content.attribute-select {\n  width: 175px;\n  display: inline-block;\n}\n\n\n`;\nexport default framework7Component;","/** @jsx $jsx */\nimport { $jsx } from 'framework7';\nfunction framework7Component(props, {\n  $,\n  $on,\n  $f7,\n  $update\n}) {\n  let totalItems;\n  let totalMatches;\n  document.addEventListener('explore-total-info-changed', async e => {\n    totalItems = e.totalItems;\n    totalMatches = e.totalMatches;\n    await $update();\n  });\n  return function ($ctx) {\n      var $ = $ctx.$;\n      var $h = $ctx.$h;\n      var $root = $ctx.$root;\n      var $f7 = $ctx.$f7;\n      var $f7route = $ctx.$f7route;\n      var $f7router = $ctx.$f7router;\n      var $theme = $ctx.$theme;\n      var $update = $ctx.$update;\n      var $store = $ctx.$store;\n\n      return $h`\n\n  <div class=\"block-title block-title-small\">\n\n    ${totalMatches ? $h`\n\n      ${totalMatches != totalItems ? $h`\n        Showing ${totalMatches} results (${totalItems} total)\n      ` : $h`\n        Showing 1 - ${totalItems} results  \n      `}\n\n    ` : $h`<span/>`}\n\n  </div>\n\n`\n    }\n    ;\n}\nframework7Component.id = 'f36f095ced';\nframework7Component.style = `\n\n\n`;\nexport default framework7Component;","/** @jsx $jsx */\nimport { $jsx } from 'framework7';\nfunction framework7Component(props, {\n  $,\n  $on,\n  $f7,\n  $update\n}) {\n  let hasProvider = false;\n  let mintingViewModel;\n  let baseURL = props.baseurl;\n  const link = href => {\n    return `${baseURL + href}`;\n  };\n  app.on('minting-view-model-updated', function (m) {\n    mintingViewModel = m;\n    $update();\n  });\n  return function ($ctx) {\n      var $ = $ctx.$;\n      var $h = $ctx.$h;\n      var $root = $ctx.$root;\n      var $f7 = $ctx.$f7;\n      var $f7route = $ctx.$f7route;\n      var $f7router = $ctx.$f7router;\n      var $theme = $ctx.$theme;\n      var $update = $ctx.$update;\n      var $store = $ctx.$store;\n\n      return $h`\r\n\r\n  <div class=\"card card-header-divider\">\r\n    <div class=\"card-header\">Mint NFTs</div>\r\n    <div class=\"card-content card-content-padding\">\r\n\r\n      ${mintingViewModel ? $h`\r\n        <p>\r\n          <strong>Total Minted:</strong> ${mintingViewModel.totalMinted} of ${mintingViewModel.totalSupply}\r\n        </p>\r\n\r\n        <a href=\"${link('mint.html')}\" class=\"link\">Mint NFTs</a>\r\n\r\n      ` : $h`\r\n        Minting information unavailable. \r\n        <p>Note: Use a web browser with wallet support to see NFT information.</p>\r\n      `}\r\n\r\n\r\n    </div>\r\n  </div>\r\n\r\n`\n    }\n    ;\n}\nframework7Component.id = '66dd209e59';\nframework7Component.style = `\n`;\nexport default framework7Component;","/** @jsx $jsx */\nimport { $jsx } from 'framework7';\nfunction framework7Component(props, {\n  $,\n  $on,\n  $f7,\n  $update\n}) {\n  let walletService = globalThis.container.get(\"WalletService\");\n  let mintWebService = globalThis.container.get(\"MintWebService\");\n  let transactionWebService = globalThis.container.get(\"TransactionWebService\");\n  let baseURI = globalThis.container.get(\"baseURI\")();\n  const link = href => {\n    return baseURI + href;\n  };\n  let largestSales = props.largest_sales;\n  return function ($ctx) {\n      var $ = $ctx.$;\n      var $h = $ctx.$h;\n      var $root = $ctx.$root;\n      var $f7 = $ctx.$f7;\n      var $f7route = $ctx.$f7route;\n      var $f7router = $ctx.$f7router;\n      var $theme = $ctx.$theme;\n      var $update = $ctx.$update;\n      var $store = $ctx.$store;\n\n      return $h`\n\n    <div class=\"block block-strong inset largest-sales\">\n                    \n      ${largestSales?.sales?.map( (sale, index) => $h`\n        <div class=\"margin-bottom\">\n\n          <div class=\"rank\">#${index+1}</div>\n\n          <div class=\"square\">\n            <a href=\"${link(`t/${sale.tokenId}`)}\" class=\"item-link\">\n              <img src=\"${link(`backup/export/images/${largestSales.rowItemViewModels[sale.tokenId].coverImageId}.${largestSales.rowItemViewModels[sale.tokenId].coverImageGenerated ? 'svg' : 'jpg'}`)}\" alt=\"${sale.tokenId}\" height=\"125\" width=\"125\"/>\n            </a>\n          </div>\n\n          <div class=\"sale-info margin-top\">\n            <a href=\"${link(`t/${sale.tokenId}`)}\" class=\"item-link\">${largestSales.rowItemViewModels[sale.tokenId].title}</a><br />\n            ${new Intl.NumberFormat('en-US').format(sale.ethValue)} ETH (${transactionWebService.abbreviateDollars(sale.usdValue, 2)})\n            <div class=\"date\">${dayjs(sale.date).format('LL')}</div>\n          </div>\n\n        </div>\n      `)}\n      </div>\n\n  \n`\n    }\n    ;\n}\nframework7Component.id = '9b4a0c921a';\nexport default framework7Component;","/** @jsx $jsx */\nimport { $jsx } from 'framework7';\n// create local component\nconst Transfer = (props, {\n  $h\n}) => {\n  let walletService = globalThis.container.get(\"WalletService\");\n  let transactionWebService = globalThis.container.get(\"TransactionWebService\");\n  const link = href => {\n    return `${baseURI + href}`;\n  };\n  const imageLink = rowItemViewModel => {\n    if (!rowItemViewModel) return;\n    if (rowItemViewModel?.coverImageGenerated) {\n      return link('backup/export/images/' + rowItemViewModel.coverImageId + \".svg\");\n    }\n    return link('backup/generated/images/50x50/' + rowItemViewModel.coverImageId + \".webp\");\n  };\n  let transaction = props.transaction;\n  let event = props.event;\n  let baseURI = props.base_uri;\n  let rowItemViewModels = props.row_item_view_models;\n  let index = props.index;\n  return () => $h`\n    \n        <tr ${index % 2 == 0 ? 'class=\"alt-row\"' : ''}>\n\n          <td class=\"image\">\n            <a href=\"${baseURI}t/${event.tokenId}\">\n              <img src=\"${imageLink(rowItemViewModels[event.tokenId])}\" class=\"latest-img\" alt=\"${rowItemViewModels[event.tokenId]?.title}\" height=\"50\" width=\"50\" alt=\"Item cover image\"/> \n            </a>\n          </td>\n\n          <td class=\"label-cell medium-only\">\n\n            <a href=\"${baseURI}t/${event.tokenId}\" class=\"title\">\n              ${rowItemViewModels[event.tokenId]?.title}            \n            </a>\n\n          </td>\n          <td>\n            ${event.isMint ? $h`\n              <a href=\"https://etherscan.io/tx/${transaction._id}\" class=\"external\" target=\"_blank\">Mint</a>\n            ` : $h`\n\n              ${transaction?.transactionValue?.markets && Object.keys(transaction?.transactionValue?.markets).length > 0 ? $h`\n                <a href=\"https://etherscan.io/tx/${transaction._id}\" class=\"external\" target=\"_blank\">Sold</a> on ${Array.from(Object.keys(transaction.transactionValue?.markets).map(k => k)).join(\", \")} ${transaction.transactionValue?.aggregator ? ' / ' + transaction.transactionValue.aggregator : ''}\n\n              ` : $h`\n                <a href=\"https://etherscan.io/tx/${transaction._id}\" class=\"external\" target=\"_blank\">${event.event}</a>\n              `}\n              \n            `}\n\n            <p class=\"date\">${dayjs(transaction.timestamp * 1000).fromNow()}</p>\n          </td>\n\n          <td class=\"numeric-cell\">\n            \n            <span class=\"eth-value\">${transaction.transactionValue?.tokenPrice[event.tokenId]?.price.toFixed(5)} ${transaction.transactionValue?.tokenPrice[event.tokenId]?.currency}</span>\n            ${transaction.transactionValue?.tokenPrice[event.tokenId]?.usdValue ? $h`\n              <br />\n              <span class=\"dollar-value\">${transactionWebService.abbreviateDollars(transaction.transactionValue?.tokenPrice[event.tokenId]?.usdValue, 2)}</span>\n            ` : $h` `}\n\n           </td>\n          <td class=\"numeric-cell medium-only\">\n            <a href=\"${baseURI}u/?address=${event.fromAddress}\" class=\"${event.fromAddress == transaction.from ? 'is-from' : ''}\">\n                  ${getDisplayAddress(event.fromAddress)}\n            </a> <span class=\"f7-icons\">arrow_right</span>\n\n            <a href=\"${baseURI}u/?address=${event.toAddress}\" class=\"${event.toAddress == transaction.from ? 'is-from' : ''}\">\n              ${getDisplayAddress(event.toAddress)}\n            </a>\n\n          </td>\n        </tr>\n    `;\n};\nconst Approval = (props, {\n  $h\n}) => {\n  let walletService = globalThis.container.get(\"WalletService\");\n  let transactionWebService = globalThis.container.get(\"TransactionWebService\");\n  const link = href => {\n    return `${baseURI + href}`;\n  };\n  const imageLink = rowItemViewModel => {\n    if (rowItemViewModel.coverImageGenerated) {\n      return link('backup/export/images/' + rowItemViewModel.coverImageId + \".svg\");\n    }\n    return link('backup/generated/images/50x50/' + rowItemViewModel.coverImageId + \".webp\");\n  };\n  let transaction = props.transaction;\n  let event = props.event;\n  let baseURI = props.base_uri;\n  let rowItemViewModels = props.row_item_view_models;\n  let index = props.index;\n  let owner = event?.namedArgs?.owner;\n  let approved = event?.namedArgs?.approved;\n  let from = transaction?.from;\n  return () => $h`\n      <tr class=\"${index % 2 == 0 ? \"alt-row\" : ''}\">\n\n          <td class=\"image\">\n            <a href=\"${baseURI}t/${event.tokenId}\">\n              <img src=\"${imageLink(rowItemViewModels[event.tokenId])}\" class=\"latest-img\" alt=\"${rowItemViewModels[event.tokenId].title}\" height=\"40\" width=\"40\" alt=\"Item cover image\" /> \n            </a>\n          </td>\n\n          <td class=\"label-cell medium-only\">\n\n            <a href=\"${baseURI}t/${event.tokenId}\" class=\"title\">\n              ${rowItemViewModels[event.tokenId].title}            \n            </a>\n\n            \n          </td>\n          <td>\n            <a href=\"https://etherscan.io/tx/${transaction._id}\" class=\"external\" target=\"_blank\">${event.event}</a> <br />\n            \n            <p class=\"date\">${dayjs(transaction.timestamp * 1000).fromNow()}</p>\n          </td>\n\n          <td class=\"numeric-cell\"></td>\n          <td class=\"medium-only numeric-cell\">\n            <a href=\"#\">${approved}</a>\n          </td>\n        </tr>\n    `;\n};\nconst ApprovalForAll = (props, {\n  $h\n}) => {\n  let walletService = globalThis.container.get(\"WalletService\");\n  let transactionWebService = globalThis.container.get(\"TransactionWebService\");\n  let transaction = props.transaction;\n  let event = props.event;\n  let baseURI = props.base_uri;\n  let index = props.index;\n  return () => $h`\n        <tr class=\"${index % 2 == 0 ? \"alt-row\" : ''}\">\n\n          <td class=\"image\">\n            ${event.namedArgs.approved ? $h`🟢` : $h`🔴`}\n          </td>\n\n          <td class=\"label-cell medium-only\">\n            \n          </td>\n          <td>\n             <a href=\"https://etherscan.io/tx/${transaction._id}\" class=\"external\" target=\"_blank\">${event.event}</a>  <br />\n\n             <p class=\"date\">${dayjs(transaction.timestamp * 1000).fromNow()}</p>\n          </td>\n\n          <td class=\"numeric-cell\"></td>\n          <td class=\"medium-only numeric-cell\">\n            <a href=\"${baseURI}u/?address=${event.namedArgs.owner}\" class=\"${event.namedArgs.owner == transaction.from ? 'is-from' : ''}\">${getDisplayAddress(event.namedArgs.owner)}</a> \n            <span class=\"f7-icons\">arrow_right</span>\n            <a href=\"${baseURI}u/?address=${event.namedArgs.operator}\" class=\"${event.namedArgs?.operator == transaction.from ? 'is-from' : ''}\">${getDisplayAddress(event.namedArgs.operator)}</a>\n          </td>\n\n        </tr>\n    `;\n};\nconst getDisplayAddress = address => {\n  let walletService = globalThis.container.get(\"WalletService\");\n  if (transactionsViewModel?.ens && transactionsViewModel.ens[address]) return transactionsViewModel.ens[address];\n  return walletService.truncateEthAddress(address);\n};\nlet transactionsViewModel;\nlet handlerBody;\nlet handler = async e => {\n  return handlerBody(e);\n};\nfunction framework7Component(props, {\n  $,\n  $on,\n  $f7,\n  $update\n}) {\n  let walletService = globalThis.container.get(\"WalletService\");\n  let baseURI = globalThis.container.get(\"baseURI\")();\n  transactionsViewModel = props.transactions;\n  let rowItemViewModels = props.items;\n  let tokenId = props.token;\n  handlerBody = async e => {\n    transactionsViewModel = e.transactionsViewModel;\n    await $update();\n  };\n\n  // handle event\n  document.removeEventListener('transactions-updated', handler);\n  document.addEventListener('transactions-updated', handler);\n  return function ($ctx) {\n      var $ = $ctx.$;\n      var $h = $ctx.$h;\n      var $root = $ctx.$root;\n      var $f7 = $ctx.$f7;\n      var $f7route = $ctx.$f7route;\n      var $f7router = $ctx.$f7router;\n      var $theme = $ctx.$theme;\n      var $update = $ctx.$update;\n      var $store = $ctx.$store;\n\n      return $h`\r\n  \r\n  <div class=\"card data-table\">\r\n\r\n    <slot></slot>\r\n\r\n    <div class=\"card-content\">\r\n      <table>\r\n        <thead>\r\n          <tr>\r\n            <th class=\"label-cell medium-only\" colspan=\"2\">Item</th>\r\n            <th>Event</th>\r\n            <th class=\"numeric-cell\">Price</th>\r\n            <th class=\"numeric-cell medium-only\">From/To</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          ${transactionsViewModel?.transactions.map( (transaction, index) => $h`\r\n  \r\n            ${transaction.events?.map(processedEvent => $h`\r\n  \r\n              ${processedEvent.event == \"Approval\" && (!tokenId || processedEvent?.tokenId == tokenId) ? $h`\r\n                <${Approval} transaction=${transaction.transaction} event=${processedEvent} base_uri=${baseURI} row_item_view_models=${rowItemViewModels} index=\"${index}\" />\r\n              ` : $h` `}\r\n          \r\n              ${processedEvent.event == \"Transfer\" && (!tokenId || processedEvent?.tokenId == tokenId) ? $h`\r\n                <${Transfer} transaction=${transaction.transaction} event=${processedEvent} base_uri=${baseURI} row_item_view_models=${rowItemViewModels} index=\"${index}\"/>\r\n              ` : $h` `}\r\n          \r\n              ${processedEvent.event == \"ApprovalForAll\" && (!tokenId || processedEvent?.tokenId == tokenId) ? $h`\r\n                <${ApprovalForAll} transaction=${transaction.transaction} event=${processedEvent} base_uri=${baseURI} index=\"${index}\"/>\r\n              ` : $h` `}\r\n          \r\n            `)}\r\n  \r\n  \r\n          `)}\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n\r\n  </div>\r\n\r\n`\n    }\n    ;\n}\nframework7Component.id = 'e869340059';\nframework7Component.style = `\n\n`;\nexport default framework7Component;","/** @jsx $jsx */\nimport { $jsx } from 'framework7';\nfunction framework7Component(props, {\n  $,\n  $on,\n  $f7,\n  $update\n}) {\n  let transactionWebService = globalThis.container.get(\"TransactionWebService\");\n  let walletService = globalThis.container.get(\"WalletService\");\n  let baseURI = globalThis.container.get(\"baseURI\")();\n  let tokenOwners = props.token_owners;\n  return function ($ctx) {\n      var $ = $ctx.$;\n      var $h = $ctx.$h;\n      var $root = $ctx.$root;\n      var $f7 = $ctx.$f7;\n      var $f7route = $ctx.$f7route;\n      var $f7router = $ctx.$f7router;\n      var $theme = $ctx.$theme;\n      var $update = $ctx.$update;\n      var $store = $ctx.$store;\n\n      return $h`\r\n  \r\n  <tbody>\r\n                                    \r\n    ${tokenOwners?.map(u => $h`\r\n        <tr>\r\n            <td class=\"label-cell\">\r\n                ${u.rank}\r\n            </td>\r\n\r\n            <td class=\"address-cell\">\r\n\r\n                ${u.ensName ? $h`\r\n                    <a href=\"${baseURI}u/?address=${u._id}\">${u.ensName}</a>\r\n                ` : $h`\r\n                    <a href=\"${baseURI}u/?address=${u._id}\">${u._id ? walletService.truncateEthAddress(u._id) : ' '}</a>\r\n                `} \r\n\r\n            </td>\r\n\r\n\r\n            <td class=\"numeric-cell\">\r\n                ${u.count}\r\n            </td>\r\n\r\n            <td class=\"numeric-cell\">\r\n                <span class=\"eth-value\">${new Intl.NumberFormat('en-US').format(u.salesReport?.buys?.ethValue ? u.salesReport?.buys?.ethValue : 0)} ETH</span> <br />\r\n                <span class=\"dollar-value\">${transactionWebService.abbreviateDollars(u.salesReport?.buys?.usdValue ? u.salesReport?.buys?.usdValue : 0, 2)}</span>\r\n            </td>\r\n\r\n            <td class=\"numeric-cell\">\r\n                <span class=\"eth-value\">${new Intl.NumberFormat('en-US').format(u.salesReport?.sales?.ethValue ? u.salesReport?.sales?.ethValue : 0)} ETH</span> <br />\r\n                <span class=\"dollar-value\">${transactionWebService.abbreviateDollars(u.salesReport?.sales?.usdValue ? u.salesReport?.sales?.usdValue : 0, 2)}</span>\r\n            </td>\r\n\r\n            <td class=\"text-cell\">\r\n                ${u.lastActive ? dayjs(u.lastActive).fromNow() : \"\"}\r\n            </td>\r\n\r\n\r\n        </tr>\r\n    \r\n    `)}\r\n    </tbody>\r\n\r\n`\n    }\n    ;\n}\nframework7Component.id = 'e767ae333b';\nexport default framework7Component;","/** @jsx $jsx */\nimport { $jsx } from 'framework7';\nfunction framework7Component(props, {\n  $,\n  $on,\n  $f7,\n  $update\n}) {\n  let itemWebService = globalThis.container.get(\"ItemWebService\");\n  let baseURI = globalThis.container.get(\"baseURI\")();\n  const link = href => {\n    return baseURI + href;\n  };\n  let results;\n  let searching = false;\n  const searchbarSubmit = async e => {\n    e.preventDefault();\n    $('.searchbar input').blur();\n    $f7.preloader.showIn('.cards-list');\n    searching = true;\n    $update();\n    results = await itemWebService.query($('.searchbar input').val());\n    searching = false;\n    $update();\n    $f7.preloader.hideIn('.cards-list');\n  };\n  return function ($ctx) {\n      var $ = $ctx.$;\n      var $h = $ctx.$h;\n      var $root = $ctx.$root;\n      var $f7 = $ctx.$f7;\n      var $f7route = $ctx.$f7route;\n      var $f7router = $ctx.$f7router;\n      var $theme = $ctx.$theme;\n      var $update = $ctx.$update;\n      var $store = $ctx.$store;\n\n      return $h`\r\n\r\n  <div class=\"margin-top\">\r\n\r\n\r\n\r\n    <div class=\"block block-strong block-search\">\r\n\r\n      <form class=\"searchbar\" @submit=\"${searchbarSubmit}\">\r\n        <div class=\"searchbar-inner\">\r\n          <div class=\"searchbar-input-wrap\">\r\n            <input type=\"search\" placeholder=\"Enter a search term\" />\r\n            <i class=\"searchbar-icon\"></i>\r\n            <span class=\"input-clear-button\"></span>\r\n          </div>\r\n          <span class=\"searchbar-disable-button\">Cancel</span>\r\n        </div>\r\n      </form>\r\n\r\n      Note: All searches are local. The first search will take longer because it has to build a local search index.\r\n    </div>\r\n\r\n\r\n    <div class=\"list cards-list\">\r\n  \r\n      <ul>\r\n\r\n        ${results ? $h`\r\n          \r\n          ${ results?.length > 0 ? $h`\r\n          \r\n            ${results?.map( (itemViewModel) => $h`\r\n              <li class=\"card item-card\">\r\n                <div class=\"card-content card-content-padding\">\r\n                  ${itemViewModel.item.excerpt ? $h`\r\n                  \r\n                    <div class=\"item-preview\">\r\n    \r\n                      <div class=\"left\">\r\n                        \r\n                          <a class=\"title\" href=\"${link(`token-${itemViewModel.item.tokenId}.html`)}\">\r\n                              ${itemViewModel.item.title}\r\n                              <span class=\"channel-show-token-id\">#${itemViewModel.item.tokenId}</span>\r\n                          </a>\r\n    \r\n                          <p innerHTML=\"${itemViewModel.item.excerpt}\">\r\n                              \r\n                          </p>\r\n    \r\n                      </div>\r\n    \r\n                      ${itemViewModel.coverImage ? $h`\r\n                        <div class=\"right\">\r\n                          <a class=\"title\" href=\"${link(`token-${itemViewModel.item.tokenId}.html`)}\">\r\n                            <img src=\"backup/export/images/${itemViewModel.coverImage._id}.${itemViewModel.coverImage.generated ? 'svg' : 'jpg'}\" alt=\"Item cover image\" />\r\n                          </a>\r\n                        </div>\r\n                      ` : $h`<span />`}\r\n    \r\n                    </div>\r\n    \r\n    \r\n                  ` : $h`\r\n                  \r\n                    <div class=\"item-preview\">\r\n                      <div class=\"left\">\r\n    \r\n                          <a class=\"title\" href=\"${link(`t/${itemViewModel.item.tokenId}`)}\">\r\n                            ${itemViewModel.item.title} <span class=\"channel-show-token-id\">#${itemViewModel.item.tokenId}</span>\r\n                          </a>\r\n    \r\n                          <div class=\"content\" innerHTML=\"${itemViewModel.item.contentHTML}\"></div>\r\n    \r\n                      </div>\r\n                    </div>\r\n                  \r\n                  `}\r\n    \r\n                </div>\r\n              </li>                        \r\n            `)}\r\n    \r\n          ` : $h`\r\n              <li class=\"card item-card\">\r\n                <div class=\"card-content card-content-padding\">\r\n                  No results found\r\n                </div>\r\n              </li>\r\n          `}\r\n          \r\n          \r\n        ` :$h`<span />`}\r\n  \r\n\r\n  \r\n      </ul>\r\n  \r\n    </div>\r\n\r\n  </div>\r\n\r\n`\n    }\n    ;\n}\nframework7Component.id = 'c1a1287315';\nframework7Component.style = `\n\n.block-search {\n  background: #f1f1f1;\n  font-size: 14px;\n}\n\n`;\nexport default framework7Component;","/** @jsx $jsx */\nimport { $jsx } from 'framework7';\nfunction framework7Component(props, {\n  $,\n  $on,\n  $f7,\n  $update\n}) {\n  let baseURL = props.baseurl;\n  let items = props.items;\n  const link = href => {\n    return `${baseURL + href}`;\n  };\n  return function ($ctx) {\n      var $ = $ctx.$;\n      var $h = $ctx.$h;\n      var $root = $ctx.$root;\n      var $f7 = $ctx.$f7;\n      var $f7route = $ctx.$f7route;\n      var $f7router = $ctx.$f7router;\n      var $theme = $ctx.$theme;\n      var $update = $ctx.$update;\n      var $store = $ctx.$store;\n\n      return $h`\n\n    <div class=\"row\" id=\"item-list\">\n                            \n        ${items?.length > 0 ? $h`\n                                    \n            ${items.map(itemViewModel => $h`\n                <div class=\"card col-100 large-25\">\n                    <div class=\"card-content\">\n                        <div class=\"card-content card-content-padding\">\n                            <div class=\"square\">\n                                <a href=\"${link(`token-${itemViewModel.item.tokenId}.html`)}\">\n                                    <img src=\"${link(`backup/export/images/${itemViewModel.coverImage._id}`)}.${itemViewModel.coverImage.generated ? 'svg' : 'jpg'}\" alt=\"Item cover image\" />\n                                </a>\n                            </div>\n\n                            <div class=\"preview-info\">\n                                <a href=\"\">${itemViewModel.item.title ? itemViewModel.item.title + ' ' : ''} #${itemViewModel.item.tokenId}</a>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            `)}\n\n\n        ` : $h`<span />`}             \n                                            \n    </div>  \n  \n`\n    }\n    ;\n}\nframework7Component.id = 'ebc4b0ed6e';\nframework7Component.style = `\n`;\nexport default framework7Component;","import { inject, injectable } from \"inversify\"\r\nimport { WalletService } from \"./wallet-service.js\"\r\nimport { getAddress, Contract } from \"ethers\"\r\n\r\n\r\n@injectable()\r\nclass WalletServiceImpl implements WalletService {\r\n\r\n  public wallet: any\r\n  public address: any\r\n  public ethersContracts:any = {}\r\n\r\n  public provider \r\n  \r\n\r\n  constructor(\r\n    @inject(\"contracts\") private contracts:Function,\r\n    @inject(\"provider\") private getProvider:Function,\r\n    @inject(\"framework7\") private $f7\r\n  ) {\r\n\r\n  }\r\n\r\n  async initProvider() {\r\n\r\n    this.provider = await this.getProvider()\r\n\r\n    globalThis.ethereum?.on('accountsChanged', async (accounts) => {\r\n          \r\n      delete this.address\r\n\r\n      if (accounts?.length > 0) {\r\n        await this.initWallet()\r\n      }\r\n\r\n      this.$f7.views.main.router.refreshPage()\r\n\r\n    })\r\n\r\n    globalThis.ethereum?.on('networkChanged', async (networkId) => {\r\n      this.ethersContracts = {}\r\n      this.provider = await this.getProvider()\r\n\r\n      await this.initWallet()\r\n\r\n    })\r\n\r\n\r\n  }\r\n\r\n  async initWallet() {\r\n\r\n    console.log('Init wallet')\r\n\r\n    delete this.address\r\n\r\n\r\n    if (!this.provider) {\r\n      await this.initProvider()\r\n    }\r\n    \r\n    //@ts-ignore\r\n    let accounts = await this.provider.send(\"eth_accounts\", [])\r\n\r\n    if (accounts?.length > 0) {\r\n      // this.address = accounts[0]\r\n      return this.connect()\r\n    }\r\n    \r\n    console.log(\"Init wallet complete\") \r\n\r\n\r\n  }\r\n\r\n\r\n  async connect() {\r\n    \r\n    console.log(\"Connect wallet\")\r\n\r\n    await this.provider.send(\"eth_requestAccounts\", []);\r\n\r\n    this.wallet = await this.provider.getSigner()\r\n    this.address = await this.getAddress()\r\n    \r\n    console.log(`Wallet ${this.address} connected`) \r\n\r\n  }\r\n\r\n  async getAddress() {\r\n\r\n      if (!this.provider) return\r\n\r\n      let accounts = await this.provider.send(\"eth_accounts\", []);\r\n\r\n      if (accounts?.length > 0) {\r\n        return getAddress(accounts[0]) \r\n      }\r\n\r\n  }\r\n\r\n  async getWallet() {\r\n    return this.provider.getSigner()\r\n  }\r\n\r\n  async getContract(name:string)  {\r\n\r\n    let contracts = await this.contracts()\r\n\r\n    //Initialize and return\r\n    let c = contracts[name]\r\n    this.ethersContracts[name] = new Contract(c.address, c.abi, this.wallet ? this.wallet : this.provider)\r\n\r\n    // console.log(`Getting contract ${name}`)\r\n\r\n    return this.ethersContracts[name]\r\n  }\r\n\r\n\r\n  truncateEthAddress(address) : string {\r\n    if (!address) return\r\n    // Captures 0x + 4 characters, then the last 4 characters.\r\n    const truncateRegex = /^(0x[a-zA-Z0-9]{4})[a-zA-Z0-9]+([a-zA-Z0-9]{4})$/\r\n    const match = address.match(truncateRegex)\r\n    if (!match) return address\r\n    return `${match[1]}…${match[2]}`\r\n  }\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\nexport {\r\n    WalletServiceImpl\r\n}\r\n\r\n","\r\nimport { inject, injectable } from 'inversify';\r\n\r\n\r\n@injectable()\r\nclass DatabaseService {\r\n\r\n    dbCache = {}\r\n\r\n    constructor(\r\n        @inject('baseURI') private baseURI:Function,\r\n        @inject('hostname') private hostname:Function,\r\n        @inject('PouchDB') private PouchDB,\r\n        @inject('channelId') private channelId:Function,\r\n\r\n    ) {}\r\n\r\n    async getDatabase(config:DatabaseConfig) {\r\n\r\n        let PouchDB = await this.PouchDB()\r\n\r\n\r\n        const fullName = `./pouch/${this.channelId()}/${config.name}`\r\n\r\n        if (this.dbCache[fullName]) return this.dbCache[fullName]\r\n\r\n        //Create or open database\r\n        this.dbCache[fullName] = new PouchDB(fullName)\r\n\r\n        const details = await this.dbCache[fullName].info()\r\n\r\n        //If it's empty build the indexes\r\n        if (details.doc_count == 0 && details.update_seq == 0) {\r\n\r\n            //Create indexes\r\n            if (config.changesets) {\r\n\r\n                console.log(`Creating indexes for ${fullName}`)\r\n\r\n                let localChangesets:LocalChangeset = { \r\n                    _id: \"_local/changesets\",\r\n                    ids: [] \r\n                }\r\n\r\n                for (let changeset of config.changesets) {\r\n                    await changeset.changeset(this.dbCache[fullName])\r\n                    localChangesets.ids.push(changeset.id)\r\n                    console.log(`New changeset detected...${changeset.id}`)\r\n                }\r\n\r\n                //Mark changesets as run\r\n                await this.dbCache[fullName].put(localChangesets)\r\n\r\n                \r\n            }\r\n\r\n            //Load initial records\r\n            if (config.initialRecords) {\r\n                await this.loadInitialRecords(config, fullName)\r\n\r\n            }\r\n\r\n        } else {\r\n\r\n            //Otherwise check if each changeset has been applied and if not then apply it.\r\n            if (config.changesets) {\r\n\r\n                let localChangesets:LocalChangeset \r\n\r\n                try {\r\n                    localChangesets = await this.dbCache[fullName].get(\"_local/changesets\")\r\n                } catch(ex) {}\r\n\r\n                if (!localChangesets) {\r\n                    localChangesets = { \r\n                        _id: \"_local/changesets\",\r\n                        ids: [] \r\n                    }\r\n                }\r\n\r\n\r\n                let updated = false\r\n\r\n                for (let changeset of config.changesets) {\r\n                    \r\n                    //If it hasn't been run then run it.\r\n                    if (!localChangesets.ids.includes(changeset.id)) {\r\n\r\n                        try {\r\n                            //Execute the changes. This could fail if the changes have actually been applied but it wasn't marked. \r\n                            //But in that scenario we just accept the failure and mark it applied. \r\n                            await changeset.changeset(this.dbCache[fullName])\r\n                        } catch(ex) { }\r\n                        \r\n                        \r\n                        localChangesets.ids.push(changeset.id)\r\n                        \r\n                        updated = true\r\n                        \r\n                        console.log(`New changeset detected...${changeset.id}`)\r\n                    }\r\n\r\n                }\r\n\r\n\r\n                if (updated) {\r\n                    console.log(`Saving changeset log...`, localChangesets)\r\n                    await this.dbCache[fullName].put(localChangesets)\r\n                }\r\n\r\n                \r\n\r\n\r\n            }\r\n\r\n\r\n\r\n        }\r\n\r\n\r\n        return this.dbCache[fullName]\r\n\r\n    }\r\n\r\n    private async loadInitialRecords(config: DatabaseConfig, fullName: string) {\r\n\r\n        let response\r\n\r\n        if (config.initialRecordsPath) {\r\n            response = await fetch(`${this.hostname()}${this.baseURI()}${config.initialRecordsPath}`)\r\n        } else {\r\n            response = await fetch(`${this.hostname()}${this.baseURI()}backup/export/backup/${config.name}.json`)\r\n        }\r\n\r\n        let initialRecords = await response.json()\r\n\r\n\r\n        if (initialRecords?.length > 0) {\r\n            console.log(`Loading ${initialRecords?.length} initial records for ${fullName}`);\r\n            await this.dbCache[fullName].bulkDocs(initialRecords);\r\n        }\r\n\r\n    }\r\n}\r\n\r\ninterface DatabaseConfig {\r\n    name:string\r\n    changesets?:Changeset[]\r\n    initialRecords?:boolean\r\n    initialRecordsPath?:string\r\n}\r\n\r\ninterface Changeset {\r\n    id:string\r\n    changeset(db): Promise<void>\r\n}\r\n\r\ninterface LocalChangeset {\r\n    _id:string\r\n    ids:string[]\r\n}\r\n\r\nexport {\r\n    DatabaseService, Changeset\r\n}\r\n","import axios from \"axios\"\r\nimport {  inject, injectable } from \"inversify\"\r\nimport { Channel } from \"../../dto/channel.js\"\r\nimport { Changeset, DatabaseService } from \"../../service/core/database-service.js\"\r\nimport { ChannelRepository } from \"../channel-repository.js\"\r\n\r\n@injectable()\r\nclass ChannelRepositoryBrowserImpl implements ChannelRepository {\r\n    \r\n    changesets:Changeset[] = [{\r\n        id: '0',\r\n        changeset: async (db) => {\r\n            //Create indexes\r\n            await db.createIndex({ index: { fields: ['dateCreated'] } })\r\n            await db.createIndex({ index: { fields: ['lastUpdated'] } })\r\n            \r\n        }\r\n    }]\r\n\r\n\r\n    db:any\r\n    dbName:string = \"channels\"\r\n\r\n    @inject('DatabaseService')\r\n    private databaseService: DatabaseService\r\n\r\n    constructor(\r\n        @inject(\"baseURI\") private baseURI:Function,\r\n        @inject(\"hostname\") private hostname:Function\r\n    ) {}\r\n\r\n    async load() {\r\n        this.db = await this.databaseService.getDatabase({\r\n            name: this.dbName,\r\n            changesets: this.changesets,\r\n            initialRecords: true\r\n        })\r\n    }\r\n\r\n\r\n    async get(): Promise<Channel> {        \r\n        \r\n        let channels = await this.db.allDocs({\r\n            include_docs: true\r\n        })\r\n\r\n        let channel:Channel \r\n\r\n        //Find the first actual channel (skip design)\r\n        for (let c of channels.rows) {\r\n            if (c.doc.dateCreated) channel = c.doc\r\n        }\r\n\r\n        // console.log(channels)\r\n\r\n        // let channel:Channel = channels.rows[0].doc\r\n        // console.log(channel)\r\n\r\n        const contractResponse = await axios.get(`${this.hostname()}${this.baseURI()}backup/contract/contract.json`)\r\n        // console.log(contractResponse)\r\n\r\n        if (contractResponse?.data) {\r\n            channel.contractAddress = contractResponse.data.contractAddress\r\n        }\r\n\r\n        return channel\r\n    }\r\n\r\n}\r\n\r\nexport {\r\n    ChannelRepositoryBrowserImpl\r\n}","import { AttributeOptions, AttributeSelection } from \"./attribute.js\"\n\n\nclass Item {    \n    _id?:string\n    _rev?:string\n    channelId?:string\n    tokenId?:number\n    title?:string \n    link?:string \n    description?:string\n    content?:any\n    contentHTML?:string\n    excerpt?:string\n    authorId?:string\n    category?:string[]\n    attributeSelections?: AttributeSelection[] \n    coverImageId?:string\n    coverImageAsAnimation?:string \n    originalJSONMetadataId?:any\n    animationId?:string\n    datePublished?:string\n    dateCreated?:string\n    lastUpdated?:string\n}\n\n\nexport { Item }","import { inject, injectable } from \"inversify\"\r\nimport { Item } from \"../../dto/item.js\"\r\nimport { ItemRepository, CHUNK_SIZE } from \"./../item-repository.js\"\r\nimport { Changeset, DatabaseService } from \"../../service/core/database-service.js\"\r\nimport axios from \"axios\"\r\nimport { ItemPage, RowItemViewModel } from \"../../dto/item-page.js\"\r\n\r\n\r\n\r\n\r\n@injectable()\r\nclass ItemRepositoryBrowserImpl implements ItemRepository {\r\n\r\n    static CHUNK_SIZE = CHUNK_SIZE\r\n\r\n    changesets:Changeset[] = [\r\n        {\r\n            id: '0',\r\n            changeset: async (db) => {\r\n\r\n                await db.createIndex({\r\n                    index: {\r\n                        fields: ['tokenId']\r\n                    }\r\n                })\r\n        \r\n        \r\n                // await db.search({\r\n                //     build: true,\r\n                //     fields: ['contentHTML', 'title', 'tokenId']\r\n                // })\r\n        \r\n                \r\n            }\r\n        }\r\n    ]\r\n\r\n    db:any\r\n    dbName:string = \"items\"\r\n    \r\n    @inject('DatabaseService')\r\n    private databaseService: DatabaseService\r\n    \r\n    constructor(\r\n        @inject(\"baseURI\") private baseURI:Function,\r\n        @inject(\"hostname\") private hostname:Function\r\n    ) {}\r\n\r\n    async load() {\r\n        this.db = await this.databaseService.getDatabase({\r\n            name: this.dbName,\r\n            changesets: this.changesets,\r\n            initialRecords: true\r\n        })\r\n    }\r\n\r\n\r\n    async get(_id: string): Promise<Item> {\r\n        return Object.assign(new Item(), await this.db.get(_id))\r\n    }\r\n    \r\n\r\n\r\n    async put(item: Item) {\r\n        await this.db.put(item)\r\n    }\r\n\r\n    async list(skip: number, limit:number=CHUNK_SIZE): Promise<Item[]> {\r\n\r\n        let response = await this.db.find({\r\n            selector: {\r\n                tokenId: { $exists: true }\r\n            },\r\n            sort: [{ 'tokenId': 'asc' }],\r\n            limit: limit,\r\n            skip: skip\r\n        })\r\n\r\n        return response.docs\r\n\r\n    }\r\n\r\n    async getByTokenId(tokenId:number) : Promise<Item> {\r\n\r\n        let response = await this.db.find({\r\n            selector: {\r\n                tokenId: { $eq: tokenId },\r\n            },\r\n            limit: 1\r\n        })\r\n\r\n        if (response.docs?.length > 0) {\r\n            return response.docs[0]\r\n        }\r\n\r\n        \r\n    }\r\n\r\n    async getByTokenIds(ids:number[]) : Promise<Item[]> {\r\n\r\n        let response = await this.db.find({\r\n            selector: {\r\n                tokenId: { $in: ids },\r\n            }\r\n        })\r\n\r\n        if (response.docs?.length > 0) {\r\n            return response.docs\r\n        } else {\r\n            return []\r\n        }\r\n    }\r\n\r\n\r\n    async getRowItemViewModelsByAttribute(traitType:string, value:string, pageNumber:number) : Promise<ItemPage> {\r\n\r\n        const escape = (s) => {\r\n            return s.replace(/[^a-z0-9]/gi, '_').toLowerCase()\r\n        }\r\n\r\n        let itemPage:ItemPage\r\n\r\n        const response = await axios.get(`${this.hostname()}${this.baseURI()}attributes/items/${escape(traitType)}/${escape(value)}/${pageNumber}.json`)\r\n        \r\n        itemPage = response.data\r\n\r\n        return itemPage\r\n    }\r\n\r\n    async getRowItemViewModelsByOwner(address:string, pageNumber:number) : Promise<ItemPage> {\r\n\r\n        let itemPage:ItemPage\r\n\r\n        const response = await axios.get(`${this.hostname()}${this.baseURI()}sync/tokenOwner/${address}/tokens/${pageNumber}.json`)\r\n        \r\n        itemPage = response.data\r\n\r\n        return itemPage\r\n    }\r\n\r\n    async getRowItemViewModelsByTokenIds(tokenIds:number[]) : Promise<RowItemViewModel[]> {\r\n\r\n        let items:RowItemViewModel[] = []\r\n\r\n        for (let tokenId of tokenIds) {\r\n            const response = await axios.get(`${this.hostname()}${this.baseURI()}t/${tokenId}/rowItemViewModel.json`)\r\n            items.push(response.data)\r\n        }\r\n\r\n        return items\r\n    }\r\n\r\n    async getRowItemViewModelsByTokenId(tokenId:number) : Promise<RowItemViewModel> {\r\n\r\n        const response = await axios.get(`${this.hostname()}${this.baseURI()}t/${tokenId}/rowItemViewModel.json`)\r\n        return response.data\r\n\r\n    }\r\n\r\n\r\n    \r\n    async listByTokenId(startTokenId:number, limit:number) : Promise<Item[]> {\r\n\r\n        let response = await this.db.find({\r\n            selector: {\r\n                tokenId: { $eq: startTokenId },\r\n            },\r\n            sort: [{ 'tokenId': 'desc' }],\r\n            limit: limit\r\n        })\r\n\r\n        return response.docs\r\n\r\n    }\r\n\r\n    async query(query:string) : Promise<Item[]> {\r\n\r\n        let response = await this.db.search({\r\n            query: query,\r\n            fields: ['contentHTML', 'title', 'tokenId'],\r\n            include_docs: true,\r\n            highlighting: true, \r\n            limit: CHUNK_SIZE\r\n        })\r\n\r\n\r\n        let rows = response.rows.map( row => {\r\n\r\n            if (row.highlighting.contentHTML) {\r\n                row.doc.contentHTML = row.highlighting.contentHTML\r\n            } \r\n\r\n            //Remove image tags\r\n            row.doc.contentHTML = row.doc.contentHTML.replace(/<img .*?>/g,\"\"); \r\n\r\n\r\n            return row.doc\r\n        })\r\n\r\n\r\n        return rows\r\n\r\n    }\r\n\r\n\r\n\r\n    async all(): Promise<Item[]> {\r\n        let response = await this.db.find({\r\n            selector: {\r\n                tokenId: { $exists: true }\r\n            },\r\n            sort: [{ 'tokenId': 'asc' }],\r\n            limit: 100000,\r\n            skip: 0\r\n        })\r\n\r\n        return response.docs\r\n    }\r\n\r\n\r\n    \r\n}\r\n\r\nexport {\r\n    ItemRepositoryBrowserImpl\r\n}\r\n\r\n\r\n","import { Item } from \"../dto/item.js\"\nimport { ItemPage, RowItemViewModel } from \"../dto/item-page.js\"\n\nlet CHUNK_SIZE = 10\n\ninterface ItemRepository {\n    get(_id:string): Promise<Item>\n    list(skip:number, limit?:number): Promise<Item[]>\n    getByTokenId(tokenId:number) : Promise<Item>\n    getByTokenIds(tokenIds:number[]) : Promise<Item[]>\n    getRowItemViewModelsByAttribute(traitType:string, value:string, pageNumber:number) : Promise<ItemPage>\n    getRowItemViewModelsByTokenIds(tokenIds:number[]) : Promise<RowItemViewModel[]>\n    getRowItemViewModelsByTokenId(tokenId:number) : Promise<RowItemViewModel>\n    query(query:string) : Promise<Item[]>\n    all() : Promise<Item[]>\n    listByTokenId(startTokenId:number, limit:number) : Promise<Item[]> \n    getRowItemViewModelsByOwner(address:string, pageNumber:number) : Promise<ItemPage> \n\n}\n\nexport {\n    ItemRepository, CHUNK_SIZE\n}\n","\nclass Author {\n\n  _id?: string\n  _rev?:string\n  walletAddress?: string\n  name?: string\n  description?: string\n  url?:string \n  coverPhotoId?: string\n  dateCreated?:string\n  lastUpdated?:string\n\n}\n\nexport {\n  Author\n}","import {  inject, injectable } from \"inversify\"\r\nimport { Author } from \"../../dto/author.js\"\r\nimport { DatabaseService } from \"../../service/core/database-service.js\"\r\nimport { AuthorRepository } from \"../author-repository.js\"\r\n\r\n@injectable()\r\nclass AuthorRepositoryBrowserImpl implements AuthorRepository {\r\n\r\n    db:any\r\n    dbName:string = \"authors\"\r\n\r\n    @inject('DatabaseService')\r\n    private databaseService: DatabaseService\r\n\r\n    async load() {\r\n        this.db = await this.databaseService.getDatabase({\r\n            name: this.dbName,\r\n            initialRecords: true\r\n        })\r\n    }\r\n\r\n    constructor(\r\n    ) {}\r\n\r\n\r\n    async get(_id:string): Promise<Author> {        \r\n        return Object.assign(new Author(), await this.db.get(_id))\r\n    }\r\n\r\n}\r\n\r\nexport {\r\n    AuthorRepositoryBrowserImpl\r\n}","import { AttributeSelection } from \"./attribute.js\";\n\nclass NFTMetadata {\n\n    tokenId:string\n\n    name?:string\n    description?:string\n\n    image?:string\n    image_data?:string\n\n    external_url?:string \n    \n    attributes?:AttributeSelection[]\n\n    background_color?:string \n    animation_url?:string\n} \n\nexport {\n    NFTMetadata\n}","import axios from \"axios\"\nimport { inject, injectable } from \"inversify\"\nimport { NFTMetadata } from \"../../dto/nft-metadata.js\"\nimport { MetadataRepository } from \"../metadata-repository.js\"\n\n@injectable()\nclass MetadataRepositoryBrowserImpl implements MetadataRepository {\n\n    static CHUNK_SIZE = 10\n\n    constructor(\n        @inject('baseURI') private baseURI:Function,\n        @inject('hostname') private hostname:Function\n    ) {}\n\n    async get(tokenId: string): Promise<NFTMetadata> {\n        const response = await axios.get(`${this.hostname()}${this.baseURI()}backup/metadata/${tokenId}.json`)\n        return Object.assign(new NFTMetadata(), response.data)\n    }\n\n}\n\nexport {\n    MetadataRepositoryBrowserImpl\n}\n\n\n","class Image {\n    _id?:string\n    data?:any\n    cid?:string\n    buffer?:any\n    svg?:string \n    generated?:boolean\n}\n\nexport {\n    Image\n}","import {  inject, injectable } from \"inversify\"\r\nimport { Image } from \"../../dto/image.js\"\r\nimport { DatabaseService } from \"../../service/core/database-service.js\"\r\nimport { ImageRepository } from \"../image-repository.js\"\r\n\r\n@injectable()\r\nclass ImageRepositoryBrowserImpl implements ImageRepository {\r\n\r\n    db:any\r\n    dbName:string = \"images\"\r\n\r\n    @inject('DatabaseService')\r\n    private databaseService: DatabaseService\r\n\r\n    async load() {\r\n        this.db = await this.databaseService.getDatabase({\r\n            name: this.dbName,\r\n            initialRecords: true\r\n        })\r\n    }\r\n\r\n    constructor(\r\n    ) {}\r\n\r\n\r\n    async get(_id:string): Promise<Image> {        \r\n        return Object.assign(new Image(), await this.db.get(_id))\r\n    }\r\n\r\n    async list() : Promise<Image[]> {\r\n        return //unimplemented\r\n    }\r\n\r\n\r\n\r\n}\r\n\r\nexport {\r\n    ImageRepositoryBrowserImpl\r\n}","\nclass Animation {\n    \n    _id?:string\n    _rev?:string \n    content?:string\n    cid?:string \n    dateCreated?:string\n}\n\nexport {\n    Animation\n}","import {  inject, injectable } from \"inversify\"\r\nimport { Animation } from \"../../dto/animation.js\"\r\nimport { DatabaseService } from \"../../service/core/database-service.js\"\r\nimport { AnimationRepository } from \"../animation-repository.js\"\r\n\r\n@injectable()\r\nclass AnimationRepositoryBrowserImpl implements AnimationRepository {\r\n\r\n    db:any\r\n    dbName:string = \"animations\"\r\n\r\n    @inject('DatabaseService')\r\n    private databaseService: DatabaseService\r\n\r\n    async load() {\r\n        this.db = await this.databaseService.getDatabase({\r\n            name: this.dbName,\r\n            initialRecords: true\r\n        })\r\n    }\r\n\r\n    constructor(\r\n    ) {}\r\n\r\n\r\n    async get(_id:string): Promise<Animation> {        \r\n        return Object.assign(new Animation(), await this.db.get(_id))\r\n    }\r\n\r\n\r\n\r\n}\r\n\r\nexport {\r\n    AnimationRepositoryBrowserImpl\r\n}","\nclass StaticPage {\n  _id?: string\n  _rev?:string\n  channelId?:string\n  name?: string\n  slug?:string\n  content?:any\n  contentHTML?:string\n  contentMarkdown?:string\n  locations?:string[] \n  dateCreated?:string\n  lastUpdated?:string\n}\n\n\nexport {\n  StaticPage\n}","import { inject, injectable } from \"inversify\"\r\nimport { Changeset, DatabaseService } from \"../../service/core/database-service.js\"\r\n\r\nimport { StaticPageRepository } from \"../static-page-repository.js\"\r\nimport { StaticPage } from \"../../dto/static-page.js\"\r\n\r\n\r\n@injectable()\r\nclass StaticPageRepositoryBrowserImpl implements StaticPageRepository {\r\n\r\n    changesets:Changeset[] = [{\r\n        id: '0',\r\n        changeset: async (db) => {\r\n            //Create indexes\r\n            await db.createIndex({\r\n                index: {\r\n                    fields: ['channelId']\r\n                }\r\n            })\r\n            await db.createIndex({\r\n                index: {\r\n                    fields: ['dateCreated']\r\n                }\r\n            })\r\n            \r\n        }\r\n    }]\r\n\r\n\r\n\r\n    db:any\r\n    dbName:string = \"static-pages\"\r\n    \r\n    @inject('DatabaseService')\r\n    private databaseService: DatabaseService\r\n    \r\n    constructor() {}\r\n\r\n    async load() {\r\n        this.db = await this.databaseService.getDatabase({\r\n            name: this.dbName,\r\n            changesets: this.changesets,\r\n            initialRecords: true\r\n        })\r\n    }\r\n\r\n\r\n    async get(_id: string): Promise<StaticPage> {\r\n        return Object.assign(new StaticPage(), await this.db.get(_id))\r\n    }\r\n\r\n    async listByLocation(location:string, skip:number): Promise<StaticPage[]> {\r\n\r\n        let response = await this.db.find({\r\n            selector: {\r\n                locations: { $all: [location] },\r\n                dateCreated: { $exists: true }\r\n            },\r\n            sort: [{ 'dateCreated': 'asc' }],\r\n            skip: skip\r\n        })\r\n\r\n        return response.docs\r\n    }\r\n\r\n}\r\n\r\nexport {\r\n    StaticPageRepositoryBrowserImpl\r\n}\r\n\r\n\r\n","import axios from \"axios\"\nimport { inject, injectable } from \"inversify\"\nimport { ItemPage } from \"../../dto/item-page.js\"\nimport { ItemPageRepository } from \"../item-page-repository.js\"\n\n@injectable()\nclass ItemPageRepositoryBrowserImpl implements ItemPageRepository {\n\n    constructor(\n        @inject(\"baseURI\") private baseURI:Function,\n        @inject(\"hostname\") private hostname:Function\n    ) {}\n\n    async get(pageNumber: number): Promise<ItemPage> {   \n\n        const response = await axios.get(`${this.hostname()}${this.baseURI()}itemPages/${pageNumber}.json`)\n            \n        return response.data\n    }\n\n}\n\nexport {\n    ItemPageRepositoryBrowserImpl\n}\n\n\n","class AttributeTotal {\n    _id?:string\n    traitType?:string\n    value?:string \n    count?:number \n    categoryPercent?:string\n    tokenIds?:number[]\n}\n\nexport { AttributeTotal }","import { inject, injectable } from \"inversify\"\nimport { AttributeTotal } from \"../../dto/attribute-total.js\"\nimport { DatabaseService } from \"../../service/core/database-service.js\"\nimport { AttributeTotalRepository } from \"../attribute-total-repository.js\"\n\n@injectable()\nclass AttributeTotalRepositoryBrowserImpl implements AttributeTotalRepository {\n\n    db:any\n    dbName:string = \"attribute-totals\"\n\n    @inject('DatabaseService')\n    private databaseService: DatabaseService\n\n    async load() {\n        this.db = await this.databaseService.getDatabase({\n            name: this.dbName,\n            initialRecords: true,\n            initialRecordsPath: 'attributeTotals.json'\n        })\n    }\n\n    constructor(\n    ) {}\n\n\n    async get(_id:string): Promise<AttributeTotal> {        \n        return Object.assign(new AttributeTotal(), await this.db.get(_id))\n    }\n\n    async getByIds(ids:string[]) : Promise<AttributeTotal[]> {\n\n        let results = await this.db.allDocs({\n            keys: ids,\n            include_docs: true\n        })\n\n        return results.rows?.map( d => d.doc)\n\n    }\n\n\n    async put(attributeTotal:AttributeTotal) : Promise<void> {\n        await this.db.put(attributeTotal)\n    }\n\n    async list(limit?:number, skip?:number) : Promise<AttributeTotal[]> {\n        \n        let response = await this.db.find({\n            selector: {\n                count: { $exists: true }\n            },\n            limit: limit,\n            skip: skip\n        })\n\n        return response.docs\n\n    }\n\n}\n\nexport {\n    AttributeTotalRepositoryBrowserImpl\n}\n\n\n","import { MinLength, ArrayNotEmpty, ArrayMinSize ,IsNotEmpty, Allow } from 'class-validator'\r\n\r\n\r\nclass ReaderSettings {\r\n\r\n    @Allow()\r\n    _id?:string\r\n    \r\n    @Allow()\r\n    _rev?:string\r\n\r\n    @Allow()\r\n    currentPage?:number\r\n    \r\n    @Allow()\r\n    lastPageJump?:number\r\n    \r\n    @Allow()\r\n    dateCreated?:string\r\n    \r\n    @Allow()\r\n    lastUpdated?:string\r\n  \r\n  }\r\n  \r\n  export {\r\n    ReaderSettings\r\n  }","import {  inject, injectable } from \"inversify\"\r\nimport { ReaderSettings } from \"../../dto/reader-settings.js\"\r\nimport { DatabaseService } from \"../../service/core/database-service.js\"\r\nimport { ReaderSettingsRepository } from \"../reader-settings-repository.js\"\r\n\r\n@injectable()\r\nclass ReaderSettingsRepositoryBrowserImpl implements ReaderSettingsRepository {\r\n\r\n    db:any\r\n    dbName:string = \"reader-settings\"\r\n\r\n    @inject('DatabaseService')\r\n    private databaseService: DatabaseService\r\n\r\n    async load() {\r\n        this.db = await this.databaseService.getDatabase({\r\n            name: this.dbName,\r\n            initialRecords: false\r\n        })\r\n    }\r\n\r\n    constructor(\r\n    ) {}\r\n\r\n    async put(readerSettings:ReaderSettings): Promise<void> {     \r\n        \r\n        //Just gonna have one record\r\n        readerSettings._id = \"reader-settings\"\r\n        \r\n        await this.db.put(readerSettings)\r\n    }\r\n\r\n\r\n    async get(): Promise<ReaderSettings> {     \r\n        \r\n        let result\r\n\r\n        try {\r\n            result = await this.db.get(\"reader-settings\")\r\n        } catch(ex) {}\r\n\r\n        if (!result) {\r\n            result = new ReaderSettings()\r\n            result._id = \"reader-settings\"\r\n        }\r\n\r\n\r\n        return Object.assign(new ReaderSettings(), result )\r\n    }\r\n\r\n\r\n\r\n}\r\n\r\nexport {\r\n    ReaderSettingsRepositoryBrowserImpl\r\n}","\r\nclass Token {\r\n    \r\n    declare _id?:string\r\n\r\n    declare _rev?:string \r\n\r\n    declare tokenId?:number\r\n\r\n    declare attributeSelections?:[{\r\n        traitType: string\r\n        value: string\r\n    }]\r\n\r\n    declare currentOwnerId?:string \r\n\r\n    declare ownershipHistory?:OwnershipHistory[]\r\n\r\n    declare latestTransactionId?:string\r\n\r\n    declare lastUpdated?:Date \r\n\r\n    declare dateCreated?:Date\r\n\r\n}\r\n\r\ninterface OwnershipHistory {\r\n    owner:string,\r\n    blockNumber:number\r\n    transactionIndex:number\r\n    transactionHash:string\r\n    timestamp:number\r\n}\r\n\r\nexport {\r\n    Token\r\n}","import axios from \"axios\"\r\nimport {  inject, injectable } from \"inversify\"\r\nimport { Token } from \"../../dto/token.js\"\r\n\r\nimport { TokenRepository } from \"../token-repository.js\"\r\n\r\n\r\n@injectable()\r\nclass TokenRepositoryBrowserImpl implements TokenRepository {\r\n  \r\n\r\n    @inject('baseURI') \r\n    private baseURI:Function\r\n\r\n\r\n    constructor() {}\r\n\r\n\r\n\r\n    async get(_id:string): Promise<Token> {    \r\n        \r\n        try {\r\n            //Download it.\r\n            let result = await axios.get(`${this.baseURI()}sync/tokens/${_id}/token.json`)\r\n            return Object.assign(new Token(), result.data)\r\n        } catch(ex) {\r\n            // console.log(ex)\r\n        }\r\n\r\n    }\r\n\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\nexport {\r\n    TokenRepositoryBrowserImpl\r\n}","import { Author } from \"../dto/author.js\";\nimport { inject, injectable } from \"inversify\";\nimport { AuthorRepository } from \"../repository/author-repository.js\";\nimport { WalletService } from \"./core/wallet-service.js\";\n\n\n@injectable()\nclass AuthorService {\n\n  @inject(\"AuthorRepository\")\n  private authorRepository:AuthorRepository\n\n  @inject(\"WalletService\")\n  private walletService:WalletService\n\n  constructor() { }\n\n  async get(_id: string): Promise<Author> {\n    return this.authorRepository.get(_id)\n  }\n\n  getDisplayName(author: Author): string {\n    if (!author) return\n    if (author.name) return author.name\n    return this.walletService.truncateEthAddress(author._id)\n  }\n\n\n}\n\n\nexport { AuthorService }\n\n","import { inject, injectable } from \"inversify\"\r\n\r\nimport { Channel } from \"../dto/channel.js\"\r\nimport { ChannelRepository } from \"../repository/channel-repository.js\"\r\n\r\n@injectable()\r\nclass ChannelService {\r\n\r\n  @inject(\"ChannelRepository\")\r\n  private channelRepository:ChannelRepository\r\n\r\n  constructor() { }\r\n\r\n  async get(): Promise<Channel> {\r\n    return this.channelRepository.get()\r\n  }\r\n\r\n\r\n\r\n}\r\n\r\n\r\nexport {\r\n  ChannelService\r\n}\r\n","import { injectable } from \"inversify\";\n\n@injectable()\nclass PagingService {\n    \n    constructor() {}\n\n    /**\n     * This function takes in a limit, offset, and count and generates a model \n     * \n     * @param offset \n     * @param limit \n     * @param count \n     */\n    buildPagingViewModel(offset: number, limit: number, count: number, numberOfPages:number) : PagingViewModel {\n\n        let viewModel = new PagingViewModel()\n\n        viewModel.offset = offset ? offset : 0\n        viewModel.limit = limit\n        viewModel.count = count \n\n        viewModel.start = viewModel.offset + 1\n\n\n        viewModel.end = Math.min(viewModel.offset + limit, count) \n\n        \n        viewModel.previousOffset = Math.max(viewModel.offset-limit, 0);\n\n        if ( (viewModel.offset + limit) < count ) {\n            viewModel.nextOffset = viewModel.offset + limit\n        }\n\n        \n        //Set current page\n        viewModel.page = viewModel.offset/viewModel.limit + 1\n        if (viewModel.page > viewModel.endPage) viewModel.page = viewModel.endPage\n\n        viewModel.endPage = Math.ceil(viewModel.count / viewModel.limit)\n\n\n        viewModel.lastOffset = viewModel.endPage * viewModel.limit - viewModel.limit\n        \n\n        viewModel.showNext = viewModel.endPage > viewModel.page\n        viewModel.showPrevious = viewModel.offset != 0\n\n        viewModel.showFirst = viewModel.page > 2\n        viewModel.showLast = viewModel.page < (viewModel.endPage - 1)\n\n\n        //Number of pages shouldn't be past the end\n        // numberOfPages = Math.min(numberOfPages, viewModel.endPage - viewModel.page)\n\n        // viewModel.pageNumbers = []\n        // for (let i=viewModel.page; i < numberOfPages + viewModel.page; i++) {\n        //     viewModel.pageNumbers.push({\n        //         display: i + 1,\n        //         offset: i * viewModel.limit\n        //     })\n        // }\n\n        return viewModel\n    }\n\n\n\n    calculateEndIndex(limit, offset, currentCount) {\n        let endIndex = offset + limit - 1\n\n        //If it's the last page don't go past the final record\n        return Math.min( currentCount - 1,  endIndex )\n    }\n\n\n    calculateDescendingEndIndex(limit, offset) {\n        let endIndex = offset - (limit - 1)\n\n        //Don't go lower than 0\n        return Math.max( 0,  endIndex )\n    }\n\n    calculateDescendingOffset(offset, currentCount) {\n\n        let calculatedOffset = (currentCount - 1) - offset\n        // console.log(`offset: ${offset}, currentCount: ${currentCount}, calculatedOffset: ${calculatedOffset}`)\n        return Math.max( 0,  calculatedOffset )\n    }\n\n\n}\n\nclass PagingViewModel {\n\n    page:number\n    pageNumbers:PageNumber[]\n    endPage:number\n\n    offset: number\n    limit: number\n    count: number\n\n    start: number\n    end: number \n\n    previousOffset: number \n    nextOffset: number \n    lastOffset:number\n\n    showPrevious:boolean\n    showNext:boolean\n    showFirst:boolean\n    showLast:boolean\n\n}\n\ninterface PageNumber {\n    display:number\n    offset:number\n}\n\nexport {\n    PagingService,\n    PagingViewModel\n}\n","import { inject, injectable } from \"inversify\"\r\n\r\nimport { AnimationRepository } from \"../../repository/animation-repository.js\"\r\nimport { AttributeTotalRepository } from \"../../repository/attribute-total-repository.js\"\r\nimport { AuthorRepository } from \"../../repository/author-repository.js\"\r\nimport { ChannelRepository } from \"../../repository/channel-repository.js\"\r\nimport { ComponentStateRepository } from \"../../repository/component-state-repository.js\"\r\n\r\nimport { ImageRepository } from \"../../repository/image-repository.js\"\r\nimport { ItemRepository } from \"../../repository/item-repository.js\"\r\nimport { ReaderSettingsRepository } from \"../../repository/reader-settings-repository.js\"\r\nimport { RowItemViewModelRepository } from \"../../repository/row-item-view-model-repository.js\"\r\nimport { StaticPageRepository } from \"../../repository/static-page-repository.js\"\r\n\r\n\r\n@injectable()\r\nclass SchemaService {\r\n\r\n    @inject(\"ItemRepository\")\r\n    private itemRepository:ItemRepository \r\n\r\n    @inject(\"ChannelRepository\")\r\n    private channelRepository:ChannelRepository\r\n\r\n    @inject(\"AuthorRepository\")\r\n    private authorRepository:AuthorRepository\r\n\r\n    @inject(\"ImageRepository\")\r\n    private imageRepository:ImageRepository\r\n    \r\n    @inject(\"AnimationRepository\")\r\n    private animationRepository:AnimationRepository\r\n\r\n    @inject(\"StaticPageRepository\")\r\n    private staticPageRepository:StaticPageRepository\r\n\r\n    @inject(\"ReaderSettingsRepository\")\r\n    private readerSettingsRepository:ReaderSettingsRepository\r\n\r\n    @inject(\"RowItemViewModelRepository\")\r\n    private rowItemViewModelRepository:RowItemViewModelRepository\r\n\r\n    @inject(\"AttributeTotalRepository\")\r\n    private attributeTotalRepository:AttributeTotalRepository\r\n\r\n    @inject(\"ComponentStateRepository\")\r\n    private componentStateRepository:ComponentStateRepository\r\n\r\n\r\n    constructor() {\r\n\r\n    }\r\n\r\n    async load(dbs:string[]) {\r\n\r\n        const repositories = this.getRepositories()\r\n\r\n        for (let db of dbs) {\r\n            let repo = repositories.filter( r => r.dbName == db)[0]\r\n            await repo?.load()\r\n        }\r\n\r\n    }\r\n\r\n\r\n    async reloadAll() {\r\n\r\n        const repositories = this.getRepositories()\r\n\r\n        for (let repo of repositories) {\r\n            await repo.load()\r\n        }\r\n\r\n    }\r\n\r\n    getRepositories() {\r\n\r\n        const repositories = []\r\n\r\n        repositories.push(this.itemRepository)\r\n        repositories.push(this.channelRepository)\r\n        repositories.push(this.authorRepository)\r\n        repositories.push(this.imageRepository)\r\n        repositories.push(this.animationRepository)\r\n        repositories.push(this.staticPageRepository)\r\n        repositories.push(this.readerSettingsRepository)\r\n\r\n        repositories.push(this.staticPageRepository)\r\n        repositories.push(this.readerSettingsRepository)\r\n\r\n        repositories.push(this.attributeTotalRepository)\r\n        repositories.push(this.componentStateRepository)\r\n        repositories.push(this.rowItemViewModelRepository)\r\n\r\n        return repositories\r\n\r\n    }\r\n\r\n\r\n    async loadWallet(walletAddress:string) {\r\n        console.log(`Loading wallet: ${walletAddress}`)\r\n    }\r\n\r\n\r\n\r\n}\r\n\r\nexport {\r\n    SchemaService\r\n}","import { inject, injectable } from \"inversify\";\nimport svgToMiniDataURI from 'mini-svg-data-uri'\n\n\nimport { ImageRepository } from \"../repository/image-repository.js\";\nimport { Image } from \"../dto/image.js\";\n\n\n@injectable()\nclass ImageService {\n\n  @inject(\"ImageRepository\")\n  private imageRepository:ImageRepository\n\n  constructor() { }\n\n  async get(_id: string): Promise<Image> {\n    return this.imageRepository.get(_id)\n  }\n\n  async list() : Promise<Image[]> {\n    return this.imageRepository.list()\n  }\n\n  async getUrl(image: Image) {\n\n    if (!image.buffer && !image.svg) return \"\"\n\n    //If we have a buffer return it as a URL\n    if (image.buffer) {\n      return this.bufferToDataURL(\"image/jpg\", image.buffer)\n    } \n\n    if (image.svg) {\n      return this.getSVGURL(image)\n    }\n    \n\n  }\n\n\n  async getSVGURL(image: Image) {\n\n    if (!image.svg) return \"\"\n    return this.svgToDataURL(image.svg)\n\n  }\n\n\n  public svgToDataURL(svgStr) {  \n    return svgToMiniDataURI(svgStr)\n\n    // return \"data:image/svg+xml;base64,\" + Buffer.from(svgStr).toString(\"base64\")\n  }\n\n  public bufferToDataURL (mimeType, buffer) {\n    return `data:${mimeType};base64,${buffer.toString(\"base64\")}`\n  }\n\n}\n\n\nexport { ImageService }\n\n","import { inject, injectable } from \"inversify\";\nimport { StaticPageRepository } from \"../repository/static-page-repository.js\";\nimport { StaticPage } from \"../dto/static-page.js\";\n\n\n@injectable()\nclass StaticPageService {\n\n  @inject(\"StaticPageRepository\")\n  private staticPageRepository:StaticPageRepository\n\n\n  constructor() { }\n\n  async get(_id: string): Promise<StaticPage> {\n    return this.staticPageRepository.get(_id)\n  }\n\n  async listByLocation(location:string, skip:number): Promise<StaticPage[]> {\n    return this.staticPageRepository.listByLocation(location, skip)\n  }\n\n  async listRoutablePages(): Promise<StaticPage[]> {\n\n    let results = []\n\n    // if (additionalStaticPages?.length > 0) {\n    //   results.push(...additionalStaticPages)\n    // }\n    \n    results = results.concat(await this.staticPageRepository.listByLocation(\"navbar\", 0))\n    results = results.concat(await this.staticPageRepository.listByLocation(\"links\", 0))\n\n    //Clone these so we don't change the underlying objects\n    results = JSON.parse(JSON.stringify(results))\n\n    //Strip the content.\n    if (results?.length > 0) {\n      for (let staticPage of results) {\n        delete staticPage?.content\n        delete staticPage?.contentHTML\n        delete staticPage?.contentMarkdown\n      }\n    }\n\n    \n    return results \n  }\n}\n\n\nexport { StaticPageService }\n\n","import { inject, injectable } from \"inversify\";\nimport { Author } from \"../../dto/author.js\";\nimport { Channel } from \"../../dto/channel.js\";\nimport { Image } from \"../../dto/image.js\";\nimport { StaticPage } from \"../../dto/static-page.js\";\n\n\nimport { ChannelViewModel } from \"../../dto/viewmodel/channel-view-model.js\";\nimport { CHUNK_SIZE } from \"../../repository/item-repository.js\";\nimport { AuthorService } from \"../author-service.js\";\nimport { ChannelService } from \"../channel-service.js\";\nimport { PagingService } from \"../core/paging-service.js\";\nimport { SchemaService } from \"../core/schema-service.js\";\nimport { WalletService } from \"../core/wallet-service.js\";\nimport { ImageService } from \"../image-service.js\";\nimport { StaticPageService } from \"../static-page-service.js\";\n\n@injectable()\nclass ChannelWebService {\n\n    @inject(\"ChannelService\")\n    private channelService:ChannelService\n\n    @inject(\"AuthorService\")\n    private authorService:AuthorService\n\n    @inject(\"ImageService\")\n    private imageService:ImageService\n\n    @inject(\"PagingService\")\n    private pagingService:PagingService\n\n    @inject(\"SchemaService\")\n    private schemaService:SchemaService\n\n    @inject(\"WalletService\")\n    private walletService:WalletService\n\n    @inject(\"StaticPageService\")\n    private staticPageService:StaticPageService\n\n    private loadedChannelData\n\n    constructor() {}\n\n    async get(offset:number) : Promise<ChannelViewModel> {\n        return this.getViewModel(await this.channelService.get(), offset)\n    }\n\n    async getViewModel(channel:Channel, offset:number) : Promise<ChannelViewModel> {\n \n        let author:Author\n        let coverImage:Image\n\n        if (channel.authorId) {            \n            author = await this.authorService.get(channel.authorId)\n        }\n\n        let itemCount = channel.itemCount\n\n        let pagingViewModel = this.pagingService.buildPagingViewModel(offset, CHUNK_SIZE, itemCount, 5)\n\n        // let items = await this.itemWebService.list(offset)\n\n        \n        let locations = [\"navbar\", \"links\", \"index\", \"none\"]\n\n        let staticPagesViewModel = {}\n\n        for (let location of locations) {\n            staticPagesViewModel[location] = await this.staticPageService.listByLocation(location, 0)\n        }\n\n\n        // if (additionalStaticPages?.length > 0) {\n        //     for (let staticPage of additionalStaticPages) {\n        //         for (let location of staticPage?.locations) {\n        //             staticPagesViewModel[location].push(staticPage)\n        //         }\n        //     }\n        // }\n\n\n        if (channel.coverImageId) {\n            coverImage = await this.imageService.get(channel.coverImageId)\n        }\n\n\n        return {\n            channelContractAbbrev: channel.contractAddress ? this.walletService.truncateEthAddress(channel.contractAddress) : undefined,\n            channel: channel,\n            staticPagesViewModel: staticPagesViewModel,\n            author: author,\n            authorDisplayName: this.authorService.getDisplayName(author),\n            itemCount: itemCount,\n            pagingViewModel: pagingViewModel,\n            coverImage: coverImage\n        }\n\n    }\n\n    \n\n    async loadChannel(channelId, baseURI, hostname) {\n\n        globalThis.channelId = channelId\n        globalThis.baseURI = baseURI\n        globalThis.hostname = hostname     \n\n\n    }\n\n    async loadChannelData(channelId) {\n\n        if (channelId && this.loadedChannelData != channelId) {\n            await this.schemaService.reloadAll()\n            await this.schemaService.load(['component-state'])\n        }\n\n        this.loadedChannelData = channelId\n\n    }\n\n\n\n}\n\nexport {\n    ChannelWebService\n}","import { inject, injectable } from \"inversify\";\nimport { AnimationRepository } from \"../repository/animation-repository.js\";\nimport { Animation } from \"../dto/animation.js\";\nimport { ItemService } from \"./item-service.js\";\n\n\n@injectable()\nclass AnimationService {\n\n  @inject(\"AnimationRepository\")\n  private animationRepository:AnimationRepository\n\n  constructor() { }\n\n  async get(_id: string): Promise<Animation> {\n    return this.animationRepository.get(_id)\n  }\n\n}\n\n\nexport { AnimationService }\n\n","import { QuillDeltaToHtmlConverter } from \"quill-delta-to-html\"\nimport { deltaToMarkdown } from 'quill-delta-to-markdown'\n\nimport { injectable } from 'inversify';\n\n\n@injectable()\nclass QuillService {\n\n  constructor() {}\n\n  async translateContent(content: any): Promise<string> {\n\n    if (!content?.ops) return \"\"\n\n    // console.log(content.ops)\n\n    const qdc = new QuillDeltaToHtmlConverter(content.ops, { })\n\n    //Render dividers into HTML\n    qdc.renderCustomWith(function (customOp, contextOp) {\n\n      if (customOp.insert.type === 'divider') {\n        return \"<hr />\"\n      }\n\n      if (customOp.insert.type === 'ipfsimage') {\n        \n        let img = `<img src=\"${customOp.insert.value.src}\" `\n\n        if (customOp.insert.value.width) {\n          img += `width=\"${customOp.insert.value.width}\" `\n        }\n\n        if (customOp.insert.value.height) {\n          img += `height=\"${customOp.insert.value.height}\" `\n        }\n\n        if (customOp.insert.value.style) {\n          img += `style=\"${customOp.insert.value.style}\"`\n        }\n\n        img += \"/>\"\n\n        return img\n      }\n\n    })\n\n    return qdc.convert()\n  }\n\n\n  async generateMarkdown(content: any) : Promise<string> {\n    return deltaToMarkdown(content)\n  }\n\n\n}\n\n\n\nexport { QuillService }\n\n","import { inject, injectable } from \"inversify\";\r\nimport { AttributeTotal } from \"../dto/attribute-total.js\";\r\nimport { Channel } from \"../dto/channel.js\";\r\nimport { Item } from \"../dto/item.js\";\r\nimport { AttributeTotalRepository } from \"../repository/attribute-total-repository.js\";\r\n\r\n@injectable()\r\nclass AttributeTotalService {\r\n\r\n    @inject(\"AttributeTotalRepository\")\r\n    private attributeTotalRepository:AttributeTotalRepository\r\n\r\n    constructor() {}\r\n\r\n    async get(_id:string): Promise<AttributeTotal> {      \r\n        return this.attributeTotalRepository.get(_id)\r\n    }\r\n\r\n    async put(attributeTotal:AttributeTotal) : Promise<void> {\r\n        return this.attributeTotalRepository.put(attributeTotal)\r\n    }\r\n\r\n    async getByIds(ids:string[]) : Promise<AttributeTotal[]> {\r\n        return this.attributeTotalRepository.getByIds(ids)\r\n    }\r\n\r\n    async list() : Promise<AttributeTotal[]> {\r\n        return this.attributeTotalRepository.list()\r\n    }\r\n\r\n    async buildAttributeTotals(channel:Channel, items:Item[]) : Promise<AttributeTotal[]> {\r\n\r\n        let totals:AttributeTotal[] = []\r\n        \r\n        //Build starting total objects.\r\n        let totalKeys = new Set(items.map( item => item.attributeSelections.map( as => `${as.traitType}:::${as.value}`) ).flat())\r\n\r\n\r\n        for (let totalKey of totalKeys) {\r\n\r\n            let attributeTotal:AttributeTotal = {\r\n                _id: totalKey,\r\n                traitType: totalKey.substring(0, totalKey.indexOf(\":::\")),\r\n                value: totalKey.substring(totalKey.indexOf(\":::\") + 3, totalKey.length ),\r\n                count: 0,\r\n                tokenIds: []\r\n            }\r\n\r\n            totals.push(attributeTotal)\r\n\r\n        }\r\n\r\n\r\n\r\n        //Loop through the items\r\n        for (let item of items) {\r\n\r\n            for (let as of item.attributeSelections) {\r\n                \r\n                //Find the matching AttributeTotal\r\n                let total:AttributeTotal = totals.filter( at => at.traitType == as.traitType && at.value == as.value)[0]\r\n\r\n                // console.log(as.traitType, as.value, totals.filter( at => at.traitType == as.traitType))\r\n\r\n                //Add one to the report total\r\n                total.tokenIds.push(item.tokenId)\r\n                total.count++\r\n            }\r\n\r\n        }\r\n\r\n        //Loop through keys and calculate totals for each one.\r\n        for (let total of totals) {\r\n            total.categoryPercent = new Intl.NumberFormat('default', {\r\n                style: 'percent',\r\n                minimumFractionDigits: 2,\r\n                maximumFractionDigits: 2,\r\n              }).format((total.count / channel.itemCount))\r\n        }\r\n\r\n\r\n\r\n        //Sort totals by count\r\n        totals.sort((a,b) => b.count - a.count)\r\n\r\n\r\n        return totals\r\n    }\r\n\r\n\r\n}\r\n\r\nexport {\r\n    AttributeTotalService\r\n}","import { inject, injectable } from \"inversify\";\nimport { Item } from \"../dto/item.js\";\nimport { ItemPage, RowItemViewModel } from \"../dto/item-page.js\";\nimport { ItemRepository } from \"../repository/item-repository.js\";\nimport { AttributeTotal } from \"../dto/attribute-total.js\";\nimport { AttributeTotalService } from \"./attribute-total-service.js\";\nimport { Channel } from \"../dto/channel.js\";\nimport { RowItemViewModelRepository } from \"../repository/row-item-view-model-repository.js\";\n\n@injectable()\nclass ItemService {\n\n    @inject(\"ItemRepository\")\n    private itemRepository:ItemRepository\n\n    @inject(\"RowItemViewModelRepository\")\n    private rowItemViewModelRepository:RowItemViewModelRepository\n    \n    \n    @inject(\"AttributeTotalService\")\n    private attributeTotalService:AttributeTotalService\n\n    constructor(\n    ) { }\n\n    async get(_id: string): Promise<Item> {\n        return this.itemRepository.get(_id)\n    }\n    \n    async list(skip: number, limit?:number): Promise<Item[]> {\n        return this.itemRepository.list(skip, limit)\n    }\n\n    async query(query:string) {\n        return this.itemRepository.query(query)\n    }\n    \n    async all() {\n        return this.itemRepository.all()\n    }\n    \n    async getByTokenId(tokenId:number) : Promise<Item> {\n        return this.itemRepository.getByTokenId(tokenId)\n    }\n\n    async getByTokenIds(tokenIds:number[]) : Promise<Item[]> {\n        return this.itemRepository.getByTokenIds(tokenIds)\n    }\n\n    async getRowItemViewModelsByAttribute(traitType:string, value:string, pageNumber:number) : Promise<ItemPage> {\n        return this.itemRepository.getRowItemViewModelsByAttribute(traitType, value, pageNumber)\n    }\n\n    async getRowItemViewModelsByOwner(address:string, pageNumber:number) : Promise<ItemPage> {\n        return this.itemRepository.getRowItemViewModelsByOwner(address, pageNumber)\n    }\n\n    async getRowItemViewModelsByTokenIds(tokenIds:number[]) : Promise<RowItemViewModel[]> {\n        return this.itemRepository.getRowItemViewModelsByTokenIds(tokenIds)    \n    }\n\n    async getRowItemViewModelsByTokenId(tokenId:number) : Promise<RowItemViewModel> {\n        return this.itemRepository.getRowItemViewModelsByTokenId(tokenId)    \n    }\n\n\n    async listByTokenId(startTokenId:number, limit:number=10) {\n        return this.itemRepository.listByTokenId(startTokenId, limit)\n    }\n\n\n    async buildAttributeTotals(channel:Channel) : Promise<AttributeTotal[]> {\n\n        let items:Item[] = await this.all()\n\n        return this.attributeTotalService.buildAttributeTotals(channel, items)\n    }\n\n\n    async searchTokenIds(tokenIds:number[]) {\n        return this.rowItemViewModelRepository.getByTokenIds(tokenIds)\n    } \n\n\n}\n\nexport {\n    ItemService\n}","import { inject, injectable } from \"inversify\";\n\nimport { ItemPage } from \"../dto/item-page.js\";\nimport { ItemPageRepository } from \"../repository/item-page-repository.js\";\n\n@injectable()\nclass ItemPageService {\n\n    @inject(\"ItemPageRepository\")\n    private itemPageRepository:ItemPageRepository\n  \n    constructor(\n    ) { }\n\n    async get(pageNumber: number): Promise<ItemPage> {\n        return this.itemPageRepository.get(pageNumber)\n    }\n    \n}\n\nexport {\n    ItemPageService\n}","import { inject, injectable } from \"inversify\";\r\nimport { Author } from \"../../dto/author.js\";\r\nimport { Channel } from \"../../dto/channel.js\";\r\nimport { Image } from \"../../dto/image.js\";\r\nimport { Item } from \"../../dto/item.js\";\r\nimport { Animation } from \"../../dto/animation.js\";\r\n\r\nimport { AttributeSelectionViewModel } from \"../../dto/viewmodel/attribute-selection-view-model.js\";\r\n\r\n\r\nimport { ItemViewModel } from \"../../dto/viewmodel/item-view-model.js\";\r\nimport { AnimationService } from \"../animation-service.js\";\r\nimport { AuthorService } from \"../author-service.js\";\r\nimport { ChannelService } from \"../channel-service.js\";\r\nimport { QuillService } from \"../core/quill-service.js\";\r\nimport { SchemaService } from \"../core/schema-service.js\";\r\nimport { ImageService } from \"../image-service.js\";\r\nimport { ItemService } from \"../item-service.js\";\r\n\r\nimport { ItemPage, ItemResults, RowItemViewModel } from \"../../dto/item-page.js\";\r\nimport { ItemPageService } from \"../item-page-service.js\";\r\nimport { AttributeTotal } from \"../../dto/attribute-total.js\";\r\nimport { AttributeTotalService } from \"../attribute-total-service.js\";\r\nimport { AttributeOptions, AttributeOptionsViewModel } from \"../../dto/attribute.js\";\r\n\r\nimport he from \"he\"\r\nimport { DOMParser, XMLSerializer } from '@xmldom/xmldom'\r\n\r\nconst parser = new DOMParser()\r\n\r\n@injectable()\r\nclass ItemWebService {\r\n\r\n    @inject(\"ItemService\")\r\n    private itemService: ItemService\r\n\r\n    @inject(\"ChannelService\")\r\n    private channelService: ChannelService\r\n\r\n    @inject(\"AuthorService\")\r\n    private authorService: AuthorService\r\n\r\n    @inject(\"ImageService\")\r\n    private imageService: ImageService\r\n\r\n    @inject(\"SchemaService\")\r\n    private schemaService: SchemaService\r\n\r\n    @inject(\"QuillService\")\r\n    private quillService: QuillService\r\n\r\n    @inject(\"AnimationService\")\r\n    private animationService: AnimationService\r\n\r\n    @inject(\"ItemPageService\")\r\n    private itemPageService: ItemPageService\r\n\r\n    @inject(\"AttributeTotalService\")\r\n    private attributeTotalService: AttributeTotalService\r\n\r\n\r\n\r\n    private allTokensCache:number[]\r\n\r\n    constructor() {}\r\n\r\n    async get(_id: string): Promise<ItemViewModel> {\r\n\r\n        let item:Item = await this.itemService.get(_id)\r\n\r\n        //Get channel\r\n        const channel = await this.channelService.get()\r\n\r\n        //Get attribute report\r\n        const attributeReport:AttributeTotal[] = await this.attributeTotalService.list()\r\n\r\n        return this.getViewModel(item, channel, attributeReport)\r\n    }\r\n\r\n    async getByTokenId(tokenId:number) : Promise<Item> {\r\n\r\n        return this.itemService.getByTokenId(tokenId)\r\n\r\n    }\r\n\r\n    async getViewModel(item: Item, channel:Channel, attributeReport:AttributeTotal[]): Promise<ItemViewModel> {\r\n\r\n        let attributeSelections:AttributeSelectionViewModel[] = []\r\n\r\n        let author: Author\r\n        let coverImage:Image\r\n        let animation:Animation\r\n\r\n        let animationContentHTML\r\n\r\n        //Get author\r\n        if (channel.authorId) {\r\n            author = await this.authorService.get(channel.authorId)\r\n        }\r\n\r\n        //Only show attributes that are valid at the category level. \r\n        if (channel.attributeOptions.length > 0) {\r\n\r\n            for (let ao of channel.attributeOptions) {\r\n\r\n                //find the one selected by this item\r\n                let selections = item?.attributeSelections?.filter( as => ao?.traitType == as?.traitType)\r\n\r\n                let selection = selections?.length > 0 ? selections[0].value : undefined\r\n\r\n\r\n                let attributeTotals:AttributeTotal[] = attributeReport.filter( at => at.traitType == ao.traitType)\r\n\r\n                let matches = attributeTotals?.filter( at => at.value == selection)\r\n\r\n\r\n                attributeSelections.push({\r\n                    id: ao.id,\r\n                    traitType: ao.traitType,\r\n                    values: ao.values,\r\n                    value: selection,\r\n                    attributeTotal: matches?.length > 0 ? matches[0] : undefined\r\n                })\r\n\r\n            }\r\n\r\n        }\r\n\r\n        //Get image\r\n        if (item.coverImageId) {\r\n            coverImage = await this.imageService.get(item.coverImageId)\r\n        }\r\n\r\n        //Get animation if we are displaying it.\r\n        if (item.animationId && !item.coverImageAsAnimation) {\r\n\r\n            animation = await this.animationService.get(item.animationId)\r\n\r\n            let page = parser.parseFromString(animation.content, 'text/html')\r\n\r\n            let body = page.getElementsByTagName('body')[0]\r\n            \r\n            animationContentHTML = he.unescape(new XMLSerializer().serializeToString(body))\r\n\r\n            //Swap body tag to a div\r\n            animationContentHTML = \"<div\" + animationContentHTML.slice(5)\r\n            animationContentHTML = animationContentHTML.substring(0, animationContentHTML.length - 7) + \"</div>\"\r\n\r\n                \r\n        }\r\n\r\n\r\n        //Get image data and re-insert it into the content ops\r\n        if (item.content?.ops?.length > 0) {\r\n\r\n            let ops = []\r\n\r\n            for (let op of item.content.ops) {\r\n\r\n                if (op.insert && op.insert.ipfsimage) {\r\n\r\n                    let image:Image = await this.imageService.get(op.insert.ipfsimage.cid)\r\n            \r\n                    op.insert.ipfsimage.src = await this.imageService.getUrl(image)\r\n\r\n                    // console.log(op.src)\r\n                }\r\n\r\n                ops.push(op)\r\n            }\r\n\r\n            item.content.ops = ops\r\n\r\n        }\r\n\r\n\r\n        //Load previous and nex\r\n\r\n\r\n        return {\r\n            item: item,\r\n            animation:animation,\r\n            animationContentHTML: animationContentHTML,\r\n            contentHTML: await this.quillService.translateContent(item.content),\r\n            channel: channel,\r\n            author: author,\r\n            authorDisplayName: this.authorService.getDisplayName(author),\r\n            attributeSelections: attributeSelections,\r\n            coverImage: coverImage\r\n        }\r\n\r\n    }\r\n\r\n    async getMintViewModel(item: Item, channel:Channel): Promise<ItemViewModel> {\r\n\r\n        let attributeSelections:AttributeSelectionViewModel[] = []\r\n\r\n        let author: Author\r\n        let coverImage:Image\r\n        let animation:Animation\r\n\r\n        //Get image\r\n        if (item.coverImageId) {\r\n            coverImage = await this.imageService.get(item.coverImageId)\r\n        }\r\n\r\n        return {\r\n            item: item,\r\n            animation:animation,\r\n            channel: channel,\r\n            author: author,\r\n            attributeSelections: attributeSelections,\r\n            coverImage: coverImage\r\n        }\r\n\r\n    }\r\n\r\n    async getSearchViewModel(item: Item, channel:Channel): Promise<ItemViewModel> {\r\n\r\n        let attributeSelections:AttributeSelectionViewModel[] = []\r\n\r\n        let author: Author\r\n        let coverImage:Image\r\n        let animation:Animation\r\n\r\n        //Get image\r\n        // if (item.coverImageId) {\r\n        //     coverImage = await this.imageService.get(item.coverImageId)\r\n        // }\r\n\r\n        return {\r\n            item: item,\r\n            animation:animation,\r\n            channel: channel,\r\n            author: author,\r\n            attributeSelections: attributeSelections,\r\n            // coverImage: coverImage\r\n        }\r\n\r\n    }\r\n\r\n    async getExploreAttributeOptions(params:any) : Promise<AttributeOptionsViewModel[]> {\r\n\r\n        await this.schemaService.load([\"channels\", \"authors\", \"attribute-totals\"])\r\n\r\n        //Get channel\r\n        const channel = await this.channelService.get()\r\n\r\n\r\n        let attributeTotals:AttributeTotal[] = await this.attributeTotalService.list()\r\n\r\n\r\n        //Get a list of the token IDs that we're already filtered to so we can adjust the counts.\r\n        // let filteredIds = await this._paramsToFilteredIds(params, attributeTotals)\r\n\r\n        let attributeOptions:AttributeOptions[] = channel.attributeOptions\r\n\r\n        let results:AttributeOptionsViewModel[] = []\r\n\r\n        for (let ao of attributeOptions) {\r\n\r\n            let values = []\r\n\r\n            for (let v of ao.values.sort()) {\r\n\r\n                let clonedParams = JSON.parse(JSON.stringify(params))\r\n                delete clonedParams[ao.traitType]\r\n\r\n                //Unapply the selection for this filter so the counts are like this one isn't already applied. \r\n                let parentFilteredIds = await this._paramsToFilteredIds(clonedParams, attributeTotals)\r\n\r\n                let at = attributeTotals.filter( at => at.traitType ==  ao.traitType && at.value == v)[0]\r\n\r\n                if (at) {\r\n\r\n                    values.push({\r\n                        value: v,\r\n                        count: at.tokenIds.filter(x => parentFilteredIds.includes(x)).length \r\n                    })\r\n\r\n                } \r\n\r\n            }\r\n            \r\n            //Sort by count\r\n            values.sort((a,b) => b.count - a.count)\r\n\r\n\r\n            let aovm:AttributeOptionsViewModel = {\r\n                id: ao.id,\r\n                traitType: ao.traitType,\r\n                values: values\r\n            }\r\n\r\n            results.push(aovm)\r\n\r\n        }\r\n\r\n\r\n        return results\r\n\r\n    }\r\n\r\n    async exploreList(params:any, skip: number, limit?:number): Promise<ItemResults> {\r\n\r\n        await this.schemaService.load([\"channels\", \"authors\", \"attribute-totals\", \"row-item-view-models\"])\r\n        \r\n\r\n        if (params && Object.keys(params)?.length > 0) {\r\n\r\n            return this.exploreQuery(params, skip, limit)\r\n\r\n        } else {\r\n\r\n            //Figure out which page this is and return it.\r\n            let pageNumber = skip / limit \r\n\r\n            let itemPage:ItemPage = await this.itemPageService.get(pageNumber)\r\n            let channel:Channel = await this.channelService.get()\r\n\r\n\r\n            return {\r\n                items: itemPage.items,\r\n                totalMatches: channel.itemCount,\r\n                limit: limit,\r\n                skip: skip\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    async exploreQuery(params:any,  skip: number, limit?:number): Promise<ItemResults> {\r\n\r\n        await this.schemaService.load([ \"channels\", \"authors\", \"attribute-totals\", \"row-item-view-models\"])\r\n        \r\n        let attributeTotals:AttributeTotal[] = await this.attributeTotalService.list()\r\n\r\n        let filteredIds = await this._paramsToFilteredIds(params, attributeTotals)\r\n        \r\n        //Paging\r\n        let totalMatches = filteredIds.length\r\n        filteredIds = filteredIds.slice(skip, skip + limit)\r\n\r\n        let viewModels:RowItemViewModel[] = await this.itemService.searchTokenIds(filteredIds)\r\n\r\n        return {\r\n            items: viewModels,\r\n            totalMatches: totalMatches,\r\n            limit: limit,\r\n            skip: skip\r\n        }\r\n    \r\n    }\r\n\r\n    async _paramsToFilteredIds(params, allAttributeTotals:AttributeTotal[]) : Promise<number[]> {\r\n\r\n        let attributeTotalIds = []\r\n\r\n        for (let key of Object.keys(params)) {\r\n            attributeTotalIds.push(`${key}:::${params[key]}`)\r\n        }\r\n\r\n        let attributeTotals:AttributeTotal[] = allAttributeTotals?.filter( at => attributeTotalIds?.includes(at._id))  \r\n\r\n        if (attributeTotals?.length > 0) {\r\n            return attributeTotals.map( at => at.tokenIds).reduce((p,c) => p.filter(e => c.includes(e)))\r\n        } else {\r\n\r\n            //No filter selected so return every token ID\r\n            if (!this.allTokensCache) {\r\n                this.allTokensCache = Array.from(new Set(allAttributeTotals.map( at => at.tokenIds).flat()))\r\n            }\r\n\r\n            return this.allTokensCache\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n\r\n    async list(skip: number, limit?:number): Promise<ItemViewModel[]> {\r\n\r\n        let result: ItemViewModel[] = []\r\n\r\n        //Get channel\r\n        const channel = await this.channelService.get()\r\n\r\n        //Get attribute report\r\n        const attributeReport:AttributeTotal[] = await this.itemService.buildAttributeTotals(channel)\r\n        \r\n        let items: Item[] = await this.itemService.list(skip, limit)\r\n\r\n        for (let item of items) {\r\n            result.push(await this.getViewModel(item, channel, attributeReport))\r\n        }\r\n\r\n        return result\r\n\r\n    }\r\n\r\n    async mintList(skip: number, limit?:number): Promise<ItemViewModel[]> {\r\n\r\n        let result: ItemViewModel[] = []\r\n\r\n        //Get channel\r\n        const channel = await this.channelService.get()\r\n        \r\n        let items: Item[] = await this.itemService.list(skip, limit)\r\n\r\n        for (let item of items) {\r\n            result.push(await this.getMintViewModel(item, channel))\r\n        }\r\n\r\n        return result\r\n\r\n    }\r\n\r\n\r\n\r\n    async itemPage(pageNumber:number) : Promise<ItemPage> {\r\n        return this.itemPageService.get(pageNumber)\r\n    }\r\n\r\n    async attributeItemPage(traitType:string, value: string, pageNumber:number) : Promise<ItemPage> {\r\n        return this.itemService.getRowItemViewModelsByAttribute(traitType, value, pageNumber)\r\n    }\r\n\r\n    async ownerItemPage(address:string, pageNumber:number) : Promise<ItemPage> {\r\n        return this.itemService.getRowItemViewModelsByOwner(address, pageNumber)\r\n    }\r\n\r\n    async query(query:string) : Promise<Item[]> {\r\n\r\n        await this.schemaService.load([\"items\", \"channels\"])\r\n\r\n        let results = await this.itemService.query(query)\r\n\r\n\r\n        //Get channel\r\n        const channel = await this.channelService.get()\r\n\r\n        let viewModels: ItemViewModel[] = []\r\n\r\n        for (let item of results) {\r\n            viewModels.push(await this.getSearchViewModel(item, channel))\r\n        }\r\n\r\n\r\n        return viewModels\r\n    }\r\n\r\n    async buildItemPages(itemViewModels:ItemViewModel[], perPage:number) : Promise<ItemPage[]> {\r\n\r\n        // await this.schemaService.load([\"images\"])\r\n\r\n        let result: ItemPage[] = []\r\n\r\n\r\n        let viewModels:RowItemViewModel[] = [] \r\n\r\n        //Create view models\r\n        for (let itemViewModel of itemViewModels) {\r\n\r\n            let item:Item = itemViewModel.item\r\n\r\n            viewModels.push({\r\n                _id: item._id,\r\n                coverImageGenerated: itemViewModel.coverImage.generated ? true : false,\r\n                coverImageId: itemViewModel.coverImage._id,\r\n                title: `${item.title ? item.title : `#${item.tokenId}` }`,\r\n                tokenId: item.tokenId\r\n            })\r\n\r\n        }\r\n\r\n        //Break into rows\r\n        for (let i = 0; i < viewModels.length; i += perPage) {\r\n            result.push({\r\n                items: viewModels.slice(i, i + perPage)\r\n            })\r\n        }\r\n\r\n\r\n        return result\r\n\r\n    }\r\n    \r\n    async buildAttributeTotals(channel:Channel) : Promise<AttributeTotal[]> {\r\n        return this.itemService.buildAttributeTotals(channel)\r\n    }\r\n\r\n    async getRowItemViewModelsByTokenIds(filteredIds) : Promise<RowItemViewModel[]> {\r\n        return this.itemService.getRowItemViewModelsByTokenIds(filteredIds)\r\n    }\r\n\r\n    translateRowItemViewModel(item:Item, coverImage:Image) : RowItemViewModel {\r\n\r\n        let viewModel:RowItemViewModel = {\r\n            _id: item._id,\r\n            coverImageGenerated: coverImage.generated ? true : false,\r\n            coverImageId: coverImage._id,\r\n            title: `${item.title ? item.title : `#${item.tokenId}`}`,\r\n            tokenId: item.tokenId\r\n        }\r\n        \r\n        return viewModel\r\n\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\nexport {\r\n    ItemWebService\r\n}","import { inject, injectable } from \"inversify\";\nimport { Author } from \"../../dto/author.js\";\nimport { AuthorViewModel } from \"../../dto/viewmodel/author-view-model.js\";\nimport { ImageViewModel } from \"../../dto/viewmodel/image-view-model.js\";\nimport { AuthorService } from \"../author-service.js\";\n\n@injectable()\nclass AuthorWebService {\n\n    @inject(\"AuthorService\")\n    private authorService:AuthorService\n\n    constructor(\n    ) {}\n\n    async get(_id: string): Promise<AuthorViewModel> {\n        return this.getViewModel(await this.authorService.get(_id))\n    }\n\n    async getViewModel(author: Author): Promise<AuthorViewModel> {\n\n        let authorPhoto:ImageViewModel\n\n        return {\n            author: author,\n            authorDisplayName: this.authorService.getDisplayName(author)\n        }\n\n    }\n\n\n\n}\n\nexport {\n    AuthorWebService\n}","import { inject, injectable } from \"inversify\";\nimport { MetadataRepository } from \"../repository/metadata-repository.js\";\nimport { WalletService } from \"./core/wallet-service.js\";\nimport { id } from \"ethers\"\n\n\n@injectable()\nclass TokenContractService {\n\n    @inject(\"MetadataRepository\")\n    private metadataRepository:MetadataRepository\n\n    @inject(\"WalletService\")\n    private walletService:WalletService\n\n    constructor(\n    ) {}\n\n    private lastMintedTokenId=0\n\n\n    async getBalance(address) : Promise<number> {\n        if (!address) return 0\n\n        let channelContract = await this.getChannelContract()\n\n        return parseInt(await channelContract.balanceOf(address))\n    }\n\n    async getMetadata(tokenId) : Promise<any> {\n        return this.metadataRepository.get(tokenId)      \n    }\n\n    async mint(quantity:number, totalMintCost:string) {\n\n        let channelContract = await this.getChannelContract()\n\n\n        await channelContract.mint(quantity, { value: totalMintCost })\n    }\n\n    async mintFromStartOrFail(quantity:number, start:number, totalMintCost:string) {\n        let channelContract = await this.getChannelContract()\n        await channelContract.mintFromStartOrFail(quantity, start, { value: totalMintCost })\n    }\n\n    \n    async mintAsOwner(quantity:number) {\n        let channelContract = await this.getChannelContract()\n        await channelContract.mint(quantity, {})\n    }\n\n    async ownerOf(tokenId:number)  {\n        let channelContract = await this.getChannelContract()\n        return channelContract.ownerOf(tokenId)\n    }\n\n    async getTotalMinted() {\n        let channelContract = await this.getChannelContract()\n        return channelContract.totalMinted()\n    }\n\n    async getTotalSupply() {\n        let channelContract = await this.getChannelContract()\n        return channelContract.totalSupply()\n    }\n\n    async owner() {\n        let channelContract = await this.getChannelContract()\n        return channelContract.owner()\n    }\n\n    async getChannelContract() : Promise<ChannelContract> {\n\n\n        let contract:ChannelContract = await this.walletService.getContract(\"Channel\")\n\n        //Add event listener for mints if it's not already added. Maybe won't work if we ever add a second listener anywhere\n        if (this.walletService.provider && this.walletService.provider.listeners()?.length == 0) {\n            \n            let filter = {\n                address: contract.address,\n                topics: [\n                    // the name of the event, parnetheses containing the data type of each event, no spaces\n                    id(\"MintEvent(uint256)\")\n                ]\n            }\n            \n            this.walletService.provider.on( filter, async (e) => {\n\n                let tokenId = parseInt(e.data)\n\n                if (tokenId > this.lastMintedTokenId) {\n                    this.lastMintedTokenId = tokenId\n\n                    let mintEvent = new CustomEvent('mint-event')\n\n                    //@ts-ignore\n                    mintEvent.tokenId = tokenId\n              \n                    document.dispatchEvent(mintEvent)\n\n                }\n\n            })\n\n        }\n\n        return contract\n    }\n\n\n}\n\ninterface ChannelContract {\n    mint(quantity:number, options:any)\n    mintFromStartOrFail(quantity:number, start:number,options:any)\n    ownerOf(tokenId:number) : string\n    tokenURI(tokenId:number) : string\n    balanceOf(address) : string\n    totalMinted() : BigInt\n    totalSupply() : BigInt\n    owner() : string\n    address:string\n}\n\n\n\nexport {\n    TokenContractService\n}","import { inject, injectable } from \"inversify\";\nimport { Channel } from \"../../dto/channel.js\";\nimport { MintingViewModel } from \"../../dto/viewmodel/minting-view-model.js\";\nimport { ChannelService } from \"../channel-service.js\";\nimport { SchemaService } from \"../core/schema-service.js\";\nimport { WalletService } from \"../core/wallet-service.js\";\nimport { ItemService } from \"../item-service.js\";\nimport { TokenContractService } from \"../token-contract-service.js\";\nimport { parseUnits, formatUnits } from \"ethers\";\n\n@injectable()\nclass MintWebService {\n\n    @inject(\"TokenContractService\")\n    private tokenContractService:TokenContractService\n\n    @inject(\"ChannelService\")\n    private channelService:ChannelService\n    \n\n    @inject(\"ItemService\")\n    private itemService:ItemService\n\n    @inject(\"SchemaService\")\n    private schemaService:SchemaService\n    \n    @inject(\"WalletService\")\n    private walletService:WalletService\n\n    constructor(\n    ) {}\n\n    async getMintingViewModel() : Promise<MintingViewModel> {\n\n        await this.schemaService.load([\"channels\", \"items\"])\n\n        let channel:Channel = await this.channelService.get()\n\n        if (channel.contractAddress) {\n\n            let totalMinted:BigInt = await this.tokenContractService.getTotalMinted()       \n\n            let lastMinted = []\n\n            if (Number(totalMinted) > 0 ) {\n\n                let items = await this.itemService.listByTokenId(Number(totalMinted))\n\n                for (let item of items) {\n\n                    try {\n\n                        //@ts-ignore\n                        let owner = await this.tokenContractService.ownerOf(item.tokenId)\n\n                        lastMinted.push({\n                            owner: await this.walletService.truncateEthAddress(owner),\n                            item: item\n                        })\n\n                    } catch(ex) {}\n\n                    \n                }\n\n            }            \n\n\n            return {\n                totalMinted: Number(totalMinted),\n                totalSupply: channel.itemCount,\n                mintPrice: channel.mintPrice,\n                lastMinted: lastMinted,\n                minting: Number(totalMinted) < channel.itemCount\n            }\n            \n        }\n\n    }\n\n    async getHomeMintingViewModel() : Promise<MintingViewModel> {\n\n        await this.schemaService.load([\"channels\"])\n\n        let channel:Channel = await this.channelService.get()\n\n        if (channel.contractAddress) {\n\n            let totalMinted:BigInt = await this.tokenContractService.getTotalMinted()       \n\n            return {\n                totalMinted: Number(totalMinted),\n                totalSupply: channel.itemCount,\n                mintPrice: channel.mintPrice\n            }\n            \n        }\n    }\n\n\n\n    async mint(quantity:number) {\n\n        await this.schemaService.load([\"channels\"])\n        let channel:Channel = await this.channelService.get()\n        let totalWei = await this.calculateTotalMint(channel, quantity)\n\n        let owner = await this.tokenContractService.owner()\n\n        // console.log(owner.toLowerCase(), this.walletService.address.toLowerCase())\n\n        if (this.walletService.address.toLowerCase() == owner.toLowerCase()) {\n            console.log('Minting as owner')\n            await this.tokenContractService.mintAsOwner(quantity)\n        } else {\n            await this.tokenContractService.mint(quantity, totalWei)\n        }\n\n        \n    }\n\n    async mintFromStartOrFail(quantity:number, start:number) {\n\n        await this.schemaService.load([\"channels\"])\n        let channel:Channel = await this.channelService.get()\n        \n        let totalWei = await this.calculateTotalMint(channel, quantity)\n\n        await this.tokenContractService.mintFromStartOrFail(quantity, start, totalWei)\n    }\n\n    async calculateTotalMint(channel, quantity) {\n\n        let mintPriceWei = parseUnits(channel.mintPrice, 'ether')\n\n        let total = Number(mintPriceWei) * quantity\n\n        return total.toString()\n \n    }\n\n    async updateTotal(mintPriceWei:BigInt, quantity:number) : Promise<string>{\n        return formatUnits(Number(mintPriceWei) * quantity)\n    }\n\n\n    async parseUnits(mintPrice:string) : Promise<BigInt> {\n       return parseUnits(mintPrice, 'ether')\n\n    }\n\n}\n\nexport {\n    MintWebService\n}","\nimport { inject, injectable } from \"inversify\";\n\n@injectable()\nclass QueueService {\n\n    constructor(\n      @inject(\"framework7\") private app,\n    ) {}\n\n    async queuePromiseView(promiseView) : Promise<any> {\n\n      const self = this\n\n      let queueItem: QueueItem = {\n        id: Guid.newGuid(),\n        icon: promiseView.icon,\n        title: promiseView.title,\n      }\n\n      let before = async function () {\n        return new Promise<void>((resolve, reject) => {\n          self._beforeSaveAction(queueItem)\n          resolve()\n        })\n      }\n\n      let after = async function() {\n\n        let result = await promiseView.promise\n\n        try {\n          console.log(\"Transaction hash is \", result)\n\n\n          self._showSuccess(result, queueItem)\n        } catch(ex) {\n          self._showError(ex, queueItem)\n        }\n\n        return result\n\n      }\n\n      return before()\n              .then(after)\n    }\n\n    private _beforeSaveAction(queueItem: QueueItem) : void {     \n\n      // Create toast with close button\n      queueItem.toast = this.app.toast.create({\n        text: queueItem.title,\n        closeButton: true\n      })\n\n      queueItem.toast.open()\n\n    }\n\n    private _showError(error, queueItem:QueueItem) {\n\n      queueItem.toast.close()\n\n      console.log(error)\n\n      let toast = {\n        text: error.message,\n        closeButton: true,\n        closeButtonText: \"Close\",\n        closeTimeout: 5000\n      }\n\n      this.app.toast.create(toast).open()\n\n    }\n\n    private _showSuccess(result, queueItem:QueueItem): void {\n\n      const self = this\n\n      queueItem.toast.close()\n\n      let toast = {\n        text: \"Transaction Submitted\",\n        closeButton: true,\n        closeTimeout: 5000\n      }\n\n      this.app.toast.create(toast).open()\n    }\n\n}\n\ninterface QueueItem {\n  toast?: any\n\n  id: string,\n  icon: string,\n  title: string,\n}\n\n//from https://stackoverflow.com/questions/26501688/a-typescript-guid-class\nclass Guid {\n  static newGuid() {\n      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n          var r = Math.random()*16|0, v = c == 'x' ? r : (r&0x3|0x8);\n          return v.toString(16);\n      });\n  }\n}\n\nexport { QueueService, QueueItem }\n","import { injectable, inject } from \"inversify\";\n\n\n\n@injectable()\nclass UiService {\n\n    constructor(@inject(\"framework7\") public app) {\n    }\n\n    showExceptionPopup(ex) {\n        console.log(ex)\n        this.app.dialog.alert(ex.message, \"There was an error\")\n    }\n\n    showPopup(message) {\n        this.app.dialog.alert(message)\n    }\n\n\n\n    showAlert(message) {\n        this.app.dialog.alert(message)\n    }\n\n\n    /**\n     * Spinner\n     */\n\n    spinnerDialog: any\n\n    showSpinner(message?:string) {\n\n        if (this.spinnerDialog) this.hideSpinner()\n\n        this.spinnerDialog = this.app.dialog.preloader(message ? message : \"Loading\")\n\n    }\n\n\n    hideSpinner() {\n        if (this.spinnerDialog) {\n            this.spinnerDialog.close()\n            this.spinnerDialog = null \n        }\n    }\n\n\n    progressDialog:any\n\n    showProgress(message:string) {\n\n        if (this.progressDialog) this.hideProgress()\n\n        var progress = 0\n\n        this.progressDialog = this.app.dialog.progress(message ? message : \"Loading\", progress)\n\n    }\n\n    setProgress(progress:number, message:string) {\n        if (this.progressDialog) {\n            this.progressDialog.setProgress(progress)\n            this.progressDialog.setText(message)\n        }\n    }\n\n    hideProgress() {\n        if (this.progressDialog) {\n            this.progressDialog.close()\n            this.progressDialog = null \n        }\n    }\n\n\n}\n\nexport {\n    UiService\n}","import { validate, ValidationError } from 'class-validator';\r\n\r\n\r\nclass ValidationException extends Error {\r\n\r\n    constructor(\r\n        public errors:ValidationError[]\r\n    ) {\r\n        super()\r\n    }\r\n\r\n}\r\n\r\nexport {\r\n    ValidationException\r\n}","import { inject, injectable } from \"inversify\";\r\nimport { ReaderSettings } from \"../dto/reader-settings.js\";\r\nimport { ValidationException } from \"../util/validation-exception.js\";\r\n\r\nimport { ReaderSettingsRepository } from \"../repository/reader-settings-repository.js\";\r\nimport { validate, ValidationError } from 'class-validator';\r\nimport { SchemaService } from \"./core/schema-service.js\";\r\n\r\n\r\n@injectable()\r\nclass ReaderSettingsService {\r\n\r\n  @inject(\"ReaderSettingsRepository\")\r\n  private readerSettingsRepository:ReaderSettingsRepository\r\n\r\n  @inject(\"SchemaService\")\r\n  private schemaService: SchemaService\r\n\r\n\r\n  constructor() { \r\n  }\r\n\r\n  async get(): Promise<ReaderSettings> {\r\n\r\n    await this.schemaService.load([\"reader-settings\"])\r\n\r\n    return this.readerSettingsRepository.get()\r\n  }\r\n\r\n  async put(readerSettings:ReaderSettings): Promise<void> {     \r\n\r\n    readerSettings.lastUpdated = new Date().toJSON()\r\n\r\n\r\n    //Validate\r\n    let errors: ValidationError[] = await validate(readerSettings, {\r\n        forbidUnknownValues: true,\r\n        whitelist: true\r\n    })\r\n\r\n    if (errors.length > 0) {\r\n        throw new ValidationException(errors)\r\n    }\r\n\r\n\r\n    await this.readerSettingsRepository.put(readerSettings)     \r\n  }\r\n\r\n\r\n  async updateCurrentPage(tokenId:number) {\r\n\r\n    let readerSettings = await this.get()\r\n\r\n    readerSettings.currentPage = tokenId\r\n    await this.put(readerSettings)\r\n\r\n  }\r\n}\r\n\r\n\r\nexport { ReaderSettingsService }\r\n\r\n","\r\nclass ERCEvent {\r\n    \r\n    _id?:string\r\n    _rev?:string \r\n    removed?:boolean \r\n    address?:string \r\n    data?:string \r\n    topics?:string[] \r\n    logIndex?:number \r\n    args:any[]\r\n    event?:string \r\n    eventSignature?:string\r\n    isTransfer:boolean\r\n    isMint:boolean\r\n    isBurn:boolean\r\n    namedArgs:any  \r\n    lastUpdated?:string \r\n    dateCreated?:string\r\n\r\n}\r\n\r\nexport {\r\n    ERCEvent\r\n}","import { inject, injectable } from \"inversify\"\r\n\r\nimport { ERCEvent } from \"../../sync/dto/erc-event.js\"\r\n\r\n\r\n@injectable()\r\nclass ERCEventService {\r\n\r\n    constructor() {}\r\n\r\n    async translateEventToERCEvent(event: any) : Promise<ERCEvent> {\r\n\r\n        let ercEvent = new ERCEvent()\r\n    \r\n        ercEvent.removed = event.removed\r\n        ercEvent.address = event.address\r\n        ercEvent.data = event.data\r\n        ercEvent.topics = event.topics\r\n        ercEvent.logIndex = event.index\r\n        ercEvent.event = event.fragment?.name\r\n        ercEvent.eventSignature = event.eventSignature\r\n        ercEvent.dateCreated = new Date().toJSON()\r\n    \r\n        //Convert BigInt args to strings    \r\n        ercEvent.args = event.args?.map(a => a.toString())\r\n\r\n        ercEvent.namedArgs = {}\r\n\r\n        //Check wether it's a transfer and if it's newer than the most recently recorded transfer\r\n        switch(ercEvent.event) {\r\n                                       \r\n            case \"Transfer\":\r\n                ercEvent.isTransfer = true\r\n                ercEvent.namedArgs.fromAddress = ercEvent.args[0]\r\n                ercEvent.namedArgs.toAddress = ercEvent.args[1]\r\n                ercEvent.namedArgs.tokenId = ercEvent.args[2]\r\n                break\r\n            case \"Approval\":\r\n                ercEvent.namedArgs.owner = ercEvent.args[0]\r\n                ercEvent.namedArgs.approved = ercEvent.args[1]\r\n                ercEvent.namedArgs.tokenId = ercEvent.args[2]\r\n                break\r\n            case \"ApprovalForAll\":\r\n                ercEvent.namedArgs.owner = ercEvent.args[0]\r\n                ercEvent.namedArgs.operator = ercEvent.args[1]\r\n                ercEvent.namedArgs.approved = ercEvent.args[2]\r\n                break\r\n        }\r\n    \r\n\r\n        if (ercEvent.isTransfer && ercEvent.namedArgs?.fromAddress == \"0x0000000000000000000000000000000000000000\") {\r\n            ercEvent.isMint = true\r\n        }\r\n\r\n        if (ercEvent.isTransfer && ercEvent.namedArgs?.toAddress == \"0x0000000000000000000000000000000000000000\") {\r\n            ercEvent.isBurn = true\r\n        }\r\n\r\n    \r\n        // ercEvent._id = `${ercEvent.blockHash}-${ercEvent.transactionHash}-${ercEvent.logIndex}`\r\n\r\n        return ercEvent\r\n    }\r\n\r\n\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\nexport {\r\n    ERCEventService\r\n}\r\n\r\n","import { validate, ValidationError } from \"class-validator\";\r\nimport { inject, injectable } from \"inversify\";\r\nimport { ComponentState } from \"../../dto/component-state.js\";\r\nimport { ComponentStateRepository } from \"../../repository/component-state-repository.js\";\r\nimport { ValidationException } from \"../../util/validation-exception.js\";\r\n\r\n@injectable()\r\nclass ComponentStateService {\r\n\r\n    @inject(\"ComponentStateRepository\")\r\n    private componentStateRepository:ComponentStateRepository\r\n\r\n    constructor(\r\n    ) {}\r\n\r\n    async get(_id:string) {\r\n        return this.componentStateRepository.get(_id)\r\n    }\r\n\r\n\r\n    async put(componentState:ComponentState) {\r\n\r\n        if (!componentState.dateCreated) {\r\n            componentState.dateCreated = new Date().toJSON()\r\n        }\r\n\r\n        componentState.lastUpdated = new Date().toJSON()\r\n\r\n        //Validate\r\n        let errors: ValidationError[] = await validate(componentState, {\r\n            forbidUnknownValues: true,\r\n            whitelist: true\r\n        })\r\n\r\n        if (errors.length > 0) {\r\n            throw new ValidationException(errors)\r\n        }\r\n\r\n        return this.componentStateRepository.put(componentState)\r\n\r\n\r\n    }\r\n\r\n\r\n\r\n}\r\n\r\n\r\nexport {\r\n    ComponentStateService\r\n}","import { Allow } from \"class-validator\"\r\n\r\nclass ComponentState {\r\n\r\n    @Allow()\r\n    _id?:string\r\n\r\n    @Allow()\r\n    _rev?:string \r\n    \r\n    @Allow()\r\n    data:any\r\n\r\n    @Allow()\r\n    dateCreated?:string\r\n\r\n    @Allow()\r\n    lastUpdated?:string\r\n}\r\n\r\nexport {\r\n    ComponentState\r\n}\r\n","import {  inject, injectable } from \"inversify\"\r\nimport { ComponentState } from \"../../dto/component-state.js\"\r\nimport {  DatabaseService } from \"../../service/core/database-service.js\"\r\nimport { ComponentStateRepository } from \"../component-state-repository.js\"\r\n\r\n\r\n@injectable()\r\nclass ComponentStateRepositoryBrowserImpl implements ComponentStateRepository {\r\n\r\n    db:any\r\n    dbName:string = \"component-state\"\r\n\r\n    @inject('DatabaseService')\r\n    private databaseService: DatabaseService\r\n\r\n    async load() {\r\n        this.db = await this.databaseService.getDatabase({\r\n            name: this.dbName,\r\n            initialRecords: false,\r\n        })\r\n    }\r\n\r\n    constructor() {}\r\n\r\n\r\n    async get(_id:string): Promise<ComponentState> {        \r\n        return Object.assign(new ComponentState(), await this.db.get(_id))\r\n    }\r\n\r\n    async put(componentState:ComponentState) {\r\n        await this.db.put(componentState)\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\nexport {\r\n    ComponentStateRepositoryBrowserImpl\r\n}","import { inject, injectable } from \"inversify\";\nimport { LeaderboardRowViewModel, TokenOwnerPage, TokenOwnerPageTotals } from \"../dto/token-owner-page.js\";\nimport { TokenOwnerPageRepository } from \"../repository/token-owner-page-repository.js\";\n\n\n\n@injectable()\nclass TokenOwnerPageService {\n\n    @inject(\"TokenOwnerPageRepository\")\n    private tokenOwnerPageRepository:TokenOwnerPageRepository\n\n    constructor(\n    ) { }\n\n    async getHome(): Promise<TokenOwnerPage> {\n        return this.tokenOwnerPageRepository.getHome()\n    }\n\n    async get(pageNumber: number): Promise<TokenOwnerPage> {\n        return this.tokenOwnerPageRepository.get(pageNumber)\n    }\n\n    async getTotals(): Promise<TokenOwnerPageTotals> {\n        return this.tokenOwnerPageRepository.getTotals()\n    }\n\n}\n\nexport {\n    TokenOwnerPageService\n}","import axios from \"axios\"\nimport { inject, injectable } from \"inversify\"\nimport { TokenOwnerPageRepository } from \"../../../reader/repository/token-owner-page-repository.js\"\nimport { TokenOwnerPage, TokenOwnerPageTotals } from \"../../dto/token-owner-page.js\"\n\n@injectable()\nclass TokenOwnerPageRepositoryBrowserImpl implements TokenOwnerPageRepository {\n\n    constructor(\n        @inject(\"baseURI\") private baseURI:Function,\n        @inject(\"hostname\") private hostname:Function\n    ) {}\n\n    async getHome(): Promise<TokenOwnerPage> {\n        const response = await axios.get(`${this.hostname()}${this.baseURI()}sync/tokenOwner/pages/home.json`)    \n        return response.data\n    }\n\n    async getTotals(): Promise<TokenOwnerPageTotals> {\n        const response = await axios.get(`${this.hostname()}${this.baseURI()}sync/tokenOwner/pages/total.json`)    \n        return response.data\n    }\n\n    async get(pageNumber: number): Promise<TokenOwnerPage> {   \n\n        const response = await axios.get(`${this.hostname()}${this.baseURI()}sync/tokenOwner/pages/${pageNumber}.json`)\n            \n        return response.data\n    }\n\n}\n\nexport {\n    TokenOwnerPageRepositoryBrowserImpl\n}\n\n\n","import { inject, injectable } from \"inversify\"\r\n\r\n\r\nimport { ItemService } from \"../../reader/service/item-service.js\"\r\nimport { ProcessedEvent, ProcessedTransaction, Sale, SalesReport, AttributeSaleReport, AttributeOverallSales } from \"../dto/processed-transaction.js\"\r\nimport { ProcessedTransactionRepository } from \"../repository/processed-transaction-repository.js\"\r\nimport { RowItemViewModel } from \"../dto/item-page.js\"\r\n\r\n\r\n@injectable()\r\nclass ProcessedTransactionService {\r\n\r\n    @inject(\"ProcessedTransactionRepository\")\r\n    private processedTransactionRepository:ProcessedTransactionRepository\r\n\r\n    @inject(\"ItemService\")\r\n    private itemService:ItemService\r\n\r\n    constructor() {}\r\n\r\n    async get(_id:string) : Promise<TransactionViewModel> {\r\n        return this.processedTransactionRepository.get(_id)\r\n    }\r\n\r\n\r\n    async getRowItemViewModels(processedEvents) {\r\n\r\n        let result = {}\r\n\r\n        let tokenIds = new Set<number>()\r\n\r\n\r\n        for (let processedEvent of processedEvents) {\r\n\r\n            if (!processedEvent.tokenId) continue\r\n            tokenIds.add(processedEvent.tokenId)\r\n        }\r\n\r\n        let rowItemViewModels = await this.itemService.getRowItemViewModelsByTokenIds(Array.from(tokenIds))\r\n\r\n\r\n        for (let rivm of rowItemViewModels) {\r\n            result[rivm.tokenId] = rivm\r\n        }\r\n\r\n        return result\r\n\r\n    }\r\n\r\n    async translateSalesToViewModels(sales:Sale[]) : Promise<SaleViewModel[]> {\r\n\r\n        let viewModels:SaleViewModel[] = []\r\n\r\n        for (let sale of sales) {\r\n            viewModels.push({\r\n                sale: sale,\r\n                item: await this.itemService.getRowItemViewModelsByTokenId(sale.tokenId)\r\n            })\r\n        }\r\n\r\n        return viewModels\r\n    }\r\n\r\n    async getSalesReport(): Promise<SalesReport> {\r\n        return this.processedTransactionRepository.getSalesReport()\r\n    }\r\n\r\n    async getAttributeSalesReport(traitType:string, value:string): Promise<AttributeSaleReport> {\r\n        return this.processedTransactionRepository.getAttributeSalesReport(traitType, value)\r\n    }\r\n    \r\n    async getAttributesOverall(): Promise<AttributeOverallSales> {\r\n        return this.processedTransactionRepository.getAttributesOverall()\r\n    }\r\n    \r\n    async getLargestSales(limit:number) : Promise<Sale[]> {\r\n        return this.processedTransactionRepository.getLargestSales(limit)\r\n    }\r\n\r\n\r\n\r\n}\r\n\r\ninterface TransactionsViewModel {\r\n    lastUpdated?:string\r\n    transactions?:TransactionViewModel[],\r\n    rowItemViewModels?:{}\r\n}\r\n\r\ninterface TransactionValue {\r\n    totalPrice?: number\r\n    usdValue?:number\r\n    currency?: string\r\n    tokenPrice?: any,\r\n    markets?: any\r\n    aggregator?:string\r\n    tokenIds?: number[]\r\n}\r\n\r\n\r\ninterface ProcessedTransactionViewModel {\r\n    _id?:string\r\n    _rev?:string \r\n    blockNumber?:number\r\n    transactionIndex?:number\r\n    transactionFrom?:string\r\n    tokenTraders?:string[]\r\n    timestamp?:number\r\n    tokenIds?:number[]\r\n    transactionValue?:TransactionValue\r\n    previousId?:string\r\n}\r\n\r\ninterface ProcessedEventViewModel {\r\n    isMint: boolean\r\n    isBurn: boolean\r\n    namedArgs: any\r\n    tokenId: number\r\n    fromAddress: string\r\n    toAddress: string\r\n    price: number\r\n    currency: string\r\n    usdValue: number\r\n    event: string\r\n}\r\n\r\ninterface TransactionViewModel {\r\n    transaction?:ProcessedTransactionViewModel\r\n    events?:ProcessedEventViewModel[]\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\ninterface SaleViewModel {\r\n    sale:Sale\r\n    item:RowItemViewModel\r\n}\r\n\r\n\r\nexport {\r\n    ProcessedTransactionService, TransactionsViewModel, SaleViewModel, TransactionViewModel\r\n}\r\n\r\n","import axios from \"axios\";\nimport { inject, injectable } from \"inversify\";\nimport { AttributeOverallSales, AttributeSaleReport, SalesReport } from \"../../dto/processed-transaction.js\";\n\n\nimport { ProcessedTransactionService, SaleViewModel, TransactionsViewModel } from \"../processed-transaction-service.js\";\n\n\n@injectable()\nclass TransactionWebService {\n\n    \n    @inject(\"ProcessedTransactionService\")\n    private processedTransactionService:ProcessedTransactionService\n\n\n    constructor(\n        @inject(\"baseURI\") private baseURI:Function\n    ) {}\n\n    async getHomeViewModel() {\n\n        let result = await axios.get(`${this.baseURI()}sync/home.json`, {\n            // query URL without using browser cache\n            headers: {\n              'Cache-Control': 'no-cache',\n              'Pragma': 'no-cache',\n              'Expires': '0',\n            },\n        })\n\n        return result.data\n    }\n\n\n    async list(page?:number) : Promise<TransactionsViewModel> {\n\n        let latest = await this.getLatest()\n\n\n        let result = await axios.get(`${this.baseURI()}sync/transactions/activity/${page}.json`)\n\n        let transactionsViewModel = result.data\n\n        transactionsViewModel.lastUpdated = latest.lastUpdated\n\n        return transactionsViewModel\n\n    }\n\n\n    async listByAddress(address:string, page:number) : Promise<TransactionsViewModel> {\n        \n        let result = await axios.get(`${this.baseURI()}sync/tokenOwner/${address}/activity/${page}.json`)\n\n        let transactionsViewModel = result.data\n\n        let latest = await this.getLatest()\n        transactionsViewModel.lastUpdated = latest.lastUpdated\n\n        return transactionsViewModel\n\n    }\n\n\n    async getLatest() {\n        let result = await axios.get(`${this.baseURI()}sync/transactions/latest.json`, {\n            // query URL without using browser cache\n            headers: {\n              'Cache-Control': 'no-cache',\n              'Pragma': 'no-cache',\n              'Expires': '0',\n            },\n          })\n        return result.data\n    }\n\n    async getRecentActivity() : Promise<TransactionsViewModel> {\n\n        let result = await axios.get(`${this.baseURI()}sync/transactions/recentActivity.json`, {\n            // query URL without using browser cache\n            headers: {\n              'Cache-Control': 'no-cache',\n              'Pragma': 'no-cache',\n              'Expires': '0',\n            },\n          })\n\n        let transactionsViewModel:TransactionsViewModel = result.data\n\n\n        return transactionsViewModel\n\n    }\n\n\n    async getSalesReport(): Promise<SalesReport> {\n        return this.processedTransactionService.getSalesReport()\n    }\n\n    async getAttributeSalesReport(traitType:string, value:string): Promise<AttributeSaleReport> {\n        return this.processedTransactionService.getAttributeSalesReport(traitType, value)\n    }\n\n    async getAttributesOverall(): Promise<AttributeOverallSales> {\n        return this.processedTransactionService.getAttributesOverall()\n    }\n\n\n    async getLargestSales(limit:number) {\n\n        let sales = await  this.processedTransactionService.getLargestSales(limit)\n\n        return sales\n\n    }\n\n    abbreviateDollars(number, digits) {\n\n        if (!number) return \"$0\"\n\n        var SI_SYMBOL = [\"\", \"\", \"M\", \"G\", \"T\", \"P\", \"E\"]\n\n\n        // what tier? (determines SI symbol)\n        var tier = Math.log10(Math.abs(number)) / 3 | 0\n\n        // if zero or thousands, we don't need a suffix\n        if(tier == 0 || tier == 1) {\n          let result = new Intl.NumberFormat('en-US', { currency: \"USD\", style:\"currency\" }).format(number)\n          return result\n        }\n\n        // get suffix and determine scale\n        var suffix = SI_SYMBOL[tier]\n        var scale = Math.pow(10, tier * 3)\n\n        // scale the number\n        var scaled = number / scale\n\n        // format number and add suffix\n        return new Intl.NumberFormat('en-US', { currency: \"USD\", style:\"currency\" }).format(scaled) + suffix\n    }\n\n\n}\n\ninterface LatestTransactionInfo {\n    _id: string\n    lastUpdated:string\n}\n\n\n\nexport {\n    TransactionWebService\n}","import axios from \"axios\"\r\nimport {  inject, injectable } from \"inversify\"\r\nimport { AttributeOverallSales, AttributeSaleReport, ProcessedTransaction, Sale, SalesReport } from \"../../dto/processed-transaction.js\"\r\nimport { TransactionsViewModel, TransactionViewModel } from \"../../service/processed-transaction-service.js\"\r\nimport { ProcessedTransactionRepository } from \"../processed-transaction-repository.js\"\r\n\r\n\r\n\r\n@injectable()\r\nclass ProcessedTransactionRepositoryBrowserImpl implements ProcessedTransactionRepository {\r\n\r\n\r\n\r\n    @inject('baseURI') \r\n    private baseURI:Function\r\n\r\n    async get(_id: string): Promise<TransactionViewModel> {\r\n\r\n        let processedTransaction\r\n    \r\n\r\n        try {\r\n            //Download it.\r\n            let result = await axios.get(`${this.baseURI()}sync/transactions/${_id}.json`)\r\n            processedTransaction = result.data\r\n\r\n        } catch(ex) {\r\n            console.log(ex)\r\n        }\r\n\r\n        return processedTransaction\r\n\r\n\r\n    }\r\n\r\n    async getSalesReport(): Promise<SalesReport> {\r\n\r\n        let salesReport\r\n    \r\n        try {\r\n            //Download it.\r\n            let result = await axios.get(`${this.baseURI()}sync/sales/overall.json`)\r\n            salesReport = result.data\r\n\r\n        } catch(ex) {\r\n            console.log(ex)\r\n        }\r\n\r\n        return salesReport\r\n\r\n    }\r\n\r\n    async getAttributeSalesReport(traitType:string, value:string): Promise<AttributeSaleReport> {\r\n\r\n        let attributeSalesReport\r\n    \r\n        try {\r\n            //Download it.\r\n            let result = await axios.get(`${this.baseURI()}sync/attributes/${this.attributeKeyToInteger(`${traitType}::::${value}`)}/attribute.json`)\r\n            attributeSalesReport = result.data\r\n\r\n        } catch(ex) {\r\n            console.log(ex)\r\n        }\r\n\r\n        return attributeSalesReport\r\n    }\r\n\r\n    async getAttributesOverall(): Promise<AttributeOverallSales> {\r\n\r\n        let attributeOverallSales\r\n    \r\n        try {\r\n            //Download it.\r\n            let result = await axios.get(`${this.baseURI()}sync/attributes/totals.json`)\r\n            attributeOverallSales = result.data\r\n\r\n        } catch(ex) {\r\n            console.log(ex)\r\n        }\r\n\r\n        return attributeOverallSales\r\n\r\n    }\r\n\r\n    private attributeKeyToInteger(key:string) {\r\n\r\n        let hash = 0, i, chr\r\n  \r\n        if (key.length === 0) return hash\r\n  \r\n        for (i = 0; i < key.length; i++) {\r\n  \r\n          chr = key.charCodeAt(i)\r\n          hash = ((hash << 5) - hash) + chr\r\n          hash |= 0 // Convert to 32bit integer\r\n        }\r\n        \r\n        return hash\r\n    }\r\n\r\n    async getLargestSales(limit:number): Promise<Sale[]> {\r\n\r\n        let largestSales\r\n    \r\n        try {\r\n            //Download it.\r\n            let result = await axios.get(`${this.baseURI()}sync/sales/largest-${limit}.json`)\r\n            largestSales = result.data\r\n\r\n        } catch(ex) {\r\n            console.log(ex)\r\n        }\r\n\r\n        return largestSales\r\n    }\r\n\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\nexport {\r\n    ProcessedTransactionRepositoryBrowserImpl\r\n}","\r\nclass TokenOwner {\r\n    \r\n    declare _id?:string\r\n    declare _rev?:string \r\n    declare count?:number\r\n    declare rank?:number\r\n    declare overallRank?:number\r\n    declare tokenIds?:number[]\r\n    declare latestTransactionInitiatorId?:string\r\n    declare latestTransactionId?:string\r\n    declare ensName?:string\r\n    declare lastActive?:string \r\n    declare lastUpdated?:string \r\n    declare dateCreated?:string\r\n\r\n}\r\n\r\nexport {\r\n    TokenOwner\r\n}","import { inject, injectable } from \"inversify\"\r\n\r\nimport { WalletService } from \"../../reader/service/core/wallet-service.js\"\r\nimport { TokenOwner } from \"../dto/token-owner.js\"\r\nimport { TokenOwnerRepository } from \"../repository/token-owner-repository.js\"\r\n\r\n@injectable()\r\nclass TokenOwnerService {\r\n\r\n    @inject(\"WalletService\")\r\n    private walletService:WalletService\r\n\r\n    @inject(\"TokenOwnerRepository\")\r\n    private tokenOwnerRepository:TokenOwnerRepository\r\n\r\n    constructor() {}\r\n\r\n\r\n    async get(_id:string): Promise<TokenOwner> {        \r\n        return this.tokenOwnerRepository.get(_id)\r\n    }\r\n\r\n    async getDisplayName(_id:string) : Promise<string> {\r\n\r\n        if (!_id) return\r\n\r\n        let ens = await this.tokenOwnerRepository.getENS(_id)\r\n\r\n        if (ens) return ens\r\n        return this.walletService.truncateEthAddress(_id)\r\n\r\n    }\r\n\r\n    async getOrCreate(address:string) {\r\n\r\n        let tokenOwner: TokenOwner \r\n\r\n        if (!tokenOwner) {\r\n            try {\r\n                tokenOwner = await this.get(address)\r\n            } catch (ex) { }\r\n        }\r\n\r\n        if (!tokenOwner) {\r\n            tokenOwner = new TokenOwner()\r\n            tokenOwner._id = address\r\n            tokenOwner.tokenIds = []\r\n            tokenOwner.count = 0\r\n        }\r\n\r\n        return tokenOwner\r\n\r\n    }\r\n\r\n\r\n    async put(tokenOwner:TokenOwner) {\r\n        return this.tokenOwnerRepository.put(tokenOwner)\r\n    }\r\n\r\n    /**\r\n     * No validation for speeeeeeeeed\r\n     * @param tokenOwners \r\n     * @returns \r\n     */\r\n     async putAll(tokenOwners:TokenOwner[]) {\r\n\r\n        //Update lastUpdated\r\n        tokenOwners.forEach(tokenOwner => {\r\n\r\n            if (!tokenOwner._id) {\r\n                tokenOwner.dateCreated = new Date().toJSON()\r\n            } \r\n    \r\n\r\n            tokenOwner.lastUpdated = new Date().toJSON()\r\n        })\r\n\r\n        return this.tokenOwnerRepository.putAll(tokenOwners)\r\n    }\r\n\r\n\r\n    async list(limit: number, skip: number): Promise<TokenOwner[]> {\r\n        return this.tokenOwnerRepository.list(limit, skip)\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n}\r\n\r\n\r\nexport {\r\n    TokenOwnerService\r\n}\r\n\r\n","import { Changeset } from \"../../reader/service/core/database-service.js\"\nimport { TokenOwner } from \"../dto/token-owner.js\"\n\n\ninterface TokenOwnerRepository {\n    get(_id:string): Promise<TokenOwner>\n    put(tokenOwner:TokenOwner) : Promise<TokenOwner>\n    putAll(tokenOwners:TokenOwner[]) : Promise<void>\n    getENS(_id:string) : Promise<string>\n    list(limit: number, skip: number): Promise<TokenOwner[]> \n\n}\n\n\nlet changesets:Changeset[] = [\n    {\n        id: '0',\n        changeset: async (db) => {\n\n            await db.createIndex({\n                index: {\n                    fields: ['count']\n                }\n            })\n\n            await db.put({\n                _id: '_design/by_token_id',\n                views: {\n                    by_token_id: {\n                            map: function (doc) { \n                          \n                                for (let tokenId of doc.tokenIds) {\n                                    //@ts-ignore\n                                    emit(tokenId)\n                                }\n\n                            }.toString(),\n                    }\n                }\n            })\n\n        }\n    }\n]\n\n\nexport {\n    TokenOwnerRepository, changesets\n}\n","import axios from \"axios\"\r\nimport {  inject, injectable } from \"inversify\"\r\nimport { TokenOwner } from \"../../dto/token-owner.js\"\r\nimport { DatabaseService } from \"../../../reader/service/core/database-service.js\"\r\nimport { changesets, TokenOwnerRepository } from \"../token-owner-repository.js\"\r\n\r\n\r\n@injectable()\r\nclass TokenOwnerRepositoryBrowserImpl implements TokenOwnerRepository {\r\n  \r\n    db:any\r\n    dbName:string = \"token-owners\"\r\n\r\n    @inject('DatabaseService')\r\n    private databaseService:DatabaseService\r\n\r\n    @inject('baseURI') \r\n    private baseURI:Function\r\n\r\n\r\n    async load() {\r\n        this.db = await this.databaseService.getDatabase({\r\n            name: this.dbName,\r\n            initialRecords: false,\r\n            changesets: changesets\r\n        })\r\n    }\r\n\r\n    constructor() {}\r\n\r\n    async getENS(_id: string): Promise<string> {\r\n\r\n        let name\r\n\r\n        try {\r\n            //Download it.\r\n            let result:any = await axios.get(`${this.baseURI()}sync/tokenOwner/${_id}/ens.json`)\r\n            name = result.data?.name\r\n        } catch(ex) {}\r\n\r\n        return name\r\n    }\r\n\r\n\r\n    async get(_id:string): Promise<TokenOwner> {    \r\n        \r\n        try {\r\n            //Download it.\r\n            let result = await axios.get(`${this.baseURI()}sync/tokenOwner/${_id}/tokenOwner.json`)\r\n            return Object.assign(new TokenOwner(), result.data)\r\n        } catch(ex) {\r\n            console.log(ex)\r\n        }\r\n\r\n    }\r\n\r\n    async put(tokenOwner:TokenOwner) : Promise<TokenOwner> {\r\n        return\r\n    }\r\n\r\n    async putAll(tokenOwners:TokenOwner[]) : Promise<void> {\r\n        return\r\n    }\r\n\r\n    async list(limit: number, skip: number): Promise<TokenOwner[]> {\r\n        return\r\n    }\r\n\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\nexport {\r\n    TokenOwnerRepositoryBrowserImpl\r\n}","import { inject, injectable } from \"inversify\"\r\nimport { Token } from \"../dto/token.js\"\r\nimport { TokenRepository } from \"../repository/token-repository.js\"\r\n\r\n@injectable()\r\nclass TokenService {\r\n\r\n    @inject(\"TokenRepository\")\r\n    private tokenRepository:TokenRepository\r\n\r\n    constructor() {}\r\n\r\n\r\n    async get(_id:string): Promise<Token> {        \r\n        return this.tokenRepository.get(_id)\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\nexport {\r\n    TokenService\r\n}\r\n\r\n","import { inject, injectable } from \"inversify\"\r\nimport { RowItemViewModel } from \"../../dto/item-page.js\"\r\nimport { Item } from \"../../dto/item.js\"\r\nimport { Changeset, DatabaseService } from \"../../service/core/database-service.js\"\r\nimport { RowItemViewModelRepository } from \"../row-item-view-model-repository.js\"\r\n\r\n\r\n\r\n\r\n@injectable()\r\nclass RowItemViewModelRepositoryBrowserImpl implements RowItemViewModelRepository {\r\n\r\n\r\n    changesets:Changeset[] = [\r\n        {\r\n            id: '0',\r\n            changeset: async (db) => {\r\n\r\n                await db.createIndex({\r\n                    index: {\r\n                        fields: ['tokenId']\r\n                    }\r\n                })\r\n                        \r\n            }\r\n        }\r\n    ]\r\n\r\n\r\n    db:any\r\n    dbName:string = \"row-item-view-models\"\r\n    \r\n    @inject('DatabaseService')\r\n    private databaseService: DatabaseService\r\n    \r\n    constructor() {}\r\n\r\n    async load() {\r\n        this.db = await this.databaseService.getDatabase({\r\n            name: this.dbName,\r\n            initialRecords: true,\r\n            initialRecordsPath: \"t/all.json\",\r\n            changesets: this.changesets\r\n        })\r\n    }\r\n\r\n\r\n    async get(_id: string): Promise<RowItemViewModel> {\r\n        return this.db.get(_id)\r\n    }\r\n    \r\n\r\n\r\n    async put(item: Item) {\r\n        await this.db.put(item)\r\n    }\r\n\r\n\r\n\r\n    async getByTokenIds(ids:number[]) : Promise<RowItemViewModel[]> {\r\n\r\n        let response = await this.db.find({\r\n            selector: {\r\n                tokenId: { $in: ids },\r\n            }\r\n        })\r\n\r\n        if (response.docs?.length > 0) {\r\n            return response.docs\r\n        } else {\r\n            return []\r\n        }\r\n    }\r\n\r\n\r\n\r\n    \r\n}\r\n\r\nexport {\r\n    RowItemViewModelRepositoryBrowserImpl\r\n}\r\n\r\n\r\n","import { Container } from \"inversify\";\r\n\r\nimport Framework7 from 'framework7';\r\nimport axios from \"axios\"\r\nimport he from 'he'\r\n\r\nimport { BrowserProvider } from \"ethers\"\r\n\r\nimport PouchDB from 'pouchdb-browser';\r\nimport PouchFind from 'pouchdb-find'\r\n// import PouchQuickSearch from 'pouchdb-quick-search'\r\n\r\n//Enable find plugin\r\nPouchDB.plugin(PouchFind)\r\n\r\n//Enable quicksearch\r\n// PouchDB.plugin(PouchQuickSearch)\r\n\r\nimport dayjs from \"dayjs\"\r\nimport relativeTime from 'dayjs/plugin/relativeTime.js'\r\ndayjs.extend(relativeTime)\r\n\r\nimport localizedFormat from 'dayjs/plugin/localizedFormat.js'\r\ndayjs.extend(localizedFormat)\r\n\r\n\r\n//Import CSS\r\nimport 'framework7/css/bundle'\r\nimport 'framework7-icons/css/framework7-icons.css'\r\nimport './html/css/app.css'\r\n\r\n\r\n// Import additional components\r\nimport Dialog from 'framework7/components/dialog'\r\nimport Toast from 'framework7/components/toast'\r\nimport Preloader from 'framework7/components/preloader'\r\nimport VirtualList from 'framework7/components/virtual-list'\r\nimport ListIndex from 'framework7/components/list-index'\r\nimport Range from 'framework7/components/range'\r\nimport Accordion from 'framework7/components/accordion'\r\nimport InfiniteScroll from 'framework7/components/infinite-scroll'\r\nimport Card from 'framework7/components/card'\r\nimport Chip from 'framework7/components/chip'\r\nimport Form from 'framework7/components/form'\r\nimport Grid from 'framework7/components/grid'\r\nimport Popup from 'framework7/components/popup'\r\nimport Popover from 'framework7/components/popover'\r\nimport Stepper from 'framework7/components/stepper'\r\n\r\n\r\n\r\n// Install F7 Components using .use() method on Framework7 class:\r\nFramework7.use([Dialog, Toast, Preloader, VirtualList, ListIndex, Card, Chip, Form, Grid, \r\n  Range, Accordion, Popup, InfiniteScroll, Popover, Stepper])\r\n\r\n\r\n\r\nimport Navbar from './components/reader/navbar.f7.html'\r\n\r\nimport TokenToolbar from './components/reader/token-toolbar.f7.html'\r\nimport Transaction from './components/reader/transaction.f7.html'\r\n\r\n// import NftInfo from './components/reader/item/nft-info.f7.html'\r\nimport MintList from './components/reader/item/mint-list.f7.html'\r\n\r\nimport AttributeFilter from './components/reader/channel/attribute-filter.f7.html'\r\nimport ExploreTotalInfo from './components/reader/channel/explore-total-info.f7.html'\r\n\r\nimport MintInfo from './components/reader/channel/mint-info.f7.html'\r\nimport LargestSales from './components/reader/channel/largest-sales.f7.html'\r\n\r\nimport TransactionRow from './components/reader/channel/transaction-row.f7.html'\r\nimport LeaderboardRows from './components/reader/channel/leaderboard-rows.f7.html'\r\n\r\n\r\n\r\nimport SearchList from './components/reader/item/search-list.f7.html'\r\nimport InfiniteScrollContent from './components/reader/item/infinite-scroll-content.f7.html'\r\n\r\n\r\nimport { WalletService } from \"./service/core/wallet-service.js\";\r\nimport { WalletServiceImpl } from \"./service/core/wallet-service-impl.js\";\r\nimport { ChannelRepository } from \"./repository/channel-repository.js\";\r\nimport { TokenRepository } from \"./repository/token-repository.js\";\r\n\r\nimport { ItemRepository } from \"./repository/item-repository.js\";\r\nimport { AuthorRepository } from \"./repository/author-repository.js\";\r\nimport { MetadataRepository } from \"./repository/metadata-repository.js\";\r\nimport { ImageRepository } from \"./repository/image-repository.js\";\r\nimport { AnimationRepository } from \"./repository/animation-repository.js\";\r\nimport { StaticPageRepository } from \"./repository/static-page-repository.js\";\r\nimport { ItemPageRepository } from \"./repository/item-page-repository.js\";\r\nimport { AttributeTotalRepository } from \"./repository/attribute-total-repository.js\";\r\nimport { ReaderSettingsRepository } from \"./repository/reader-settings-repository.js\";\r\nimport { ChannelRepositoryBrowserImpl } from \"./repository/browser/channel-repository-impl.js\";\r\nimport { ItemRepositoryBrowserImpl } from \"./repository/browser/item-repository-impl.js\";\r\nimport { AuthorRepositoryBrowserImpl } from \"./repository/browser/author-repository-impl.js\";\r\nimport { MetadataRepositoryBrowserImpl } from \"./repository/browser/metadata-repository-impl.js\";\r\nimport { ImageRepositoryBrowserImpl } from \"./repository/browser/image-repository-impl.js\";\r\nimport { AnimationRepositoryBrowserImpl } from \"./repository/browser/animation-repository-impl.js\";\r\nimport { StaticPageRepositoryBrowserImpl } from \"./repository/browser/static-page-repository-impl.js\";\r\nimport { ItemPageRepositoryBrowserImpl } from \"./repository/browser/item-page-repository-impl.js\";\r\nimport { AttributeTotalRepositoryBrowserImpl } from \"./repository/browser/attribute-total-repository-impl.js\";\r\nimport { ReaderSettingsRepositoryBrowserImpl } from \"./repository/browser/reader-settings-repository-impl.js\";\r\nimport { TokenRepositoryBrowserImpl } from \"./repository/browser/token-repository-impl.js\";\r\n\r\nimport { ChannelWebService } from \"./service/web/channel-web-service.js\";\r\nimport { ItemWebService } from \"./service/web/item-web-service.js\";\r\nimport { AuthorWebService } from \"./service/web/author-web-service.js\";\r\nimport { MintWebService } from \"./service/web/mint-web-service.js\";\r\nimport { StaticPageService } from \"./service/static-page-service.js\";\r\nimport { ItemPageService } from \"./service/item-page-service.js\";\r\nimport { QueueService } from \"./service/core/queue-service.js\";\r\nimport { PagingService } from \"./service/core/paging-service.js\";\r\nimport { DatabaseService } from \"./service/core/database-service.js\";\r\nimport { AnimationService } from \"./service/animation-service.js\";\r\nimport { UiService } from \"./service/core/ui-service.js\";\r\nimport { ItemService } from \"./service/item-service.js\";\r\nimport { ImageService } from \"./service/image-service.js\";\r\nimport { ChannelService } from \"./service/channel-service.js\";\r\nimport { AuthorService } from \"./service/author-service.js\";\r\nimport { TokenContractService } from \"./service/token-contract-service.js\";\r\nimport { SchemaService } from \"./service/core/schema-service.js\";\r\nimport { QuillService } from \"./service/core/quill-service.js\";\r\nimport { ReaderSettingsService } from \"./service/reader-settings-service.js\";\r\n\r\n\r\nimport { ERCEventService } from \"./service/erc-event-service.js\";\r\nimport { AttributeTotalService } from \"./service/attribute-total-service.js\"; \r\nimport { ComponentStateService } from \"./service/core/component-state-service.js\";\r\nimport { ComponentStateRepository } from \"./repository/component-state-repository.js\";\r\nimport { ComponentStateRepositoryBrowserImpl } from \"./repository/browser/component-state-repository-impl.js\";\r\nimport { ComponentState } from \"./dto/component-state.js\";\r\n\r\n\r\nimport { TokenOwnerPageService } from \"./service/token-owner-page-service.js\";\r\nimport { TokenOwnerPageRepository } from \"./repository/token-owner-page-repository.js\";\r\nimport { TokenOwnerPageRepositoryBrowserImpl } from \"./repository/browser/token-owner-page-repository-impl.js\";\r\n\r\n\r\nimport { TransactionWebService } from \"./service/web/transaction-web-service.js\";\r\nimport { ProcessedTransactionService } from \"./service/processed-transaction-service.js\";\r\nimport { ProcessedTransactionRepository } from \"./repository/processed-transaction-repository.js\";\r\nimport { ProcessedTransactionRepositoryBrowserImpl } from \"./repository/browser/processed-transaction-repository-impl.js\";\r\nimport { TokenOwnerService } from \"./service/token-owner-service.js\";\r\nimport { TokenOwnerRepositoryBrowserImpl } from \"./repository/browser/token-owner-repository-impl.js\";\r\nimport { TokenOwnerRepository } from \"./repository/token-owner-repository.js\";\r\nimport { ContractStateRepository } from \"../sync/repository/contract-state-repository.js\";\r\nimport { TokenService } from \"./service/token-service.js\";\r\nimport { RowItemViewModelRepositoryBrowserImpl } from \"./repository/browser/row-item-view-model-repository-impl.js\";\r\nimport { RowItemViewModelRepository } from \"./repository/row-item-view-model-repository.js\";\r\n\r\n\r\n\r\nlet container: Container\r\n\r\n\r\nasync function getMainContainer(customContainer:Container, theBaseURI:string, theHostname:string, version:string, routes:any[], channelId:string) {\r\n\r\n  if (container) return container\r\n\r\n  container = customContainer\r\n  \r\n  globalThis.baseURI = theBaseURI\r\n  globalThis.hostname = theHostname\r\n  globalThis.channelId = channelId\r\n\r\n  function framework7() {\r\n\r\n    Framework7.registerComponent(\"nav-bar\", Navbar)\r\n\r\n    Framework7.registerComponent(\"token-toolbar\", TokenToolbar)\r\n\r\n    // Framework7.registerComponent(\"nft-info\", NftInfo)\r\n    Framework7.registerComponent(\"mint-list\", MintList)\r\n    Framework7.registerComponent(\"attribute-filter\", AttributeFilter)\r\n    Framework7.registerComponent(\"explore-total-info\", ExploreTotalInfo)\r\n\r\n    Framework7.registerComponent(\"mint-info\", MintInfo)\r\n    Framework7.registerComponent(\"largest-sales\", LargestSales)\r\n\r\n\r\n    Framework7.registerComponent(\"transaction-viewer\", Transaction)\r\n    Framework7.registerComponent(\"transaction-row\", TransactionRow)\r\n\r\n    Framework7.registerComponent(\"leaderboard-rows\", LeaderboardRows)\r\n\r\n\r\n    Framework7.registerComponent(\"search-list\", SearchList)\r\n    Framework7.registerComponent(\"infinite-scroll-content\", InfiniteScrollContent)\r\n\r\n    \r\n\r\n    globalThis.app = new Framework7({\r\n      el: '#app', // App root element\r\n      id: 'large-reader', // App bundle ID\r\n      name: 'Large Reader', // App name\r\n      theme: 'auto', // Automatic theme detection\r\n      init: false,\r\n      \r\n      view: {\r\n        browserHistory: true,\r\n        browserHistorySeparator: \"\",\r\n        browserHistoryOnLoad: false,\r\n        browserHistoryInitialMatch: false\r\n      },\r\n      \r\n      navbar: {\r\n        hideOnPageScroll: true\r\n      },\r\n\r\n      // subnavbar: {\r\n      //   hideOnPageScroll: true\r\n      // },\r\n\r\n      toolbar: {\r\n        hideOnPageScroll: true\r\n      },\r\n\r\n      routes: routes\r\n    })\r\n\r\n    return globalThis.app\r\n  }\r\n\r\n  container.bind(\"framework7\").toConstantValue(framework7())\r\n\r\n  container.bind(\"version\").toConstantValue(version)\r\n\r\n  container.bind(\"PouchDB\").toConstantValue(async () => {\r\n    return PouchDB\r\n  })\r\n\r\n\r\n  container.bind(\"provider\").toConstantValue(async () => {\r\n\r\n    if (typeof window !== \"undefined\" && window['ethereum']) {\r\n\r\n      //@ts-ignore\r\n      window.web3Provider = window.ethereum\r\n\r\n      return new BrowserProvider(window['ethereum'])\r\n\r\n    }\r\n\r\n  })\r\n\r\n\r\n  container.bind(\"contracts\").toConstantValue(async () => {\r\n\r\n    let contract\r\n    let contractABI\r\n\r\n\r\n    let contractResponse = await axios.get(`${globalThis.hostname}${globalThis.baseURI}backup/contract/contract.json`, { responseType: 'json'})\r\n    let contractABIResponse = await axios.get(`${globalThis.hostname}${globalThis.baseURI}backup/contract/contract-abi.json`, { responseType: 'json'})\r\n\r\n\r\n    if (contractResponse.status === 200) {\r\n        contract = contractResponse.data\r\n    }\r\n\r\n    if (contractResponse.status === 200) {\r\n        contractABI = contractABIResponse.data\r\n    }\r\n\r\n    if (!contract.contractAddress) return []\r\n\r\n    //Override address\r\n    contractABI['Channel'].address = contract.contractAddress\r\n\r\n    return contractABI\r\n\r\n  })\r\n\r\n  container.bind(\"baseURI\").toConstantValue(() => {\r\n    return globalThis.baseURI\r\n  })\r\n\r\n  container.bind(\"hostname\").toConstantValue(() => {\r\n    return globalThis.hostname\r\n  })\r\n\r\n  container.bind(\"channelId\").toConstantValue(() => {\r\n    return globalThis.channelId\r\n  })\r\n\r\n\r\n  container.bind<WalletService>(\"WalletService\").to(WalletServiceImpl).inSingletonScope()\r\n\r\n  container.bind<ChannelRepository>(\"ChannelRepository\").to(ChannelRepositoryBrowserImpl).inSingletonScope()\r\n  container.bind<ItemRepository>(\"ItemRepository\").to(ItemRepositoryBrowserImpl).inSingletonScope()\r\n  container.bind<AuthorRepository>(\"AuthorRepository\").to(AuthorRepositoryBrowserImpl).inSingletonScope()\r\n  container.bind<MetadataRepository>(\"MetadataRepository\").to(MetadataRepositoryBrowserImpl).inSingletonScope()\r\n  \r\n  container.bind<ImageRepository>(\"ImageRepository\").to(ImageRepositoryBrowserImpl).inSingletonScope()\r\n  container.bind<AnimationRepository>(\"AnimationRepository\").to(AnimationRepositoryBrowserImpl).inSingletonScope()\r\n  container.bind<StaticPageRepository>(\"StaticPageRepository\").to(StaticPageRepositoryBrowserImpl).inSingletonScope()\r\n  container.bind<ItemPageRepository>(\"ItemPageRepository\").to(ItemPageRepositoryBrowserImpl).inSingletonScope()\r\n  container.bind<TokenOwnerPageRepository>(\"TokenOwnerPageRepository\").to(TokenOwnerPageRepositoryBrowserImpl).inSingletonScope()\r\n\r\n  container.bind<AttributeTotalRepository>(\"AttributeTotalRepository\").to(AttributeTotalRepositoryBrowserImpl).inSingletonScope()\r\n  container.bind<ReaderSettingsRepository>(\"ReaderSettingsRepository\").to(ReaderSettingsRepositoryBrowserImpl).inSingletonScope()\r\n\r\n  //@ts-ignore\r\n  container.bind<ContractStateRepository>(\"ContractStateRepository\").to({}).inSingletonScope()\r\n  container.bind<ComponentStateRepository>(\"ComponentStateRepository\").to(ComponentStateRepositoryBrowserImpl).inSingletonScope()\r\n  container.bind<TokenOwnerRepository>(\"TokenOwnerRepository\").to(TokenOwnerRepositoryBrowserImpl).inSingletonScope()\r\n  container.bind<TokenRepository>(\"TokenRepository\").to(TokenRepositoryBrowserImpl).inSingletonScope()\r\n\r\n  container.bind<ProcessedTransactionRepository>(\"ProcessedTransactionRepository\").to(ProcessedTransactionRepositoryBrowserImpl).inSingletonScope()\r\n  container.bind<RowItemViewModelRepository>(\"RowItemViewModelRepository\").to(RowItemViewModelRepositoryBrowserImpl).inSingletonScope()\r\n\r\n\r\n  container.bind<ChannelWebService>(\"ChannelWebService\").to(ChannelWebService).inSingletonScope()\r\n  container.bind<ItemWebService>(\"ItemWebService\").to(ItemWebService).inSingletonScope()\r\n  container.bind<AuthorWebService>(\"AuthorWebService\").to(AuthorWebService).inSingletonScope()\r\n  container.bind<MintWebService>(\"MintWebService\").to(MintWebService).inSingletonScope()\r\n  container.bind<StaticPageService>(\"StaticPageService\").to(StaticPageService).inSingletonScope()\r\n  container.bind<ItemPageService>(\"ItemPageService\").to(ItemPageService).inSingletonScope()\r\n  container.bind<QueueService>(\"QueueService\").to(QueueService).inSingletonScope()\r\n  container.bind<TransactionWebService>(\"TransactionWebService\").to(TransactionWebService).inSingletonScope()\r\n\r\n\r\n  container.bind<PagingService>(\"PagingService\").to(PagingService).inSingletonScope()\r\n  container.bind<DatabaseService>(\"DatabaseService\").to(DatabaseService).inSingletonScope()\r\n  container.bind<AnimationService>(\"AnimationService\").to(AnimationService).inSingletonScope()\r\n\r\n  container.bind<UiService>(\"UiService\").to(UiService).inSingletonScope()\r\n  container.bind<ItemService>(\"ItemService\").to(ItemService).inSingletonScope()\r\n  container.bind<ImageService>(\"ImageService\").to(ImageService).inSingletonScope()\r\n  container.bind<ChannelService>(\"ChannelService\").to(ChannelService).inSingletonScope()\r\n  container.bind<AuthorService>(\"AuthorService\").to(AuthorService).inSingletonScope()\r\n  container.bind<TokenContractService>(\"TokenContractService\").to(TokenContractService).inSingletonScope()\r\n  container.bind<SchemaService>(\"SchemaService\").to(SchemaService).inSingletonScope()\r\n  container.bind<QuillService>(\"QuillService\").to(QuillService).inSingletonScope()\r\n  container.bind<AttributeTotalService>(\"AttributeTotalService\").to(AttributeTotalService).inSingletonScope()\r\n  container.bind<ComponentStateService>(\"ComponentStateService\").to(ComponentStateService).inSingletonScope()\r\n\r\n  container.bind<ReaderSettingsService>(\"ReaderSettingsService\").to(ReaderSettingsService).inSingletonScope()\r\n  container.bind<ERCEventService>(\"ERCEventService\").to(ERCEventService).inSingletonScope()\r\n\r\n  //@ts-ignore\r\n  container.bind(\"GenerateService\").to({}).inSingletonScope()\r\n  container.bind<TokenOwnerService>(\"TokenOwnerService\").to(TokenOwnerService).inSingletonScope()\r\n  container.bind<TokenService>(\"TokenService\").to(TokenService).inSingletonScope()\r\n\r\n  container.bind<TokenOwnerPageService>(\"TokenOwnerPageService\").to(TokenOwnerPageService).inSingletonScope()\r\n\r\n  container.bind<ProcessedTransactionService>(\"ProcessedTransactionService\").to(ProcessedTransactionService).inSingletonScope()\r\n\r\n\r\n  //Attach container to window so we can easily access it from the browser console\r\n  globalThis.container = container\r\n  globalThis.he = he\r\n  globalThis.dayjs = dayjs\r\n  globalThis.ComponentState = ComponentState \r\n\r\n\r\n  return container\r\n}\r\n\r\n\r\n\r\nexport {\r\n  getMainContainer, container\r\n}\r\n\r\n\r\n\r\n\r\n","import { inject, injectable } from \"inversify\";\nimport { HomeRepository } from \"../../repository/home-repository.js\";\nimport { HomeViewModel } from \"../../repository/web/home-repository-impl.js\";\n\n\n@injectable()\nclass HomeWebService {\n\n    constructor() {}\n\n    @inject(\"HomeRepository\")\n    private homeRepository:HomeRepository\n\n    async get() : Promise<HomeViewModel> {\n        return this.homeRepository.get(0)\n    }\n\n    abbreviateDollars(number, digits) {\n\n        if (!number) return \"$0\"\n\n        var SI_SYMBOL = [\"\", \"\", \"M\", \"G\", \"T\", \"P\", \"E\"]\n\n\n        // what tier? (determines SI symbol)\n        var tier = Math.log10(Math.abs(number)) / 3 | 0\n\n        // if zero or thousands, we don't need a suffix\n        if(tier == 0 || tier == 1) {\n          let result = new Intl.NumberFormat('en-US', { currency: \"USD\", style:\"currency\" }).format(number)\n          return result\n        }\n\n        // get suffix and determine scale\n        var suffix = SI_SYMBOL[tier]\n        var scale = Math.pow(10, tier * 3)\n\n        // scale the number\n        var scaled = number / scale\n\n        // format number and add suffix\n        return new Intl.NumberFormat('en-US', { currency: \"USD\", style:\"currency\" }).format(scaled) + suffix\n    }\n\n}\n\n\nexport {\n    HomeWebService\n}","import axios from \"axios\"\nimport { inject, injectable } from \"inversify\"\nimport { HomeRepository } from \"../home-repository.js\"\n\n\n@injectable()\nclass HomeRepositoryBrowserImpl implements HomeRepository {\n\n    constructor(\n        @inject('libraryURL') private libraryURL\n    ) {}\n\n    async get(pageNumber: number): Promise<HomeViewModel> {   \n        const response = await axios.get(`${this.libraryURL}/home.json`)\n            \n        return response.data\n    }\n\n}\n\ninterface HomeViewModel {\n    \n}\n\nexport {\n    HomeRepositoryBrowserImpl, HomeViewModel\n}\n\n\n","class RoutingService {\n\n    static async resolveWithSpinner(resolve, url, options?) {\n\n        if (!globalThis.app) return \n\n        globalThis.app.preloader.show()\n\n        resolve({ \n          componentUrl: url, \n          options: options\n        })\n        \n\n        globalThis.app.preloader.hide()\n\n    }\n\n    static getReaderRoutes (baseURI) {\n\n        const routes = []\n\n        let resolvedBaseURI = `${baseURI}partial/`\n\n\n        //Map the base route without a slash if it's longer than just a slash\n        if (baseURI != \"/\" && baseURI.endsWith(\"/\")) {\n    \n\n          routes.push({\n            path: `${baseURI.substring(0, baseURI.length -1)}`,\n            async async({ resolve, reject, to }) {\n              await RoutingService.resolveWithSpinner(resolve, `${resolvedBaseURI}index.html`)\n\n              // await RoutingService.resolveWithSpinner(resolve, 'index.html')\n            }\n          })\n    \n        }\n    \n        RoutingService.addSharedRoutes(routes, baseURI)\n    \n\n        routes.push({\n          path: '(.*)',\n          //@ts-ignore\n          async async({ resolve, reject, to }) {\n            console.log(`404 error: ${to.path}`)\n            await RoutingService.resolveWithSpinner(resolve, `${resolvedBaseURI}404.html`)\n          }\n        })\n\n          \n        return routes\n\n\n    }\n\n    static getLibraryRoutes (libraryURL) {\n\n        let resolvedLibraryURL = `${libraryURL}/partial`\n\n        const routes = [\n          {\n            path: `${libraryURL}`,\n            async async({ resolve, reject, to }) {\n              await RoutingService.resolveWithSpinner(resolve, `${resolvedLibraryURL}/index.html`)\n            }\n          },\n\n          {\n            path: `${libraryURL}/`,\n            async async({ resolve, reject, to }) {\n              await RoutingService.resolveWithSpinner(resolve, `${resolvedLibraryURL}/index.html`)\n            }\n          },\n\n\n          {\n            path: `${libraryURL}/index.html`,\n            async async({ resolve, reject, to }) {\n              await RoutingService.resolveWithSpinner(resolve,`${resolvedLibraryURL}/index.html`)\n            }\n          }\n\n        ]\n    \n        RoutingService.addSharedRoutes(routes, \"/r/:reader_slug/\")\n    \n        routes.push({\n          path: '(.*)',\n          //@ts-ignore\n          async async({ resolve, reject, to }) {\n            console.log(`404 error: ${to.path}`)\n            await RoutingService.resolveWithSpinner(resolve, `${resolvedLibraryURL}/404.html`)\n          }\n        })\n\n\n        return routes\n    }\n\n    private static addSharedRoutes(routes, baseURI) {\n            \n        let resolvedBaseURI\n\n        if (baseURI.indexOf(':reader_slug') > 0) {\n          resolvedBaseURI = baseURI.replace(\":reader_slug\", \"{{reader_slug}}\")\n        } else {\n          resolvedBaseURI = baseURI\n        }\n\n        resolvedBaseURI += \"partial/\"\n\n        routes.push(...[\n            {\n              path: `${baseURI}`,\n              async async({ resolve, reject, to }) {\n                await RoutingService.resolveWithSpinner(resolve, `${resolvedBaseURI}index.html`)\n              }\n            },\n            {\n              path: `${baseURI}index.html`,\n              async async({ resolve, reject, to }) {\n                await RoutingService.resolveWithSpinner(resolve, `${resolvedBaseURI}index.html`)\n              }\n            },\n      \n      \n            {\n              path: `${baseURI}mint.html`,\n              async async({ resolve, reject, to }) {\n                await RoutingService.resolveWithSpinner(resolve, `${resolvedBaseURI}mint.html`)\n              }\n            },\n      \n            {\n              path: `${baseURI}search.html`,\n              async async({ resolve, reject, to }) {\n                await RoutingService.resolveWithSpinner(resolve, `${resolvedBaseURI}search.html`)\n              }\n            },      \n            {\n              path: `${baseURI}explore.html`,\n              async async({ resolve, reject, to }) {\n                await RoutingService.resolveWithSpinner(resolve, `${resolvedBaseURI}explore.html`)\n              }\n            },\n            {\n              path: `${baseURI}activity`,\n              async async({ resolve, reject, to }) {\n                await RoutingService.resolveWithSpinner(resolve, `${resolvedBaseURI}activity/index.html`)\n              }\n            },\n            {\n              path: `${baseURI}activity/index.html`,\n              async async({ resolve, reject, to }) {\n                await RoutingService.resolveWithSpinner(resolve, `${resolvedBaseURI}activity/index.html`)\n              }\n            },\n            {\n              path: `${baseURI}leaderboard`,\n              async async({ resolve, reject, to }) {\n                await RoutingService.resolveWithSpinner(resolve, `${resolvedBaseURI}leaderboard/index.html`)\n              }\n            },\n            {\n              path: `${baseURI}leaderboard/index.html`,\n              async async({ resolve, reject, to }) {\n                await RoutingService.resolveWithSpinner(resolve,`${resolvedBaseURI}leaderboard/index.html`)\n              }\n            },\n            {\n              path: `${baseURI}sales`,\n              async async({ resolve, reject, to }) {\n                await RoutingService.resolveWithSpinner(resolve, `${resolvedBaseURI}sales/index.html`)\n              }\n            },\n            {\n              path: `${baseURI}sales/index.html`,\n              async async({ resolve, reject, to }) {\n                await RoutingService.resolveWithSpinner(resolve, `${resolvedBaseURI}sales/index.html`)\n              }\n            },\n            {\n              path: `${baseURI}attributes`,\n              async async({ resolve, reject, to }) {\n                await RoutingService.resolveWithSpinner(resolve, `${resolvedBaseURI}attributes/index.html`)\n              }\n            },\n            {\n              path: `${baseURI}attributes/index.html`,\n              async async({ resolve, reject, to }) {\n                await RoutingService.resolveWithSpinner(resolve, `${resolvedBaseURI}attributes/index.html`)\n              }\n            },\n            {\n              path: `${baseURI}attribute`,\n              async async({ resolve, reject, to }) {\n                await RoutingService.resolveWithSpinner(resolve, `${resolvedBaseURI}attribute/index.html`)\n              }\n            },\n            {\n              path: `${baseURI}attribute/index.html`,\n              async async({ resolve, reject, to }) {\n                await RoutingService.resolveWithSpinner(resolve, `${resolvedBaseURI}attribute/index.html`)\n              }\n            },\n            {\n              path: `${baseURI}u`,\n              async async({ resolve, reject, to }) {\n                await RoutingService.resolveWithSpinner(resolve, `${resolvedBaseURI}u/index.html`)\n              }\n            },\n            {\n              path: `${baseURI}u/index.html`,\n              async async({ resolve, reject, to }) {\n                await RoutingService.resolveWithSpinner(resolve, `${resolvedBaseURI}u/index.html`)\n              }\n            },\n            {\n              path: `${baseURI}u/activity`,\n              async async({ resolve, reject, to }) {\n                await RoutingService.resolveWithSpinner(resolve, `${resolvedBaseURI}u/activity/index.html`)\n              }\n            },\n            {\n              path: `${baseURI}u/activity/index.html`,\n              async async({ resolve, reject, to }) {\n                await RoutingService.resolveWithSpinner(resolve, `${resolvedBaseURI}u/activity/index.html`)\n              }\n            },\n            {\n              path: `${baseURI}list-:page.html`,\n              async async({ resolve, reject, to }) {\n                await RoutingService.resolveWithSpinner(resolve, `${resolvedBaseURI}list-{{page}}.html`)\n              }\n            },\n            {\n              path: `${baseURI}t/:tokenId`,\n              async async({ resolve, reject, to }) {\n                await RoutingService.resolveWithSpinner(resolve, `${resolvedBaseURI}t/{{tokenId}}/index.html`, { force: true })\n              }\n            },\n            {\n              path: `${baseURI}t/:tokenId/index.html`,\n              async async({ resolve, reject, to }) {\n                await RoutingService.resolveWithSpinner(resolve,`${resolvedBaseURI}t/{{tokenId}}/index.html`, { force: true })\n              }\n            },\n            {\n              path: `${baseURI}s/:slug.html`,\n              async async({ resolve, reject, to }) {\n                await RoutingService.resolveWithSpinner(resolve, `${resolvedBaseURI}s/{{slug}}.html`)\n              }\n            }\n      \n        ])\n\n    }\n\n\n}\n\n\nexport { RoutingService }","import \"regenerator-runtime/runtime.js\"\nimport \"reflect-metadata\"\n\nimport {Workbox} from 'workbox-window'\nimport { Container } from \"inversify\"\n\nimport { getMainContainer } from \"../reader/inversify.config.js\"\n\nimport { HomeWebService } from \"./service/web/home-web-service.js\"\nimport { HomeRepository } from \"./repository/home-repository.js\"\nimport { HomeRepositoryBrowserImpl } from \"./repository/web/home-repository-impl.js\"\nimport { RoutingService } from \"../reader/service/core/routing-service.js\"\n\n//Import CSS\nimport './html/css/app.css'\n\n\nlet initLibrary = async (libraryURL:string, baseURI:string, hostname:string, version:string, channelId:string) => {\n\n    console.log(\"Initializing Library\")\n    \n    if ('serviceWorker' in navigator) {\n\n        const wb = new Workbox(`${hostname}/sw-library-${version}.js`, {\n            scope: `/`\n        })\n    \n        let container:Container = new Container()\n\n        container.bind(\"libraryURL\").toConstantValue(libraryURL)\n        container.bind<HomeWebService>(\"HomeWebService\").to(HomeWebService).inSingletonScope()\n        container.bind<HomeRepository>(\"HomeRepository\").to(HomeRepositoryBrowserImpl).inSingletonScope()\n\n\n        let routes = RoutingService.getLibraryRoutes(libraryURL)\n\n        container = await getMainContainer(container, baseURI, hostname, version, routes, channelId)\n\n        if (navigator.serviceWorker.controller) {\n            startApp(container, hostname)\n        } else {\n            wb.addEventListener('controlling', e => {\n                startApp(container, hostname)\n            })\n        }\n\n        wb.register()\n    }\n\n\n} \n\nlet startApp = async (container:Container, hostname:string) => {\n\n    // let container = getMainContainer(baseURI, version, routablePages)            \n    let app:any = container.get(\"framework7\")\n    \n    //Create the main view\n\n    //Get URL\n    let internalUrl = window.location.toString().replace(`${hostname}`, '')\n\n    // console.log(`internal URL ${internalUrl}`)\n\n    const mainView = app.views.create('.view-main', {\n        url: internalUrl\n    })\n\n\n    mainView.on(\"init\", async (view) => {\n\n        console.log(`Navigating to ${internalUrl}`)\n        //When the view loads lets reload the initial page so that we fire the component logic. \n        view.router.navigate(internalUrl, { reloadCurrent: true, animate: false })\n    })\n    \n    app.init()\n\n\n}\n\nexport { initLibrary }\n\n"],"names":["framework7Component","props","$on","$f7","$update","walletAddress","walletService","globalThis","container","get","baseURI","hostname","title","symbol","logo","active","libraryURL","library_url","largeURL","large_url","showMintPage","show_mint_page","showActivityPage","show_activity_page","hideMenu","hide_menu","breadcrumbs","showConnect","getForkLink","length","encodeURIComponent","truncateEthAddress","address","displayAddress","async","undefined","provider","initProvider","getAddress","wallet","connect","connectWallet","initWallet","$ctx","$","$h","$root","$f7route","$f7router","$theme","$store","map","b","path","text","id","readerSettingsService","tokenId","token_id","itemCount","item_count","currentPage","current_page","link","href","rangeSliderChange","e","preventDefault","currentTarget","val","preloader","show","updateCurrentPage","parseInt","views","main","router","navigate","transition","hide","rangeChange","range","target","value","app","on","p","style","mintingViewModel","mintPriceWei","mintWebService","queueService","total","quantity","exactTokensOnly","baseurl","updateTotal","detail","selectPreviews","amount","selected","each","ele","removeClass","addClass","mintOnSubmit","mintFunction","start","totalMinted","mintFromStartOrFail","mint","promiseView","promise","queuePromiseView","exactTokensOnChange","checked","populate","getMintingViewModel","parseUnits","mintPrice","CustomEvent","document","dispatchEvent","ex","dialog","confirm","mintEventHandler","removeEventListener","addEventListener","minting","totalSupply","attributeOptions","handlerBody","filters","attributeParams","handler","attributeChange","name","ev","deleteChipClick","attributeId","data","Object","keys","key","ao","traitType","values","v","count","totalItems","totalMatches","baseURL","m","transactionWebService","largestSales","largest_sales","sales","sale","index","rowItemViewModels","coverImageId","coverImageGenerated","Intl","NumberFormat","format","ethValue","abbreviateDollars","usdValue","dayjs","date","Transfer","transaction","event","base_uri","row_item_view_models","rowItemViewModel","imageLink","isMint","_id","transactionValue","markets","Array","from","k","join","aggregator","timestamp","fromNow","tokenPrice","price","toFixed","currency","fromAddress","getDisplayAddress","toAddress","Approval","approved","namedArgs","owner","ApprovalForAll","operator","transactionsViewModel","ens","transactions","items","token","events","processedEvent","tokenOwners","token_owners","u","rank","ensName","salesReport","buys","lastActive","itemWebService","results","searching","searchbarSubmit","blur","showIn","query","hideIn","itemViewModel","item","excerpt","coverImage","generated","contentHTML","WalletServiceImpl","contracts","getProvider","ethersContracts","constructor","this","ethereum","accounts","refreshPage","networkId","console","log","send","getSigner","c","abi","match","injectable","inject","Function","DatabaseService","PouchDB","channelId","dbCache","config","fullName","details","info","doc_count","update_seq","changesets","localChangesets","ids","changeset","push","put","initialRecords","loadInitialRecords","updated","includes","response","initialRecordsPath","fetch","json","bulkDocs","ChannelRepositoryBrowserImpl","db","createIndex","fields","dbName","databaseService","getDatabase","channel","channels","allDocs","include_docs","rows","doc","dateCreated","contractResponse","axios","contractAddress","Item","_rev","description","content","authorId","category","attributeSelections","coverImageAsAnimation","originalJSONMetadataId","animationId","datePublished","lastUpdated","ItemRepositoryBrowserImpl","static","assign","skip","limit","find","selector","$exists","sort","docs","$eq","$in","pageNumber","escape","s","replace","toLowerCase","itemPage","tokenIds","startTokenId","search","highlighting","row","Author","url","coverPhotoId","AuthorRepositoryBrowserImpl","NFTMetadata","image","image_data","external_url","attributes","background_color","animation_url","MetadataRepositoryBrowserImpl","Image","cid","buffer","svg","ImageRepositoryBrowserImpl","Animation","AnimationRepositoryBrowserImpl","StaticPage","slug","contentMarkdown","locations","StaticPageRepositoryBrowserImpl","location","$all","ItemPageRepositoryBrowserImpl","AttributeTotal","categoryPercent","AttributeTotalRepositoryBrowserImpl","d","attributeTotal","ReaderSettings","lastPageJump","Allow","ReaderSettingsRepositoryBrowserImpl","readerSettings","result","Token","TokenRepositoryBrowserImpl","AuthorService","authorRepository","getDisplayName","author","ChannelService","channelRepository","PagingService","buildPagingViewModel","offset","numberOfPages","viewModel","PagingViewModel","end","Math","min","previousOffset","max","nextOffset","page","endPage","ceil","lastOffset","showNext","showPrevious","showFirst","showLast","calculateEndIndex","currentCount","endIndex","calculateDescendingEndIndex","calculateDescendingOffset","calculatedOffset","pageNumbers","SchemaService","itemRepository","imageRepository","animationRepository","staticPageRepository","readerSettingsRepository","rowItemViewModelRepository","attributeTotalRepository","componentStateRepository","dbs","repositories","getRepositories","repo","filter","r","load","ImageService","list","bufferToDataURL","getSVGURL","svgToDataURL","svgStr","mimeType","toString","StaticPageService","listByLocation","concat","JSON","parse","stringify","staticPage","ChannelWebService","channelService","authorService","imageService","pagingService","schemaService","staticPageService","loadedChannelData","getViewModel","pagingViewModel","staticPagesViewModel","channelContractAbbrev","authorDisplayName","reloadAll","AnimationService","QuillService","ops","qdc","renderCustomWith","customOp","contextOp","insert","type","img","src","width","height","convert","deltaToMarkdown","AttributeTotalService","getByIds","totals","totalKeys","Set","as","flat","totalKey","substring","indexOf","at","minimumFractionDigits","maximumFractionDigits","a","ItemService","attributeTotalService","all","getByTokenId","getByTokenIds","getRowItemViewModelsByAttribute","getRowItemViewModelsByOwner","getRowItemViewModelsByTokenIds","getRowItemViewModelsByTokenId","listByTokenId","buildAttributeTotals","ItemPageService","itemPageRepository","parser","DOMParser","ItemWebService","itemService","quillService","animationService","itemPageService","allTokensCache","attributeReport","animation","animationContentHTML","selections","selection","attributeTotals","matches","body","parseFromString","getElementsByTagName","serializeToString","slice","op","ipfsimage","getUrl","translateContent","params","clonedParams","parentFilteredIds","_paramsToFilteredIds","x","aovm","exploreQuery","filteredIds","searchTokenIds","allAttributeTotals","attributeTotalIds","reduce","getMintViewModel","viewModels","getSearchViewModel","itemViewModels","perPage","i","translateRowItemViewModel","AuthorWebService","TokenContractService","metadataRepository","lastMintedTokenId","channelContract","getChannelContract","balanceOf","totalMintCost","ownerOf","contract","getContract","listeners","topics","mintEvent","MintWebService","tokenContractService","getTotalMinted","lastMinted","Number","totalWei","calculateTotalMint","mintAsOwner","QueueService","self","queueItem","Guid","newGuid","icon","Promise","resolve","reject","_beforeSaveAction","before","then","_showSuccess","_showError","toast","create","closeButton","open","error","close","message","closeButtonText","closeTimeout","random","UiService","showExceptionPopup","alert","showPopup","showAlert","spinnerDialog","showSpinner","hideSpinner","progressDialog","showProgress","hideProgress","progress","setProgress","setText","ValidationException","Error","errors","super","ReaderSettingsService","Date","toJSON","forbidUnknownValues","whitelist","ERCEvent","removed","logIndex","args","eventSignature","isTransfer","isBurn","ERCEventService","ercEvent","fragment","ComponentStateService","componentState","ComponentState","ComponentStateRepositoryBrowserImpl","TokenOwnerPageService","tokenOwnerPageRepository","getHome","getTotals","TokenOwnerPageRepositoryBrowserImpl","ProcessedTransactionService","processedTransactionRepository","processedEvents","add","rivm","getSalesReport","getAttributeSalesReport","getAttributesOverall","getLargestSales","TransactionWebService","processedTransactionService","headers","latest","getLatest","number","digits","tier","log10","abs","suffix","scaled","pow","ProcessedTransactionRepositoryBrowserImpl","processedTransaction","attributeSalesReport","attributeKeyToInteger","attributeOverallSales","chr","hash","charCodeAt","TokenOwner","TokenOwnerService","tokenOwnerRepository","getENS","tokenOwner","forEach","putAll","by_token_id","emit","TokenOwnerRepositoryBrowserImpl","TokenService","tokenRepository","RowItemViewModelRepositoryBrowserImpl","getMainContainer","customContainer","theBaseURI","theHostname","version","routes","bind","toConstantValue","registerComponent","el","theme","init","view","browserHistory","browserHistorySeparator","browserHistoryOnLoad","browserHistoryInitialMatch","navbar","hideOnPageScroll","toolbar","window","web3Provider","contractABI","responseType","contractABIResponse","status","to","inSingletonScope","he","plugin","use","HomeWebService","homeRepository","HomeRepositoryBrowserImpl","RoutingService","options","componentUrl","resolvedBaseURI","endsWith","resolveWithSpinner","addSharedRoutes","resolvedLibraryURL","force","initLibrary","navigator","wb","scope","getLibraryRoutes","serviceWorker","controller","startApp","register","internalUrl","reloadCurrent","animate"],"sourceRoot":""}