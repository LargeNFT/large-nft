<!--suppress JSAnnotator -->
<template>

  <div class="page" data-name="home">

    <div class="navbar">
      <div class="navbar-inner sliding">
        <div class="left">

        </div>
        <div class="right">

          <a class="link" href="/">
            <i class="f7-icons">home</i>
            <span>Home</span>
          </a>

          <a class="link" href="/settings">
            <i class="f7-icons">gear_fill</i>
            <span>Settings</span>
          </a>

          <a class="link" href="/profile/static/{{currentAccount}}">
            <i class="f7-icons">person</i>
            <span>Profile</span>
          </a>

        </div>
      </div>

    </div>




    <div class="page-content infinite-scroll-content">

      <div class="row">

        <div class="col-100 tablet-50 center">

          <div class="block-title">Following</div>
          <div class="list media-list">

            <ul id="friend-list">
              
            </ul>

          </div>

          <div class="preloader infinite-scroll-preloader"></div>

        </div>

      </div>

    </div>

  </div>

</template>






<script>

    return {
      on: {
        pageInit: async function (e, page) {
  
        },
  
        pageAfterOut: function (e, page) {
          
            // Nothing more to load, detach infinite scroll events to prevent unnecessary loadings
            window['Global'].app.infiniteScroll.destroy('.infinite-scroll-content')
  
            // Remove preloader
            this.$$('.infinite-scroll-preloader').remove()
  
        },
      },
      created: async function () {
  
        const self = this
  
        await window['Global'].loadComponentState(this, false)
  
  
        let controller = window['followController']
  
        // Attach 'infinite' event handler
        this.$$('.infinite-scroll-content').on('infinite', async function () {
  
          // console.log(`Start event handler - loadingInProgress: ${controller.loadingInProgress}, hasMorePosts: ${controller.hasMorePosts}`)
  
          // Exit, if loading in progress
          if (controller.loadingInProgress || !controller.hasMorePosts) return;
  
          // Set loading flag
          controller.loadingInProgress = true;
  
          let posts = await controller.getNextPageFollowing()
  
          // console.log(`After getting view model - loadingInProgress: ${controller.loadingInProgress}, hasMorePosts: ${controller.hasMorePosts}`)
  
          for (var post of posts) {
            self.$$("#friend-list").append(window['Global'].profileResultTemplate(post))
          }
  
          if (!controller.hasMorePosts) {
  
            console.log("Unloading infinite scroll")
  
            // Nothing more to load, detach infinite scroll events to prevent unnecessary loadings
            window['Global'].app.infiniteScroll.destroy('.infinite-scroll-content')
  
            // Remove preloader
            self.$$('.infinite-scroll-preloader').remove()
  
          }
  
          controller.loadingInProgress = false
  
        });
        
        this.$$('.infinite-scroll-content').trigger('infinite')

  
      }
    }
  
  </script>