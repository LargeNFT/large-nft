<template>

    <div class="page" data-name="admin-settings">

        <div class="navbar">
            <div class="navbar-bg"></div>
            <div class="navbar-inner">
                <div class="title">Site Settings</div>
                <div class="right">
                    <${HeaderRight} />
                </div>
            </div>
        </div>

        <div class="fab fab-extended fab-right-bottom">
            <a @click="${saveSettingsClick}" class="text-color-black">
              <i class="material-icons">save</i>
              <div class="fab-text">Save</div>
            </a>
          </div>



        <div class="page-content">
            <div class="block-title">Site Settings</div>
            <form class="block list" id="edit-settings-form">
                <ul>
                    <li>
                        <div class="item-content item-input">
                            <div class="item-inner">
                                <div class="item-title item-label">Site Title</div>
                                <div class="item-input-wrap">
                                    <input type="text" name="title" placeholder="Site title" value="${settings.title}" />
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content item-input">
                            <div class="item-inner">
                                <div class="item-title item-label">Tagline</div>
                                <div class="item-input-wrap">
                                    <input type="text" name="tagline" placeholder="Enter a tagline (optional)"
                                        value="${settings.tagline}" />
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content item-input">
                            <div class="item-inner">
                                <div class="item-title item-label">Public Email Address (optional)</div>
                                <div class="item-input-wrap">
                                    <input type="text" name="publicEmailAddress"
                                        placeholder="Enter an option public email address"
                                        value="${settings.publicEmailAddress}" />
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content item-input">
                            <div class="item-inner">
                                <div class="item-title item-label">Timezone</div>
                                <div class="item-input-wrap">
                                    <select name="timezone">
                                        <option value="UTC">UTC</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </li>

                </ul>

            </form>



        </div>



    </div>

</template>




<script>
    import { ContainerService } from "../../../service/core/container-service"

    import HeaderRight from "../../admin/header-right.f7.html"

    import { WalletService } from "../../../service/core/wallet-service"
    import { SiteSettingsService } from "../../../service/core/site-settings-service"



    export default (props, { $, $on, $f7, $update }) => {
      
      let siteSettingsService = ContainerService.getInstance(SiteSettingsService)
      let walletService = ContainerService.getInstance(WalletService)
    //   let uiService = ContainerService.getInstance(UiService)

      let stores = []
      let schema
      let settings = {}

      $on('pageInit', async (e, page) => {

        let walletAddress = await walletService.getAddress()

        try {
            settings = await siteSettingsService.get(walletAddress)
        } catch(ex) {}
        

        $update()

      })

        
      const saveSettingsClick = async (e) => {

        //Get data
        let pageData = await getPageData('#edit-settings-form')

        //Set home page
        if (pageData.homePage) {
        await pageService.resetHomePage()
        }

        //Save
        let page = await pageService.put(pageData)




        //Redirect
        $f7.views.main.router.navigate(`/admin/page/show/${page._id}`)

    }



      return $render
    }

</script>
