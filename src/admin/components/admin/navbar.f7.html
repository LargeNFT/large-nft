<template>

    <div class="navbar">
        <div class="navbar-bg"></div>

        <div class="navbar-inner sliding">
        
          <div class="left">
            <a href="/" class="logo">Large</a>
          </div>
        
          <div class="title"></div>

          <div class="right">

            ${showConnect ? $h`
                ${walletAddress != undefined ? $h`
                    <a href="/admin/author/show/${walletAddress}" class="button button-fill">${truncateEthAddress(walletAddress)}</a>
                  ` : $h`
                    <button class="button button-outline button-fill" @click=${connectWallet}>Connect Wallet</button>
                  `}
            ` : $h`<span />`}
    
            <a href="/admin/settings" class="button button-fill" id="settings-button" >
                <i class="material-icons">settings</i>
            </a>
    
          </div>


          ${readerConfig?.path ? $h`
            <div class="subnavbar">
              <div class="subnavbar-inner">
                <div class="subnavbar-title">
                  <a href="${readerConfig.path}" class="link external">
                    <i class="icon icon-back"></i> ${readerConfig.title}
                  </a>
                </div>
              </div>
            </div>
          ` : ''}


        </div>
      </div>

</template>
 
<style>

 .logo {
   font-size: 32px;
   font-weight: 700;
   margin: 10px;
 }

 .searchbar {
   max-width: 100%;
 }

 #settings-button {
  margin-left: 3px;
 }

</style>


<script>


    import { ContainerService } from "../../service/core/container-service"


    export default (props, { $on, $f7, $update }) => {
    
        let walletService = ContainerService.getWalletService()

        let walletAddress = walletService.address
        let showConnect = walletService.provider != undefined

        let readerConfig = props.reader_config

        // Captures 0x + 4 characters, then the last 4 characters.
        const truncateRegex = /^(0x[a-zA-Z0-9]{4})[a-zA-Z0-9]+([a-zA-Z0-9]{4})$/
            
        const truncateEthAddress = (address) => {
            const match = address.match(truncateRegex)
            if (!match) return address
            return `${match[1]}â€¦${match[2]}`
        }



        const connectWallet = async (e) => {
            document.dispatchEvent(new CustomEvent('connect-wallet'))
        }


        return $render
    }
</script>
