<!--suppress JSAnnotator -->
<template>

  <div class="page" data-name="admin-posts">

    <div class="navbar">
      <div class="navbar-bg"></div>
      <div class="navbar-inner">
        <div class="title">Blog Posts</div>
        <div class="right">
          {{> "mobileBars"}}
        </div>
      </div>
    </div>

    <div class="toolbar tabbar toolbar-top">
      <div class="toolbar-inner">
        <a class="tab-link tab-link-active">Published</a>
        <a class="tab-link" href="#"> Drafts</a>
      </div>
    </div>



    <div class="fab fab-extended fab-right-bottom">
      <a href="/admin/post/create" class="text-color-black">
        <i class="material-icons">create</i>
        <div class="fab-text">Create Post</div>
      </a>
    </div>




    <div class="page-content infinite-scroll-content">
      <div class="list virtual-list no-margin" id="blog-post-list">
      </div>
    </div>

  </div>

</template>





<script>
  return {
    on: {
      pageInit: function (e, page) {
        const self = this

        let controller = window['adminPostController']

        // Attach 'infinite' event handler
        this.$$('.infinite-scroll-content').on('infinite', async function () {
          await controller.infiniteScrollListener(self)
        })

        controller.virtualList = window['Global'].app.virtualList.create({
          el: '#blog-post-list',
          itemTemplate: `
            <li>
                <a href="/admin/post/show/{{permalinkKey}}" class="item-link item-content">

                  <div class="item-media">
                    {{#if coverPhotoSrc}}
                      <img class="cover-photo-thumb" src="{{coverPhotoSrc}}">
                    {{else}}
                      <i class="f7-icons cover-photo-thumb">document</i>
                    {{/if}}
                  </div>    
                
                  <div class="item-inner">
                        <div class="item-title">
                          {{title}}
                          <div class="item-footer">{{dateCreatedDisplay}}</div>
                        </div>
                  </div>
                </a>
            </li>
          `,
          items: this.posts,
          setListHeight: true,
          updatableScroll: true,
          height: function() {

            if (window['Global'].app.theme === 'md') {
              return 56
            } else if (window['Global'].app.theme === 'ios') {
              return 44
            } else if (window['Global'].app.theme === 'aurora') {
              return 38
            }
          },
          emptyTemplate: `
          <li class="item-content">
                <div class="item-inner">
                      There are no blog posts yet. <br /><br />Click the 'Create Post' button to create your first blog post.
                </div>
          </li>
          `
        })


        //Get the page
        this.$$('.infinite-scroll-content').trigger('infinite')


      },
      pageAfterOut: function (e, page) {
        let controller = window['adminPostController']
        controller.unloadInfiniteScroll()
      }
    }
  }
</script>